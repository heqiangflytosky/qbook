
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Android startActivity 流程分析 · 寒江蓑笠的博客</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="基于Android6.0来分析 Activity 的启动过程">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="寒江蓑笠">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-intopic-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="android-source-code-analysis-usermanager.html" />
    
    
    <link rel="prev" href="android-source-code-analysis-ams-app-ipc.html" />
    

    
        <link rel="shortcut icon" href='../../images/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../../https:/github.com/heqiangflytosky/qbook/blob/gitbook/images/favicon.ico?raw=true' type="image/x-icon">
    
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://blog.csdn.net/heqiangflytosky" target="_blank" class="custom-link">我的CSDN</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    博客简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    AI
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../AI/ai_development_tool.html">
            
                <a href="../AI/ai_development_tool.html">
            
                    
                    AI 开发工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../AI/ai_rag_simple_implementation.html">
            
                <a href="../AI/ai_rag_simple_implementation.html">
            
                    
                    Colab + Langchain 简单实现 RAG
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../AI/ai_llm_chatglm3_deployment.html">
            
                <a href="../AI/ai_llm_chatglm3_deployment.html">
            
                    
                    ChatGLM 3 本地安装部署以及快速入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../AI/ai_langchain_overview.html">
            
                <a href="../AI/ai_langchain_overview.html">
            
                    
                    LangChain 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../AI/ai_llama_cpp_basic.html">
            
                <a href="../AI/ai_llama_cpp_basic.html">
            
                    
                    大模型推理框架 llama.cpp
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Android
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Android/android-knowledge-debug-skill-one.html">
            
                <a href="../Android/android-knowledge-debug-skill-one.html">
            
                    
                    Android 常用调试知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../Android/android-ipc-aidl.html">
            
                <a href="../Android/android-ipc-aidl.html">
            
                    
                    Android IPC 之 AIDL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../Android/android-ipc-messenger.html">
            
                <a href="../Android/android-ipc-messenger.html">
            
                    
                    Android IPC 之 Messenger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../Android/android-ipc-aidl-aync-callback.html">
            
                <a href="../Android/android-ipc-aidl-aync-callback.html">
            
                    
                    Android IPC 之 AIDL 异步调用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../Android/android-ipc-remote-exception.html">
            
                <a href="../Android/android-ipc-remote-exception.html">
            
                    
                    Android IPC 之异常的跨进程传递
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../Android/android-get-dir-path.html">
            
                <a href="../Android/android-get-dir-path.html">
            
                    
                    Android 文件存储以及获取目录路径方法汇总
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../Android/android-knowledge-using-resources.html">
            
                <a href="../Android/android-knowledge-using-resources.html">
            
                    
                    Android 应该了解的知识系列 - 资源引用的那些事儿
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../Android/android-knowledge-style-extends.html">
            
                <a href="../Android/android-knowledge-style-extends.html">
            
                    
                    Android 应该了解的知识系列 - 关于 Style 命名和继承方式的那些事儿
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../Android/android-knowledge-attr-style-theme.html">
            
                <a href="../Android/android-knowledge-attr-style-theme.html">
            
                    
                    Android -- Attr、Style和Theme
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../Android/android-knowledge-point-launchmode-intent-flag.html">
            
                <a href="../Android/android-knowledge-point-launchmode-intent-flag.html">
            
                    
                    Android LaunchMode taskAffinity 与 Intent Flag 详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="../Android/android-jni-android-studio-base.html">
            
                <a href="../Android/android-jni-android-studio-base.html">
            
                    
                    Android JNI -- Android Studio JNI 开发基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="../Android/android-jni-object-papas.html">
            
                <a href="../Android/android-jni-object-papas.html">
            
                    
                    Android JNI -- 传递对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="../Android/android-knowledge-point-shareduserid-app-process.html">
            
                <a href="../Android/android-knowledge-point-shareduserid-app-process.html">
            
                    
                    Android App Process 以及 sharedUserId的关系
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="../Android/android-knowledge-point-buildconfig.html">
            
                <a href="../Android/android-knowledge-point-buildconfig.html">
            
                    
                    Android BuildConfig的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.15" data-path="../Android/android-knowledge-point-app-lib-build-type.html">
            
                <a href="../Android/android-knowledge-point-app-lib-build-type.html">
            
                    
                    Android 解决Lib Module 和 App Module 的 buildType 不一样的问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16" data-path="../Android/android-problem-multidex-verifyerror.html">
            
                <a href="../Android/android-problem-multidex-verifyerror.html">
            
                    
                    Android：一个Multidex引发的VerifyError和Class Not Found问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.17" data-path="../Android/android-knowledge-point-layoutInflater.html">
            
                <a href="../Android/android-knowledge-point-layoutInflater.html">
            
                    
                    Android -- 使用 LayoutInflater
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.18" data-path="../Android/android-usefull-class-function.html">
            
                <a href="../Android/android-usefull-class-function.html">
            
                    
                    Android -- 那些让你相见恨晚的方法、类或接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.19" data-path="../Android/android-attr-style-custom.html">
            
                <a href="../Android/android-attr-style-custom.html">
            
                    
                    Android -- 自定义Attribute和Style
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.20" data-path="../Android/android-unit-test.html">
            
                <a href="../Android/android-unit-test.html">
            
                    
                    Android -- 单元测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.21" data-path="../Android/android-knowledge-custom-view-paras.html">
            
                <a href="../Android/android-knowledge-custom-view-paras.html">
            
                    
                    Android -- View 构造参数解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.22" data-path="../Android/android-source-code-analysis-sharedpreferences.html">
            
                <a href="../Android/android-source-code-analysis-sharedpreferences.html">
            
                    
                    Android SharedPreferences 源码分析以及跨进程读写问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.23" data-path="../Android/android-cache-lrucache.html">
            
                <a href="../Android/android-cache-lrucache.html">
            
                    
                    Android -- LruCache 使用和原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.24" data-path="../Android/android-knowledge-about-bitmap-memory-management.html">
            
                <a href="../Android/android-knowledge-about-bitmap-memory-management.html">
            
                    
                    Android -- Bitmap 内存管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.25" data-path="../Android/android-support-multi-cpu-arch.html">
            
                <a href="../Android/android-support-multi-cpu-arch.html">
            
                    
                    Android -- 多CPU架构支持所需要了解的知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.26" data-path="../Android/android-knowledge-point-drawable-cache.html">
            
                <a href="../Android/android-knowledge-point-drawable-cache.html">
            
                    
                    Android：关于Drawable的缓存机制应该了解的知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.27" data-path="../Android/android-view-recycleview-basic-method-of-use.html">
            
                <a href="../Android/android-view-recycleview-basic-method-of-use.html">
            
                    
                    Android View -- RecyclerView 的基本特点和使用方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.28" data-path="../Android/android-view-recycleview-staggeredgridlayoutmanager.html">
            
                <a href="../Android/android-view-recycleview-staggeredgridlayoutmanager.html">
            
                    
                    Android RecyclerView -- StaggeredGridLayoutManager 多样式布局
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.29" data-path="../Android/android-knowledge-point-taskdescription.html">
            
                <a href="../Android/android-knowledge-point-taskdescription.html">
            
                    
                    Android -- 使用 TaskDescription 定制任务管理器 Title
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.30" data-path="../Android/android-basic-oncreate-application-contentprovider.html">
            
                <a href="../Android/android-basic-oncreate-application-contentprovider.html">
            
                    
                    Android -- Application 和 ContentProvider 的 onCreate() 方法的执行顺序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.31" data-path="../Android/android-knowledge-about-activity-save-state.html">
            
                <a href="../Android/android-knowledge-about-activity-save-state.html">
            
                    
                    Android -- Activity 之 onSaveInstanceState 深入理解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.32" data-path="../Android/android-knowledge-about-view-save-state.html">
            
                <a href="../Android/android-knowledge-about-view-save-state.html">
            
                    
                    Android -- View 之 onSaveInstanceState 深入理解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.33" data-path="../Android/android-fileprovider.html">
            
                <a href="../Android/android-fileprovider.html">
            
                    
                    FileProvider 的使用和源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.34" data-path="../Android/android-view-constraintlayout.html">
            
                <a href="../Android/android-view-constraintlayout.html">
            
                    
                    Android View -- ConstraintLayout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.35" data-path="../Android/android-text-font.html">
            
                <a href="../Android/android-text-font.html">
            
                    
                    Android -- 字体设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.36" data-path="../Android/android-animation-implement.html">
            
                <a href="../Android/android-animation-implement.html">
            
                    
                    Android 动画实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.37" data-path="../Android/android-animation-shared-element.html">
            
                <a href="../Android/android-animation-shared-element.html">
            
                    
                    Android 共享元素动画实现以及原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.38" data-path="../Android/android-view-ghostview.html">
            
                <a href="../Android/android-view-ghostview.html">
            
                    
                    Android View -- GhostView
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Android App
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../Android App/android-app-ganktoutiao.html">
            
                <a href="../Android App/android-app-ganktoutiao.html">
            
                    
                    GankTouTiao —— 一个技术干货分享的APP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../Android App/quick-app-demo-ganktoutiao.html">
            
                <a href="../Android App/quick-app-demo-ganktoutiao.html">
            
                    
                    快应用开发 GankTouTiao
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Android Demo
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../Android Demo/android-demo-live-wallpaper-snow.html">
            
                <a href="../Android Demo/android-demo-live-wallpaper-snow.html">
            
                    
                    Android 动态壁纸
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Android Launcher
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../Android Launcher/android-launcher-introducation.html">
            
                <a href="../Android Launcher/android-launcher-introducation.html">
            
                    
                    Android -- Launcher3 简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../Android Launcher/android-launcher-compile-as.html">
            
                <a href="../Android Launcher/android-launcher-compile-as.html">
            
                    
                    Android -- Launcher 独立编译
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../Android Launcher/android-launcher-custom-1.html">
            
                <a href="../Android Launcher/android-launcher-custom-1.html">
            
                    
                    Android -- Launcher 定制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../Android Launcher/android-launcher-ui-construction.html">
            
                <a href="../Android Launcher/android-launcher-ui-construction.html">
            
                    
                    Android -- 页面结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../Android Launcher/android-launcher-load-data.html">
            
                <a href="../Android Launcher/android-launcher-load-data.html">
            
                    
                    Android -- 数据加载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../Android Launcher/android-launcher-launcherappsservice.html">
            
                <a href="../Android Launcher/android-launcher-launcherappsservice.html">
            
                    
                    Android -- LauncherAppsService
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../Android Launcher/android-launcher-icon-cache.html">
            
                <a href="../Android Launcher/android-launcher-icon-cache.html">
            
                    
                    Android -- IconCache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../Android Launcher/android-launcher-recentsview_navigationbar.html">
            
                <a href="../Android Launcher/android-launcher-recentsview_navigationbar.html">
            
                    
                    Android -- 导航栏启动多任务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../Android Launcher/android-launcher-recentsview-gesture.html">
            
                <a href="../Android Launcher/android-launcher-recentsview-gesture.html">
            
                    
                    Android -- 手势导航启动多任务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Android SystemUI
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../Android SystemUI/android-statusbar-and-navigationbar.html">
            
                <a href="../Android SystemUI/android-statusbar-and-navigationbar.html">
            
                    
                    Android -- 状态栏导航栏相关设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../Android SystemUI/android-statusbar-icon-color.html">
            
                <a href="../Android SystemUI/android-statusbar-icon-color.html">
            
                    
                    SystemUI -- 状态栏字体和图标变色原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../Android SystemUI/android-systemui-statusbar-states.html">
            
                <a href="../Android SystemUI/android-systemui-statusbar-states.html">
            
                    
                    SystemUI -- SystemUI 的几种状态
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../Android SystemUI/android-systemui-qsanimator.html">
            
                <a href="../Android SystemUI/android-systemui-qsanimator.html">
            
                    
                    SystemUI -- QSTile 动画实现之 QSAnimator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../Android SystemUI/android-systemui-view-structure.html">
            
                <a href="../Android SystemUI/android-systemui-view-structure.html">
            
                    
                    SystemUI -- 下拉通知面板页面结构和重要的类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../Android SystemUI/android-systemui-events-transfer-process.html">
            
                <a href="../Android SystemUI/android-systemui-events-transfer-process.html">
            
                    
                    SystemUI -- 下拉面板事件分发流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../Android SystemUI/android-systemui-notificationshadesindowview.html">
            
                <a href="../Android SystemUI/android-systemui-notificationshadesindowview.html">
            
                    
                    SystemUI -- NotificationShadeWindowView
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../Android SystemUI/android-systemui-notificationpanelview.html">
            
                <a href="../Android SystemUI/android-systemui-notificationpanelview.html">
            
                    
                    SystemUI -- NotificationPanelView
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../Android SystemUI/android-systemui-notificationstackscrolllayout.html">
            
                <a href="../Android SystemUI/android-systemui-notificationstackscrolllayout.html">
            
                    
                    SystemUI -- NotificationStackScrollLayout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../Android SystemUI/android-systemui-notificationshadedepthcontroller.html">
            
                <a href="../Android SystemUI/android-systemui-notificationshadedepthcontroller.html">
            
                    
                    SystemUI -- NotificationShadeDepthController
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../Android SystemUI/android-systemui-panel-media-controller.html">
            
                <a href="../Android SystemUI/android-systemui-panel-media-controller.html">
            
                    
                    SystemUI -- 多媒体通知
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../Android SystemUI/android-systemui-quick-settings-tile.html">
            
                <a href="../Android SystemUI/android-systemui-quick-settings-tile.html">
            
                    
                    SystemUI -- QS Tile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="../Android SystemUI/android-systemui-with-dagger.html">
            
                <a href="../Android SystemUI/android-systemui-with-dagger.html">
            
                    
                    SystemUI -- Dagger2 的应用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Android 框架
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../Android 框架/android-framework-article-summary.html">
            
                <a href="../Android 框架/android-framework-article-summary.html">
            
                    
                    Android Framework 文章汇总
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../Android 框架/android-framework-clienttransaction.html">
            
                <a href="../Android 框架/android-framework-clienttransaction.html">
            
                    
                    Android AMS 之 ClientTransaction 生命周期管理机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../Android 框架/android-framework-activity-starting-process.html">
            
                <a href="../Android 框架/android-framework-activity-starting-process.html">
            
                    
                    Android AMS 之 Activity 启动流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../Android 框架/android-framework-onactivityresult.html">
            
                <a href="../Android 框架/android-framework-onactivityresult.html">
            
                    
                    Activity 之 onActivityResult 原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../Android 框架/android-framework-app-wms-ams-communication.html">
            
                <a href="../Android 框架/android-framework-app-wms-ams-communication.html">
            
                    
                    Android APP 和 WMS AMS 通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../Android 框架/android-framework-wmshell.html">
            
                <a href="../Android 框架/android-framework-wmshell.html">
            
                    
                    WM Shell 架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../Android 框架/android-framework-wallpaper-manager-service.html">
            
                <a href="../Android 框架/android-framework-wallpaper-manager-service.html">
            
                    
                    Android 壁纸管理服务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Android 事件分发体系
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../Android 事件分发体系/android-knowledge-event-transfer-process.html">
            
                <a href="../Android 事件分发体系/android-knowledge-event-transfer-process.html">
            
                    
                    Android View 事件处理基础知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../Android 事件分发体系/android-knowledge-event-transfer-process-source-code.html">
            
                <a href="../Android 事件分发体系/android-knowledge-event-transfer-process-source-code.html">
            
                    
                    Android 事件处理流程源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../Android 事件分发体系/android-knowledge-event-transfer-process-touchtarget.html">
            
                <a href="../Android 事件分发体系/android-knowledge-event-transfer-process-touchtarget.html">
            
                    
                    Android View 事件处理流程 -- TouchTarget
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../Android 事件分发体系/android-knowledge-event-transfer-process-multi-point.html">
            
                <a href="../Android 事件分发体系/android-knowledge-event-transfer-process-multi-point.html">
            
                    
                    Android View 事件处理流程 -- 多点触控
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../Android 事件分发体系/android-knowledge-event-transfer-process-debug-skill.html">
            
                <a href="../Android 事件分发体系/android-knowledge-event-transfer-process-debug-skill.html">
            
                    
                    Android Input事件相关Debug技巧
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../Android 事件分发体系/android-knowledge-window-event-settings.html">
            
                <a href="../Android 事件分发体系/android-knowledge-window-event-settings.html">
            
                    
                    Android 窗口事件相关设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../Android 事件分发体系/android-knowledge-input-system.html">
            
                <a href="../Android 事件分发体系/android-knowledge-input-system.html">
            
                    
                    Android Input 系统简介
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    Android 窗口系统
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../Android 窗口系统/android-window-system-class.html">
            
                <a href="../Android 窗口系统/android-window-system-class.html">
            
                    
                    Android 窗口系统相关类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../Android 窗口系统/android-window-system-window-tree-basic.html">
            
                <a href="../Android 窗口系统/android-window-system-window-tree-basic.html">
            
                    
                    Android 窗口层级树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../Android 窗口系统/android-window-system-build-window-tree.html">
            
                <a href="../Android 窗口系统/android-window-system-build-window-tree.html">
            
                    
                    Android 窗口层级构建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../Android 窗口系统/android-window-system-add-window.html">
            
                <a href="../Android 窗口系统/android-window-system-add-window.html">
            
                    
                    Android 窗口层级树-添加窗口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../Android 窗口系统/android-window-system-window-layout.html">
            
                <a href="../Android 窗口系统/android-window-system-window-layout.html">
            
                    
                    Android 窗口系统-窗口布局
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../Android 窗口系统/android-window-system-window-draw.html">
            
                <a href="../Android 窗口系统/android-window-system-window-draw.html">
            
                    
                    Android 窗口系统-窗口绘制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../Android 窗口系统/android-window-system-window-refresh.html">
            
                <a href="../Android 窗口系统/android-window-system-window-refresh.html">
            
                    
                    Android 窗口系统-窗口刷新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../Android 窗口系统/android-window-system-window-show-hide.html">
            
                <a href="../Android 窗口系统/android-window-system-window-show-hide.html">
            
                    
                    Android 窗口系统-窗口的显示和隐藏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="../Android 窗口系统/android-window-system-window-tree-layer-tree.html">
            
                <a href="../Android 窗口系统/android-window-system-window-tree-layer-tree.html">
            
                    
                    Android 窗口层级树-Layer树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="../Android 窗口系统/android-window-system-configuration-container.html">
            
                <a href="../Android 窗口系统/android-window-system-configuration-container.html">
            
                    
                    Android ConfigurationContainer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="../Android 窗口系统/android-window-system-move-task.html">
            
                <a href="../Android 窗口系统/android-window-system-move-task.html">
            
                    
                    Android 窗口系统-移栈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="../Android 窗口系统/android-window-system-add-window-type-token.html">
            
                <a href="../Android 窗口系统/android-window-system-add-window-type-token.html">
            
                    
                    Android 添加窗口的 token 和 type 与窗口层级
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="../Android 窗口系统/android-window-system-animation-overview.html">
            
                <a href="../Android 窗口系统/android-window-system-animation-overview.html">
            
                    
                    Android 窗口动画概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14" data-path="../Android 窗口系统/android-window-system-animation-add-local-animation.html">
            
                <a href="../Android 窗口系统/android-window-system-animation-add-local-animation.html">
            
                    
                    Android 本地窗口动画流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.15" data-path="../Android 窗口系统/android-window-system-animation-windowcontainer-animation.html">
            
                <a href="../Android 窗口系统/android-window-system-animation-windowcontainer-animation.html">
            
                    
                    Android WindowContainer 动画
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.16" data-path="../Android 窗口系统/android-window-system-startingwindow.html">
            
                <a href="../Android 窗口系统/android-window-system-startingwindow.html">
            
                    
                    Android StartingWindow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.17" data-path="../Android 窗口系统/android-window-system-animation-remote-animation.html">
            
                <a href="../Android 窗口系统/android-window-system-animation-remote-animation.html">
            
                    
                    Android 桌面远程窗口动画流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.18" data-path="../Android 窗口系统/android-window-system-animation-systemui-keyguard-going-away.html">
            
                <a href="../Android 窗口系统/android-window-system-animation-systemui-keyguard-going-away.html">
            
                    
                    Android SystemUI 解锁动画
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.19" data-path="../Android 窗口系统/android-window-system-window-focus.html">
            
                <a href="../Android 窗口系统/android-window-system-window-focus.html">
            
                    
                    Android 窗口焦点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.20" data-path="../Android 窗口系统/android-window-system-screen-rotation.html">
            
                <a href="../Android 窗口系统/android-window-system-screen-rotation.html">
            
                    
                    Android 屏幕旋转流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.21" data-path="../Android 窗口系统/android-window-system-shell-transitions-base.html">
            
                <a href="../Android 窗口系统/android-window-system-shell-transitions-base.html">
            
                    
                    Android ShellTransitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.22" data-path="../Android 窗口系统/android-window-system-shell-transitions-multi-animation.html">
            
                <a href="../Android 窗口系统/android-window-system-shell-transitions-multi-animation.html">
            
                    
                    Android ShellTransition 多动画执行场景
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.23" data-path="../Android 窗口系统/android-window-system-blast-sync-engine.html">
            
                <a href="../Android 窗口系统/android-window-system-blast-sync-engine.html">
            
                    
                    Android BLASTSyncEngine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.24" data-path="../Android 窗口系统/android-window-system-surface-sync-group.html">
            
                <a href="../Android 窗口系统/android-window-system-surface-sync-group.html">
            
                    
                    Android Surface 同步机制 SurfaceSyncGroup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.25" data-path="../Android 窗口系统/android-window-system-window-container-transaction.html">
            
                <a href="../Android 窗口系统/android-window-system-window-container-transaction.html">
            
                    
                    Android WindowContainerTransaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.26" data-path="../Android 窗口系统/android-window-system-window-organizer-controller.html">
            
                <a href="../Android 窗口系统/android-window-system-window-organizer-controller.html">
            
                    
                    Android WindowOrganizerController
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.27" data-path="../Android 窗口系统/android-window-system-sync-transaction-queue.html">
            
                <a href="../Android 窗口系统/android-window-system-sync-transaction-queue.html">
            
                    
                    Android SyncTransactionQueue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.28" data-path="../Android 窗口系统/android-window-system-task-switch-animation.html">
            
                <a href="../Android 窗口系统/android-window-system-task-switch-animation.html">
            
                    
                    Android Task 切换动画
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.29" data-path="../Android 窗口系统/android-window-system-window-container-visibility-settings.html">
            
                <a href="../Android 窗口系统/android-window-system-window-container-visibility-settings.html">
            
                    
                    窗口动画和Activity生命周期与窗口可见性设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.30" data-path="../Android 窗口系统/android-window-system-split-screen.html">
            
                <a href="../Android 窗口系统/android-window-system-split-screen.html">
            
                    
                    Android 分屏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.31" data-path="../Android 窗口系统/android-window-system-one-hand.html">
            
                <a href="../Android 窗口系统/android-window-system-one-hand.html">
            
                    
                    Android 单手模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.32" data-path="../Android 窗口系统/android-window-system-pip.html">
            
                <a href="../Android 窗口系统/android-window-system-pip.html">
            
                    
                    Android PIP模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.33" data-path="../Android 窗口系统/android-window-system-desktop-mode.html">
            
                <a href="../Android 窗口系统/android-window-system-desktop-mode.html">
            
                    
                    Android 桌面模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.34" data-path="../Android 窗口系统/android-window-system-predictive-back-gesture.html">
            
                <a href="../Android 窗口系统/android-window-system-predictive-back-gesture.html">
            
                    
                    Android 可预测返回手势动画
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.35" data-path="../Android 窗口系统/android-window-system-update-input-info.html">
            
                <a href="../Android 窗口系统/android-window-system-update-input-info.html">
            
                    
                    Android 窗口更新 Input 信息
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.36" data-path="../Android 窗口系统/android-window-system-fixed-rotation.html">
            
                <a href="../Android 窗口系统/android-window-system-fixed-rotation.html">
            
                    
                    Android 屏幕旋转之 Fixed Rotation 流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.37" data-path="../Android 窗口系统/android-window-system-async-rotation.html">
            
                <a href="../Android 窗口系统/android-window-system-async-rotation.html">
            
                    
                    Android 屏幕旋转之 AsyncRotation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.38" data-path="../Android 窗口系统/android-window-system-unknownappvisibilitycontroller.html">
            
                <a href="../Android 窗口系统/android-window-system-unknownappvisibilitycontroller.html">
            
                    
                    Android WMS UnknownAppVisibilityController
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.39" data-path="../Android 窗口系统/android-window-system-virtual-display.html">
            
                <a href="../Android 窗口系统/android-window-system-virtual-display.html">
            
                    
                    Android 虚拟屏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.40" data-path="../Android 窗口系统/android-window-system-letter-box.html">
            
                <a href="../Android 窗口系统/android-window-system-letter-box.html">
            
                    
                    Android LetterBox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.41" data-path="../Android 窗口系统/android-window-system-surface-control-view-host.html">
            
                <a href="../Android 窗口系统/android-window-system-surface-control-view-host.html">
            
                    
                    Android SurfaceControlViewHost 实现 WindowlessWindow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.42" data-path="../Android 窗口系统/android-window-system-launch-cookies.html">
            
                <a href="../Android 窗口系统/android-window-system-launch-cookies.html">
            
                    
                    Android LaunchCookie
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    Android 图形系统
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../Android 图形系统/android-graphic-system-surfaceview.html">
            
                <a href="../Android 图形系统/android-graphic-system-surfaceview.html">
            
                    
                    Android 图形系统 -- SurfaceView 使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../Android 图形系统/android-graphic-system-textureview.html">
            
                <a href="../Android 图形系统/android-graphic-system-textureview.html">
            
                    
                    Android 图形系统 -- TextureView 使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../Android 图形系统/android-graphic-system-glsurfaceview.html">
            
                <a href="../Android 图形系统/android-graphic-system-glsurfaceview.html">
            
                    
                    Android 图形系统 -- GLSurfaceView 使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../Android 图形系统/android-graphic-system-canvas-sample.html">
            
                <a href="../Android 图形系统/android-graphic-system-canvas-sample.html">
            
                    
                    Android 图形系统 -- Canvas使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="../Android 图形系统/android-graphic-system-blur-effect.html">
            
                <a href="../Android 图形系统/android-graphic-system-blur-effect.html">
            
                    
                    Android 图形系统 -- 实现毛玻璃的几种方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="../Android 图形系统/android-graphic-system-decorview-viewrootimpl.html">
            
                <a href="../Android 图形系统/android-graphic-system-decorview-viewrootimpl.html">
            
                    
                    Android 图形系统 -- Window，DecorView 和 ViewRootImpl
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.7" data-path="../Android 图形系统/android-graphic-system-view-drawing.html">
            
                <a href="../Android 图形系统/android-graphic-system-view-drawing.html">
            
                    
                    Android 图形系统 -- View 绘制流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.8" data-path="../Android 图形系统/android-graphic-system-hardwareaccelerated.html">
            
                <a href="../Android 图形系统/android-graphic-system-hardwareaccelerated.html">
            
                    
                    Android 图形系统 -- 硬件加速渲染
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.9" data-path="../Android 图形系统/android-graphic-system-view-layer-type.html">
            
                <a href="../Android 图形系统/android-graphic-system-view-layer-type.html">
            
                    
                    Android Hardware Layer 详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.10" data-path="../Android 图形系统/android-graphic-system-basic-class.html">
            
                <a href="../Android 图形系统/android-graphic-system-basic-class.html">
            
                    
                    Android 图形系统基础知识和相关类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.11" data-path="../Android 图形系统/android-graphic-system-surfaceflinger-dump.html">
            
                <a href="../Android 图形系统/android-graphic-system-surfaceflinger-dump.html">
            
                    
                    Android SurfaceFlinger dump 信息分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.12" data-path="../Android 图形系统/android-graphic-system-vsync.html">
            
                <a href="../Android 图形系统/android-graphic-system-vsync.html">
            
                    
                    Android VSYNC 机制
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    Android 插件化
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../Android 插件化/open-source-android-plugins-small-sample.html">
            
                <a href="../Android 插件化/open-source-android-plugins-small-sample.html">
            
                    
                    Android 插件化框架Small解析--开始了解Small
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../Android 插件化/open-source-android-plugins-small-init.html">
            
                <a href="../Android 插件化/open-source-android-plugins-small-init.html">
            
                    
                    Android 插件化框架Small解析--初始化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../Android 插件化/open-source-android-plugins-small-principle.html">
            
                <a href="../Android 插件化/open-source-android-plugins-small-principle.html">
            
                    
                    Android 插件化框架Small解析--动态注册组件原理及启动插件Activity流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../Android 插件化/android-plugins-dynamic-load-demo.html">
            
                <a href="../Android 插件化/android-plugins-dynamic-load-demo.html">
            
                    
                    Android 插件化 -- 类的动态加载实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../Android 插件化/android-plugins-dynamic-load-source-code-analysis.html">
            
                <a href="../Android 插件化/android-plugins-dynamic-load-source-code-analysis.html">
            
                    
                    Android 插件化 -- ClassLoader 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../Android 插件化/open-source-android-plugins-small-dynamic-load-class.html">
            
                <a href="../Android 插件化/open-source-android-plugins-small-dynamic-load-class.html">
            
                    
                    Android 插件化框架Small解析 -- 类的动态加载源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../Android 插件化/android-plugins-dynamic-load-res-demo.html">
            
                <a href="../Android 插件化/android-plugins-dynamic-load-res-demo.html">
            
                    
                    Android 插件化 -- 资源的动态加载实践
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    Android 架构
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../Android 架构/android-architecture-mvc-mvp-mvvm.html">
            
                <a href="../Android 架构/android-architecture-mvc-mvp-mvvm.html">
            
                    
                    Android 架构 -- MVC、MVP 和 MVVP 架构浅析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../Android 架构/android-architecture-google-samples.html">
            
                <a href="../Android 架构/android-architecture-google-samples.html">
            
                    
                    Android 架构 android-architecture 简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../Android 架构/android-architecture-google-mvp-basic.html">
            
                <a href="../Android 架构/android-architecture-google-mvp-basic.html">
            
                    
                    Android 架构 android-architecture 之 mvp 介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" data-path="../Android 架构/android-architecture-components-jetpack.html">
            
                <a href="../Android 架构/android-architecture-components-jetpack.html">
            
                    
                    Android JetPack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.5" data-path="../Android 架构/android-architecture-components-room.html">
            
                <a href="../Android 架构/android-architecture-components-room.html">
            
                    
                    Android Architecture Components -- Room
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.6" data-path="../Android 架构/android-architecture-components-lifecycle.html">
            
                <a href="../Android 架构/android-architecture-components-lifecycle.html">
            
                    
                    Android Architecture Components -- LifeCycle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.7" data-path="../Android 架构/android-architecture-components-livedata.html">
            
                <a href="../Android 架构/android-architecture-components-livedata.html">
            
                    
                    Android Architecture Components -- LiveData
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.8" data-path="../Android 架构/android-architecture-components-viewmodel.html">
            
                <a href="../Android 架构/android-architecture-components-viewmodel.html">
            
                    
                    Android Architecture Components -- ViewModel
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    Android 消息机制
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../Android 消息机制/android-knowledge-message-system-source-code.html">
            
                <a href="../Android 消息机制/android-knowledge-message-system-source-code.html">
            
                    
                    Android 消息机制 -- 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="../Android 消息机制/android-knowledge-message-system-idlehandler-sample.html">
            
                <a href="../Android 消息机制/android-knowledge-message-system-idlehandler-sample.html">
            
                    
                    Android 消息机制 -- IdleHandler 的用法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
                <span>
            
                    
                    Android 线程
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../Android 线程/android-thread-handlerthread-source-code.html">
            
                <a href="../Android 线程/android-thread-handlerthread-source-code.html">
            
                    
                    Android 线程 -- HandlerThread 使用及源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../Android 线程/android-knowledge-intent-service-source-code.html">
            
                <a href="../Android 线程/android-knowledge-intent-service-source-code.html">
            
                    
                    Android 线程 -- IntentService 使用及源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="../Android 线程/android-thread-conditionvariable.html">
            
                <a href="../Android 线程/android-thread-conditionvariable.html">
            
                    
                    Android 线程 -- ConditionVariable 用法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" >
            
                <span>
            
                    
                    Android 组件
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../Android 组件/android-compnent-activitygroup.html">
            
                <a href="../Android 组件/android-compnent-activitygroup.html">
            
                    
                    Android 组件 -- ActivityGroup 简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="../Android 组件/android-knowledge-about-broadcast.html">
            
                <a href="../Android 组件/android-knowledge-about-broadcast.html">
            
                    
                    Android 组件 -- 广播
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="../Android 组件/android-knowledge-about-contentprovider.html">
            
                <a href="../Android 组件/android-knowledge-about-contentprovider.html">
            
                    
                    Android 组件 -- ContentProvider 使用以及源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="../Android 组件/android-knowledge-about-service.html">
            
                <a href="../Android 组件/android-knowledge-about-service.html">
            
                    
                    Android 组件 -- 关于 Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.5" data-path="../Android 组件/android-knowledge-about-foreground-service.html">
            
                <a href="../Android 组件/android-knowledge-about-foreground-service.html">
            
                    
                    Android 组件 -- 前台 Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" >
            
                <span>
            
                    
                    Android实用技巧
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="../Android实用技巧/android-development-skills-adb-logcat.html">
            
                <a href="../Android实用技巧/android-development-skills-adb-logcat.html">
            
                    
                    Android实用技巧之adb命令：logcat命令的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="../Android实用技巧/android-development-skills-dumpsys.html">
            
                <a href="../Android实用技巧/android-development-skills-dumpsys.html">
            
                    
                    Android实用技巧之adb命令：dumpsys命令的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="../Android实用技巧/android-development-skills-props.html">
            
                <a href="../Android实用技巧/android-development-skills-props.html">
            
                    
                    Android实用技巧之adb命令：getprop，setprop，watchprops命令的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4" data-path="../Android实用技巧/android-development-skills-adb-am.html">
            
                <a href="../Android实用技巧/android-development-skills-adb-am.html">
            
                    
                    Android实用技巧之adb命令：am 命令的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.5" data-path="../Android实用技巧/android-development-skills-adb-wm.html">
            
                <a href="../Android实用技巧/android-development-skills-adb-wm.html">
            
                    
                    Android实用技巧之adb命令：wm 命令的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.6" data-path="../Android实用技巧/android-development-skills-kill.html">
            
                <a href="../Android实用技巧/android-development-skills-kill.html">
            
                    
                    Android实用技巧之adb命令：kill 命令的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.7" data-path="../Android实用技巧/android-development-skills-device-info.html">
            
                <a href="../Android实用技巧/android-development-skills-device-info.html">
            
                    
                    Android 查看硬件信息命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.8" data-path="../Android实用技巧/android-development-skills-am-trace-ipc.html">
            
                <a href="../Android实用技巧/android-development-skills-am-trace-ipc.html">
            
                    
                    Android 查看 Binder 调用信息
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.9" data-path="../Android实用技巧/android-development-skills-surfacecontrolregistry.html">
            
                <a href="../Android实用技巧/android-development-skills-surfacecontrolregistry.html">
            
                    
                    Android 使用 SurfaceControlRegistry 查看 SurfaceControl 调用记录
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" >
            
                <span>
            
                    
                    Android开源项目
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="../Android开源项目/open-source-andfix-introduction.html">
            
                <a href="../Android开源项目/open-source-andfix-introduction.html">
            
                    
                    Android热修复之AndFix使用简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="../Android开源项目/open-source-andfix-source-code-analysis.html">
            
                <a href="../Android开源项目/open-source-andfix-source-code-analysis.html">
            
                    
                    Android热修复之AndFix源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3" data-path="../Android开源项目/open-source-lottie-android-introduction.html">
            
                <a href="../Android开源项目/open-source-lottie-android-introduction.html">
            
                    
                    开源项目- Lottie 简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.4" data-path="../Android开源项目/open-source-lottie-android-source-code-analysis.html">
            
                <a href="../Android开源项目/open-source-lottie-android-source-code-analysis.html">
            
                    
                    开源项目- Lottie 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.5" data-path="../Android开源项目/open-source-rxjava-guide-base.html">
            
                <a href="../Android开源项目/open-source-rxjava-guide-base.html">
            
                    
                    RxJava 使用指南 -- 基本概念、数据流创建和线程调度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.6" data-path="../Android开源项目/open-source-rxjava-guide-operator.html">
            
                <a href="../Android开源项目/open-source-rxjava-guide-operator.html">
            
                    
                    RxJava 使用指南 -- 操作符介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.7" data-path="../Android开源项目/open-source-rxjava-guide-flowable.html">
            
                <a href="../Android开源项目/open-source-rxjava-guide-flowable.html">
            
                    
                    RxJava 使用指南 -- Flowable 和 Subscriber
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.8" data-path="../Android开源项目/open-source-rxjava-single-completable-maybe.html">
            
                <a href="../Android开源项目/open-source-rxjava-single-completable-maybe.html">
            
                    
                    RxJava 使用指南 -- Single、Completable 和 Maybe 的用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.9" data-path="../Android开源项目/open-source-rxjava-event-bus.html">
            
                <a href="../Android开源项目/open-source-rxjava-event-bus.html">
            
                    
                    RxJava 使用指南 -- PublishSubject 实现事件总线
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10" data-path="../Android开源项目/open-source-retrofit-guide.html">
            
                <a href="../Android开源项目/open-source-retrofit-guide.html">
            
                    
                    Retrofit 2 使用指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.11" data-path="../Android开源项目/open-source-retrofit-source-code-analysis-start.html">
            
                <a href="../Android开源项目/open-source-retrofit-source-code-analysis-start.html">
            
                    
                    Retrofit 2 源码分析 -- 启动篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.12" data-path="../Android开源项目/open-source-retrofit-source-code-analysis-request.html">
            
                <a href="../Android开源项目/open-source-retrofit-source-code-analysis-request.html">
            
                    
                    Retrofit 2 源码分析一 -- 数据请求流程解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.13" data-path="../Android开源项目/open-source-retrofit-source-code-analysis-rxjava.html">
            
                <a href="../Android开源项目/open-source-retrofit-source-code-analysis-rxjava.html">
            
                    
                    Retrofit 2 源码分析二 -- RxJava2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.14" data-path="../Android开源项目/open-source-eventbus-guide-base.html">
            
                <a href="../Android开源项目/open-source-eventbus-guide-base.html">
            
                    
                    EventBus -- 基本用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.15" data-path="../Android开源项目/open-source-eventbus-source-code.html">
            
                <a href="../Android开源项目/open-source-eventbus-source-code.html">
            
                    
                    EventBus -- 源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.16" data-path="../Android开源项目/open-source-sqlbrite.html">
            
                <a href="../Android开源项目/open-source-sqlbrite.html">
            
                    
                    SqlBrite 使用指南和源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.17" data-path="../Android开源项目/open-source-okhttp-usage.html">
            
                <a href="../Android开源项目/open-source-okhttp-usage.html">
            
                    
                    OkHttp 使用指南 -- 基本使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.18" data-path="../Android开源项目/open-source-okhttp-workflow.html">
            
                <a href="../Android开源项目/open-source-okhttp-workflow.html">
            
                    
                    OkHttp 源码分析 -- 基本流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.19" data-path="../Android开源项目/open-source-okhttp-interceptor.html">
            
                <a href="../Android开源项目/open-source-okhttp-interceptor.html">
            
                    
                    OkHttp 源码分析 -- 拦截器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.20" data-path="../Android开源项目/open-source-okhttp-dispatcher-task-queue.html">
            
                <a href="../Android开源项目/open-source-okhttp-dispatcher-task-queue.html">
            
                    
                    OkHttp 源码分析 -- 任务队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.21" data-path="../Android开源项目/open-source-okhttp-cache.html">
            
                <a href="../Android开源项目/open-source-okhttp-cache.html">
            
                    
                    OkHttp 源码分析 -- 缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.22" data-path="../Android开源项目/open-source-okhttp-websocket.html">
            
                <a href="../Android开源项目/open-source-okhttp-websocket.html">
            
                    
                    OkHttp 源码分析 -- WebSocket 实现原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.23" data-path="../Android开源项目/open-source-okhttp-connect-pool.html">
            
                <a href="../Android开源项目/open-source-okhttp-connect-pool.html">
            
                    
                    OkHttp 源码分析 -- 连接池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.24" data-path="../Android开源项目/open-source-dagger2-baisc.html">
            
                <a href="../Android开源项目/open-source-dagger2-baisc.html">
            
                    
                    Dagger2 的基本使用和原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.25" data-path="../Android开源项目/open-source-dagger2-advance.html">
            
                <a href="../Android开源项目/open-source-dagger2-advance.html">
            
                    
                    Dagger2 进阶
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" >
            
                <span>
            
                    
                    Android性能优化
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.1" data-path="../Android性能优化/android-performance-optimization-article-summary.html">
            
                <a href="../Android性能优化/android-performance-optimization-article-summary.html">
            
                    
                    Android 性能优化文章汇总
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2" data-path="../Android性能优化/android-performance-optimization-toast-badtoken.html">
            
                <a href="../Android性能优化/android-performance-optimization-toast-badtoken.html">
            
                    
                    Android 性能优化实战篇 -- 解决 Toast BadTokenException 异常
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3" data-path="../Android性能优化/android-performance-optimization-privateflags-crash.html">
            
                <a href="../Android性能优化/android-performance-optimization-privateflags-crash.html">
            
                    
                    Android 性能优化实战篇 -- 解决 'int android.view.View.mPrivateFlags' NullPointerException
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4" data-path="../Android性能优化/android-performance-optimization-crash-handler.html">
            
                <a href="../Android性能优化/android-performance-optimization-crash-handler.html">
            
                    
                    Android 性能优化实战篇 -- 使用 CrashHandler 处理崩溃问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5" data-path="../Android性能优化/android-performance-optimization-sp.html">
            
                <a href="../Android性能优化/android-performance-optimization-sp.html">
            
                    
                    Android 性能优化理论篇 -- SharedPreference 使用优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6" data-path="../Android性能优化/android-performance-optimization-rotate-screen.html">
            
                <a href="../Android性能优化/android-performance-optimization-rotate-screen.html">
            
                    
                    Android 性能优化实战篇 -- 旋转屏幕优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.7" data-path="../Android性能优化/android-code-optimization-tools-link.html">
            
                <a href="../Android性能优化/android-code-optimization-tools-link.html">
            
                    
                    Android 代码优化工具篇 -- 静态代码检测工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.8" data-path="../Android性能优化/android-performance-optimization-apk-analyzer.html">
            
                <a href="../Android性能优化/android-performance-optimization-apk-analyzer.html">
            
                    
                    Android 性能优化工具篇 -- APK Analyzer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.9" data-path="../Android性能优化/android-performance-optimization-reduce-apk-size.html">
            
                <a href="../Android性能优化/android-performance-optimization-reduce-apk-size.html">
            
                    
                    Android 性能优化实战篇 -- APK 瘦身
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.10" data-path="../Android性能优化/android-performance-optimization-anr.html">
            
                <a href="../Android性能优化/android-performance-optimization-anr.html">
            
                    
                    Android 性能优化理论篇 -- ANR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.11" data-path="../Android性能优化/android-performance-optimization-anr-1.html">
            
                <a href="../Android性能优化/android-performance-optimization-anr-1.html">
            
                    
                    Android 性能优化实战篇 -- ANR 问题分析1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.12" data-path="../Android性能优化/android-performance-optimization-anr-2.html">
            
                <a href="../Android性能优化/android-performance-optimization-anr-2.html">
            
                    
                    Android 性能优化实战篇 -- ANR 问题分析2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.13" data-path="../Android性能优化/android-performance-optimization-include-merge-viewstubs.md">
            
                <span>
            
                    
                    Android 性能优化理论篇 -- 布局优化三剑客include、merge、ViewStub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.14" data-path="../Android性能优化/android-performance-optimization-tools-leak-canary.html">
            
                <a href="../Android性能优化/android-performance-optimization-tools-leak-canary.html">
            
                    
                    Android 性能优化工具篇 -- LeakCanary 检测内存泄漏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.15" data-path="../Android性能优化/android-performance-optimization-use-mat-to-analyse-leak.html">
            
                <a href="../Android性能优化/android-performance-optimization-use-mat-to-analyse-leak.html">
            
                    
                    Android 性能优化工具篇 -- MAT分析内存泄漏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.16" data-path="../Android性能优化/android-performance-optimization-traceview.html">
            
                <a href="../Android性能优化/android-performance-optimization-traceview.html">
            
                    
                    Android 性能优化工具篇 -- TraceView的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.17" data-path="../Android性能优化/android-performance-optimization-reasons-fo-memory-leak.html">
            
                <a href="../Android性能优化/android-performance-optimization-reasons-fo-memory-leak.html">
            
                    
                    Android 性能优化理论篇 -- 内存泄漏的几种情形
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.18" data-path="../Android性能优化/android-performance-optimization-reduce-ram.html">
            
                <a href="../Android性能优化/android-performance-optimization-reduce-ram.html">
            
                    
                    Android 性能优化理论篇 -- 内存优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.19" data-path="../Android性能优化/android-performance-optimization-memory.html">
            
                <a href="../Android性能优化/android-performance-optimization-memory.html">
            
                    
                    Android 性能优化实战篇 -- 内存优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.20" data-path="../Android性能优化/android-performance-optimization-tools-ram-analysis.html">
            
                <a href="../Android性能优化/android-performance-optimization-tools-ram-analysis.html">
            
                    
                    Android 性能优化工具篇 -- 内存查看和分析工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.21" data-path="../Android性能优化/android-performance-optimization-profiler-leak.html">
            
                <a href="../Android性能优化/android-performance-optimization-profiler-leak.html">
            
                    
                    Android 性能优化工具篇 -- Android Profiler 分析内存使用和内存泄漏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.22" data-path="../Android性能优化/android-performance-optimization-tools-simpleperf.html">
            
                <a href="../Android性能优化/android-performance-optimization-tools-simpleperf.html">
            
                    
                    Android 卡顿优化工具篇 -- SimplePerf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.23" data-path="../Android性能优化/android-performance-optimization-tools-perfetto.html">
            
                <a href="../Android性能优化/android-performance-optimization-tools-perfetto.html">
            
                    
                    Android 卡顿优化工具篇 -- Perfetto 的使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20" >
            
                <span>
            
                    
                    Android源码分析
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.20.1" data-path="android-source-code-analysis-package-manager-init.html">
            
                <a href="android-source-code-analysis-package-manager-init.html">
            
                    
                    Android PackageManager相关源码分析之PMS初始化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2" data-path="android-source-code-analysis-package-manager-installation.html">
            
                <a href="android-source-code-analysis-package-manager-installation.html">
            
                    
                    Android PackageManager相关源码分析之安装应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.3" data-path="android-source-code-analysis-package-manager-uninstallation.html">
            
                <a href="android-source-code-analysis-package-manager-uninstallation.html">
            
                    
                    Android PackageManager相关源码分析之卸载应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.4" data-path="android-source-code-analysis-package-manager-installd.html">
            
                <a href="android-source-code-analysis-package-manager-installd.html">
            
                    
                    Android PackageManager相关源码分析之installd进程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.5" data-path="android-source-code-analysis-ams-app-ipc.html">
            
                <a href="android-source-code-analysis-ams-app-ipc.html">
            
                    
                    Android AMS 与 APP 进程通信
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.20.6" data-path="android-source-code-analysis-activity-start-process.html">
            
                <a href="android-source-code-analysis-activity-start-process.html">
            
                    
                    Android startActivity 流程分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.7" data-path="android-source-code-analysis-usermanager.html">
            
                <a href="android-source-code-analysis-usermanager.html">
            
                    
                    Android UserManager相关源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.8" data-path="android-source-code-analysis-dumpsys.html">
            
                <a href="android-source-code-analysis-dumpsys.html">
            
                    
                    Android 深入理解 dumpsys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.9" data-path="android-source-code-analysis-toast.html">
            
                <a href="android-source-code-analysis-toast.html">
            
                    
                    Android Toast 源码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.21" >
            
                <span>
            
                    
                    Flutter
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.21.1" data-path="../Flutter/flutter-summary-learning-materials.html">
            
                <a href="../Flutter/flutter-summary-learning-materials.html">
            
                    
                    Flutter -- 初步了解和学习资料
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21.2" data-path="../Flutter/flutter-gank-app.html">
            
                <a href="../Flutter/flutter-gank-app.html">
            
                    
                    Flutter -- 开发 Gank 客户端
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.22" >
            
                <span>
            
                    
                    Gradle
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.22.1" data-path="../Gradle/development-tool-gradle-study-materials.html">
            
                <a href="../Gradle/development-tool-gradle-study-materials.html">
            
                    
                    Gradle 使用指南 -- 资料汇总
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.2" data-path="../Gradle/development-tool-gradle-command-config.html">
            
                <a href="../Gradle/development-tool-gradle-command-config.html">
            
                    
                    Gradle 使用指南 -- 基础配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.3" data-path="../Gradle/development-tool-gradle-android-dsl-extension.html">
            
                <a href="../Gradle/development-tool-gradle-android-dsl-extension.html">
            
                    
                    Gradle 使用指南 -- Android DSL 扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.4" data-path="../Gradle/development-tool-gradle-task.html">
            
                <a href="../Gradle/development-tool-gradle-task.html">
            
                    
                    Gradle 使用指南 -- Gradle Task
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.5" data-path="../Gradle/development-tool-gradle-extra-properties.html">
            
                <a href="../Gradle/development-tool-gradle-extra-properties.html">
            
                    
                    Gradle 使用指南 -- Extra Properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.6" data-path="../Gradle/development-tool-gradle-lifecycle.html">
            
                <a href="../Gradle/development-tool-gradle-lifecycle.html">
            
                    
                    Gradle 使用指南 -- Gradle 生命周期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.7" data-path="../Gradle/development-tool-gradle-customized-plugin.html">
            
                <a href="../Gradle/development-tool-gradle-customized-plugin.html">
            
                    
                    Gradle 使用指南 -- Plugin 的使用和创建 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.8" data-path="../Gradle/development-tool-gradle-customized-plugin-dsl-extension.html">
            
                <a href="../Gradle/development-tool-gradle-customized-plugin-dsl-extension.html">
            
                    
                    Gradle 使用指南 -- Plugin DSL 扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.9" data-path="../Gradle/development-tool-gradle-groovy-basic.html">
            
                <a href="../Gradle/development-tool-gradle-groovy-basic.html">
            
                    
                    Groovy 教程系列（一）-- Groovy 入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.10" data-path="../Gradle/development-tool-gradle-command-line.html">
            
                <a href="../Gradle/development-tool-gradle-command-line.html">
            
                    
                    Gradle 使用指南 -- 玩转命令行
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.11" data-path="../Gradle/development-tool-gradle-skills.html">
            
                <a href="../Gradle/development-tool-gradle-skills.html">
            
                    
                    Gradle 使用指南 -- 一些小技巧
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.12" data-path="../Gradle/development-tool-gradle-plugin-debug.html">
            
                <a href="../Gradle/development-tool-gradle-plugin-debug.html">
            
                    
                    Gradle 使用指南 -- Plugin 断点调试
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.23" >
            
                <span>
            
                    
                    博客搭建
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.23.1" data-path="../博客搭建/blog-use-hexo-to-build-blog.html">
            
                <a href="../博客搭建/blog-use-hexo-to-build-blog.html">
            
                    
                    Hexo+GitHub搭建个人博客
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23.2" data-path="../博客搭建/blog-hexo-optimize.html">
            
                <a href="../博客搭建/blog-hexo-optimize.html">
            
                    
                    Hexo博客配置优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23.3" data-path="../博客搭建/blog-optimize-next-theme.html">
            
                <a href="../博客搭建/blog-optimize-next-theme.html">
            
                    
                    Hexo--Next主题优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23.4" data-path="../博客搭建/blog-use-gitbook-to-build-blog.html">
            
                <a href="../博客搭建/blog-use-gitbook-to-build-blog.html">
            
                    
                    Gitbook 博客搭建
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.24" >
            
                <span>
            
                    
                    Java
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.24.1" data-path="../Java/java-basic-map-collection.html">
            
                <a href="../Java/java-basic-map-collection.html">
            
                    
                    Java 基础 -- 集合的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.2" data-path="../Java/java-basic-arrays-collections.html">
            
                <a href="../Java/java-basic-arrays-collections.html">
            
                    
                    Java 基础 -- 算法类 Arrays 和 Collections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.3" data-path="../Java/java-basic-arraylist.html">
            
                <a href="../Java/java-basic-arraylist.html">
            
                    
                    Java 基础 -- ArrayList 的使用和原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.4" data-path="../Java/java-basic-enum.html">
            
                <a href="../Java/java-basic-enum.html">
            
                    
                    Java 基础 -- enum
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.5" data-path="../Java/java-basic-hashmap.html">
            
                <a href="../Java/java-basic-hashmap.html">
            
                    
                    Java 基础 -- HashMap 的使用和原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.6" data-path="../Java/java-basic-linkedhashmap.html">
            
                <a href="../Java/java-basic-linkedhashmap.html">
            
                    
                    Java 基础 -- LinkedHashMap 的使用和原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.7" data-path="../Java/java-basic-knowledge-about-string.html">
            
                <a href="../Java/java-basic-knowledge-about-string.html">
            
                    
                    Java 基础 -- 深入理解 String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.8" data-path="../Java/java-basic-stringbuilder-stringbuffer.html">
            
                <a href="../Java/java-basic-stringbuilder-stringbuffer.html">
            
                    
                    Java 基础 -- StringBuilder 和 StringBuffer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.9" data-path="../Java/java-basic-knowledge-parameter-passing.html">
            
                <a href="../Java/java-basic-knowledge-parameter-passing.html">
            
                    
                    Java 基础 -- 值传递、引用传递和参数传递
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.10" data-path="../Java/java-basic-knowledge-auto-boxing.html">
            
                <a href="../Java/java-basic-knowledge-auto-boxing.html">
            
                    
                    Java 基础 -- 关于自动装箱和拆箱机制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.11" data-path="../Java/java-basic-knowledge-generic.html">
            
                <a href="../Java/java-basic-knowledge-generic.html">
            
                    
                    Java 基础 -- 范型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.12" data-path="../Java/java-basic-memory-manage-variable.html">
            
                <a href="../Java/java-basic-memory-manage-variable.html">
            
                    
                    Java 内存管理 -- 变量的内存管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.13" data-path="../Java/java-basic-memory-manage-memory-area.html">
            
                <a href="../Java/java-basic-memory-manage-memory-area.html">
            
                    
                    Java 内存管理 -- 内存区域的划分
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.14" data-path="../Java/java-basic-memory-manage-inherit-object.html">
            
                <a href="../Java/java-basic-memory-manage-inherit-object.html">
            
                    
                    Java 内存管理 -- 构造方法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.15" data-path="../Java/java-basic-memory-manage-constructor.html">
            
                <a href="../Java/java-basic-memory-manage-constructor.html">
            
                    
                    Java 内存管理 -- 父子实例的内存控制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.16" data-path="../Java/java-basic-final.html">
            
                <a href="../Java/java-basic-final.html">
            
                    
                    Java 基础 -- 深入理解 final 修饰符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.17" data-path="../Java/java-io-stream-base.html">
            
                <a href="../Java/java-io-stream-base.html">
            
                    
                    Java IO -- IO流的概念和分类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.18" data-path="../Java/java-basic-reflect.html">
            
                <a href="../Java/java-basic-reflect.html">
            
                    
                    Java 基础 -- 反射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.19" data-path="../Java/java-basic-try-catch-finally.html">
            
                <a href="../Java/java-basic-try-catch-finally.html">
            
                    
                    Java 基础 -- 深入理解 try catch finally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.20" data-path="../Java/java-dynamic-proxy-invocationhandler-demo.html">
            
                <a href="../Java/java-dynamic-proxy-invocationhandler-demo.html">
            
                    
                    Java InvocationHandler 实现动态代理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.21" data-path="../Java/java-basic-concurrent-map-collection.html">
            
                <a href="../Java/java-basic-concurrent-map-collection.html">
            
                    
                    Java 基础 -- 并发集合的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.22" data-path="../Java/java-development-skills-get-stacktrace.html">
            
                <a href="../Java/java-development-skills-get-stacktrace.html">
            
                    
                    Java 开发技巧 -- 获取 Java 的调用栈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.23" data-path="../Java/java-basic-threadlocal.html">
            
                <a href="../Java/java-basic-threadlocal.html">
            
                    
                    Java 基础 -- ThreadLocal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.24" data-path="../Java/java-basic-annotation.html">
            
                <a href="../Java/java-basic-annotation.html">
            
                    
                    Java 基础 -- 注解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24.25" data-path="../Java/java-basic-joor.html">
            
                <a href="../Java/java-basic-joor.html">
            
                    
                    Java 基础 -- 使用 JOOR 实现反射
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.25" >
            
                <span>
            
                    
                    Java 并发
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.25.1" data-path="../Java 并发/java-thread-how-to-create-thread.html">
            
                <a href="../Java 并发/java-thread-how-to-create-thread.html">
            
                    
                    Java 并发编程 -- 创建和使用线程 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.2" data-path="../Java 并发/java-concurrent-volatile.html">
            
                <a href="../Java 并发/java-concurrent-volatile.html">
            
                    
                    Java 并发编程 -- volatile 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.3" data-path="../Java 并发/java-thread-kinds-of-lock.html">
            
                <a href="../Java 并发/java-thread-kinds-of-lock.html">
            
                    
                    Java 并发编程 -- 锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.4" data-path="../Java 并发/java-thread-how-to-use-synchronized.html">
            
                <a href="../Java 并发/java-thread-how-to-use-synchronized.html">
            
                    
                    Java 并发编程 -- synchronized、wait、notify和notifyAll的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.5" data-path="../Java 并发/java-concurrent-interface-lock.html">
            
                <a href="../Java 并发/java-concurrent-interface-lock.html">
            
                    
                    Java 并发编程 -- Lock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.6" data-path="../Java 并发/java-thread-how-to-use-reentrantlock.html">
            
                <a href="../Java 并发/java-thread-how-to-use-reentrantlock.html">
            
                    
                    Java 并发编程 -- ReentrantLock 与 Condition 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.7" data-path="../Java 并发/java-thread-how-to-use-countdownlatch.html">
            
                <a href="../Java 并发/java-thread-how-to-use-countdownlatch.html">
            
                    
                    Java 并发编程 -- CountDownLatch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.8" data-path="../Java 并发/java-thread-how-to-use-cyclicbarrier.html">
            
                <a href="../Java 并发/java-thread-how-to-use-cyclicbarrier.html">
            
                    
                    Java 并发编程 -- CyclicBarrier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.9" data-path="../Java 并发/java-thread-how-to-use-semaphore.html">
            
                <a href="../Java 并发/java-thread-how-to-use-semaphore.html">
            
                    
                    Java 并发编程 -- Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.10" data-path="../Java 并发/java-thread-how-to-use-exchanger.html">
            
                <a href="../Java 并发/java-thread-how-to-use-exchanger.html">
            
                    
                    Java 并发编程 -- Exchanger
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.11" data-path="../Java 并发/java-thread-thread-pool-basic.html">
            
                <a href="../Java 并发/java-thread-thread-pool-basic.html">
            
                    
                    Java 线程池 -- 线程池基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.12" data-path="../Java 并发/java-thread-sourcecode-of-threadpoolexecutor.html">
            
                <a href="../Java 并发/java-thread-sourcecode-of-threadpoolexecutor.html">
            
                    
                    Java 线程池 -- ThreadPoolExecutor 源码解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.13" data-path="../Java 并发/java-thread-how-to-use-threadpoolexecutor.html">
            
                <a href="../Java 并发/java-thread-how-to-use-threadpoolexecutor.html">
            
                    
                    Java 线程池 -- ThreadPoolExecutor 使用以及优化攻略
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.14" data-path="../Java 并发/java-concurrent-java-memory-model.html">
            
                <a href="../Java 并发/java-concurrent-java-memory-model.html">
            
                    
                    Java 并发编程 -- 内存模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25.15" data-path="../Java 并发/java-concurrent-fork-join-base.html">
            
                <a href="../Java 并发/java-concurrent-fork-join-base.html">
            
                    
                    Java 并发编程 -- Fork/Join 框架 
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.26" >
            
                <span>
            
                    
                    JavaScript
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.26.1" data-path="../JavaScript/javascript-basic-start-part.html">
            
                <a href="../JavaScript/javascript-basic-start-part.html">
            
                    
                    JavaScript -- 启动篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.2" data-path="../JavaScript/javascript-basic-object.html">
            
                <a href="../JavaScript/javascript-basic-object.html">
            
                    
                    JavaScritp 基础 -- 类和对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.3" data-path="../JavaScript/javascript-basic-function.html">
            
                <a href="../JavaScript/javascript-basic-function.html">
            
                    
                    JavaScript 基础 -- 函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.4" data-path="../JavaScript/javascript-basic-export-import.html">
            
                <a href="../JavaScript/javascript-basic-export-import.html">
            
                    
                    JavaScript 基础 -- export 和 import
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.5" data-path="../JavaScript/javascript-basic-promise.html">
            
                <a href="../JavaScript/javascript-basic-promise.html">
            
                    
                    JavaScript 基础 -- Promise
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.6" data-path="../JavaScript/javascript-basic-async.html">
            
                <a href="../JavaScript/javascript-basic-async.html">
            
                    
                    JavaScript 基础 -- async/await 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.7" data-path="../JavaScript/javascript-vue-gank-web-app.html">
            
                <a href="../JavaScript/javascript-vue-gank-web-app.html">
            
                    
                    Vue -- 开发 Gank Web App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.8" data-path="../JavaScript/vue-start.html">
            
                <a href="../JavaScript/vue-start.html">
            
                    
                    Vue -- 启动篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.9" data-path="../JavaScript/vue-components-communication.html">
            
                <a href="../JavaScript/vue-components-communication.html">
            
                    
                    Vue -- 封装组件及通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26.10" data-path="../JavaScript/vue-network-api.html">
            
                <a href="../JavaScript/vue-network-api.html">
            
                    
                    Vue -- 网络请求
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.27" >
            
                <span>
            
                    
                    Kotlin
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.27.1" data-path="../Kotlin/kotlin-brief-introduction.html">
            
                <a href="../Kotlin/kotlin-brief-introduction.html">
            
                    
                    Kotlin -- 简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.2" data-path="../Kotlin/kotlin-keyword.html">
            
                <a href="../Kotlin/kotlin-keyword.html">
            
                    
                    Kotlin -- 关键字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.3" data-path="../Kotlin/kotlin-class-object.html">
            
                <a href="../Kotlin/kotlin-class-object.html">
            
                    
                    Kotlin -- 类和对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.4" data-path="../Kotlin/kotlin-interface.html">
            
                <a href="../Kotlin/kotlin-interface.html">
            
                    
                    Kotlin -- 接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.5" data-path="../Kotlin/kotlin-lambda.html">
            
                <a href="../Kotlin/kotlin-lambda.html">
            
                    
                    Kotlin -- Lambda 表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.6" data-path="../Kotlin/kotlin-advance-function.html">
            
                <a href="../Kotlin/kotlin-advance-function.html">
            
                    
                    Kotlin -- 高阶函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.7" data-path="../Kotlin/kotlin-coroutines.html">
            
                <a href="../Kotlin/kotlin-coroutines.html">
            
                    
                    Kotlin -- 协程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.8" data-path="../Kotlin/kotlin-coroutines-async.html">
            
                <a href="../Kotlin/kotlin-coroutines-async.html">
            
                    
                    Kotlin -- 异步操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.9" data-path="../Kotlin/kotlin-set-list-api.html">
            
                <a href="../Kotlin/kotlin-set-list-api.html">
            
                    
                    Kotlin -- 集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.10" data-path="../Kotlin/kotlin-generics.html">
            
                <a href="../Kotlin/kotlin-generics.html">
            
                    
                    Kotlin -- 泛型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27.11" data-path="../Kotlin/kotlin-flow.html">
            
                <a href="../Kotlin/kotlin-flow.html">
            
                    
                    Kotlin -- Flow
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.28" >
            
                <span>
            
                    
                    OpenGL
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.28.1" data-path="../OpenGL/opengl-es-basic-knowledge.html">
            
                <a href="../OpenGL/opengl-es-basic-knowledge.html">
            
                    
                    OpenGL ES -- 基础知识
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28.2" data-path="../OpenGL/opengl-es-basic-render.html">
            
                <a href="../OpenGL/opengl-es-basic-render.html">
            
                    
                    OpenGL ES -- 基础绘制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28.3" data-path="../OpenGL/opengl-es-texture.html">
            
                <a href="../OpenGL/opengl-es-texture.html">
            
                    
                    OpenGL ES -- 纹理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28.4" data-path="../OpenGL/opengl-es-smoonth-shade.html">
            
                <a href="../OpenGL/opengl-es-smoonth-shade.html">
            
                    
                    OpenGL ES -- 平滑着色
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28.5" data-path="../OpenGL/opengl-es-view-port-resize.html">
            
                <a href="../OpenGL/opengl-es-view-port-resize.html">
            
                    
                    OpenGL ES -- 调整屏幕宽高比
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28.6" data-path="../OpenGL/opengl-es-color-blend.html">
            
                <a href="../OpenGL/opengl-es-color-blend.html">
            
                    
                    OpenGL ES -- 混合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28.7" data-path="../OpenGL/opengl-es-image-effect.html">
            
                <a href="../OpenGL/opengl-es-image-effect.html">
            
                    
                    OpenGL ES -- 图像处理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.29" >
            
                <span>
            
                    
                    Python
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.29.1" data-path="../Python/python-practice-web-crawler-iqiyi.html">
            
                <a href="../Python/python-practice-web-crawler-iqiyi.html">
            
                    
                    Python实战 -- 网络爬虫之解析爱奇艺视频
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.30" >
            
                <span>
            
                    
                    React Native
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.30.1" data-path="../React Native/react-native-begin-to-study.html">
            
                <a href="../React Native/react-native-begin-to-study.html">
            
                    
                    开始了解React Native
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30.2" data-path="../React Native/react-native-build-development-environment.html">
            
                <a href="../React Native/react-native-build-development-environment.html">
            
                    
                    搭建 React Native 开发环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30.3" data-path="../React Native/react-native-first-step.html">
            
                <a href="../React Native/react-native-first-step.html">
            
                    
                    React Native 入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30.4" data-path="../React Native/react-native-component.html">
            
                <a href="../React Native/react-native-component.html">
            
                    
                    React Native-组件Component
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30.5" data-path="../React Native/react-native-image.html">
            
                <a href="../React Native/react-native-image.html">
            
                    
                    React Native-Image控件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30.6" data-path="../React Native/react-native-flexbox.html">
            
                <a href="../React Native/react-native-flexbox.html">
            
                    
                    React Native-flexbox
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30.7" data-path="../React Native/react-native-integration-with-existing-apps.html">
            
                <a href="../React Native/react-native-integration-with-existing-apps.html">
            
                    
                    Android项目中集成React Native
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30.8" data-path="../React Native/react-native-native-modules.html">
            
                <a href="../React Native/react-native-native-modules.html">
            
                    
                    React Native创建原生模块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30.9" data-path="../React Native/react-native-native-ui-component.html">
            
                <a href="../React Native/react-native-native-ui-component.html">
            
                    
                    React Native封装原生UI组件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.31" >
            
                <span>
            
                    
                    V8
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.31.1" data-path="../V8/open-source-j2v8-getting-started.html">
            
                <a href="../V8/open-source-j2v8-getting-started.html">
            
                    
                    J2V8 -- 开始使用J2V8
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.31.2" data-path="../V8/open-source-j2v8-registerting-java-callback.html">
            
                <a href="../V8/open-source-j2v8-registerting-java-callback.html">
            
                    
                    J2V8 -- 注册 Java 回调函数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.32" >
            
                <span>
            
                    
                    Web Server
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.32.1" data-path="../Web Server/web-server-maven-spring-mvc-new-project.html">
            
                <a href="../Web Server/web-server-maven-spring-mvc-new-project.html">
            
                    
                    服务端开发入门 -- 使用 Intellij IDEA 创建 Maven + SpringMVC 项目
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.33" >
            
                <span>
            
                    
                    Weex
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.33.1" data-path="../Weex/open-source-weex-android-introduction.html">
            
                <a href="../Weex/open-source-weex-android-introduction.html">
            
                    
                    Weex 源码研究 -- 序言
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33.2" data-path="../Weex/open-source-weex-android-classes-introduction.html">
            
                <a href="../Weex/open-source-weex-android-classes-introduction.html">
            
                    
                    Weex 源码研究 -- 相关类概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33.3" data-path="../Weex/open-source-weex-android-init.html">
            
                <a href="../Weex/open-source-weex-android-init.html">
            
                    
                    Weex 源码研究 -- 初始化过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33.4" data-path="../Weex/open-source-weex-android-component-module-register.html">
            
                <a href="../Weex/open-source-weex-android-component-module-register.html">
            
                    
                    Weex 源码研究 -- Component 和 DomObject 注册过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33.5" data-path="../Weex/open-source-weex-android-component-render.html">
            
                <a href="../Weex/open-source-weex-android-component-render.html">
            
                    
                    Weex 源码研究 -- 渲染过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33.6" data-path="../Weex/open-source-weex-android-module-register-callback.html">
            
                <a href="../Weex/open-source-weex-android-module-register-callback.html">
            
                    
                    Weex 源码研究 -- Module 注册、调用和回调函数的执行流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33.7" data-path="../Weex/open-source-weex-android-event-reponse.html">
            
                <a href="../Weex/open-source-weex-android-event-reponse.html">
            
                    
                    Weex 源码研究 -- 事件响应流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.34" >
            
                <span>
            
                    
                    cocos
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.34.1" data-path="../cocos/cocos-creator-start.html">
            
                <a href="../cocos/cocos-creator-start.html">
            
                    
                    Cocos Creator -- 启动篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.2" data-path="../cocos/cocos-creator-hello-world-project.html">
            
                <a href="../cocos/cocos-creator-hello-world-project.html">
            
                    
                    Cocos Creator -- HelloWorld 工程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.3" data-path="../cocos/cocos-creator-jsb-manu-extend.html">
            
                <a href="../cocos/cocos-creator-jsb-manu-extend.html">
            
                    
                    Cocos Creator -- JSB 手动绑定扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.4" data-path="../cocos/cocos-creator-javascript-java.html">
            
                <a href="../cocos/cocos-creator-javascript-java.html">
            
                    
                    Cocos Creator -- JavaScript 和 Java 互相调用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.5" data-path="../cocos/cocos-creator-native-engine-init-process.html">
            
                <a href="../cocos/cocos-creator-native-engine-init-process.html">
            
                    
                    Cocos Creator -- JSB 引擎初始化流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.6" data-path="../cocos/cocos-creator-native-game-file-load.html">
            
                <a href="../cocos/cocos-creator-native-game-file-load.html">
            
                    
                    Cocos Creator -- JSB 游戏文件加载流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.7" data-path="../cocos/cocos-creator-native-game-start-process.html">
            
                <a href="../cocos/cocos-creator-native-game-start-process.html">
            
                    
                    Cocos Creator -- JSB 游戏启动运行流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.8" data-path="../cocos/cocos-creator-res-load.html">
            
                <a href="../cocos/cocos-creator-res-load.html">
            
                    
                    Cocos Creator -- 资源文件加载流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.9" data-path="../cocos/cocos-creator-native-render-process.html">
            
                <a href="../cocos/cocos-creator-native-render-process.html">
            
                    
                    Cocos Creator -- JSB 游戏渲染流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.10" data-path="../cocos/cocos-creator-web-render-process.html">
            
                <a href="../cocos/cocos-creator-web-render-process.html">
            
                    
                    Cocos Creator -- Web游戏渲染流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.11" data-path="../cocos/cocos-creator-edit-box-source-code.html">
            
                <a href="../cocos/cocos-creator-edit-box-source-code.html">
            
                    
                    Cocos Creator -- EditBox 实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34.12" data-path="../cocos/cocos-creator-jsb-event-dispatch.html">
            
                <a href="../cocos/cocos-creator-jsb-event-dispatch.html">
            
                    
                    Cocos Creator -- JSB 事件分发机制源码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.35" >
            
                <span>
            
                    
                    设计模式
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.35.1" data-path="../设计模式/java-basic-design-pattern-singleton.html">
            
                <a href="../设计模式/java-basic-design-pattern-singleton.html">
            
                    
                    Java 设计模式 -- 单例模式的几种实现
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.35.2" data-path="../设计模式/java-basic-design-pattern-factory-method.html">
            
                <a href="../设计模式/java-basic-design-pattern-factory-method.html">
            
                    
                    Java 设计模式 -- 工厂方法模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.35.3" data-path="../设计模式/java-basic-design-pattern-abstract-factory.html">
            
                <a href="../设计模式/java-basic-design-pattern-abstract-factory.html">
            
                    
                    Java 设计模式 -- 抽象工厂模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.35.4" data-path="../设计模式/java-basic-design-pattern-chain-of-responsibility.html">
            
                <a href="../设计模式/java-basic-design-pattern-chain-of-responsibility.html">
            
                    
                    Java 设计模式 -- 职责链模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.35.5" data-path="../设计模式/java-basic-design-pattern-template-method.html">
            
                <a href="../设计模式/java-basic-design-pattern-template-method.html">
            
                    
                    Java 设计模式 -- 模板方法模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.36" >
            
                <span>
            
                    
                    学习资料
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.36.1" data-path="../学习资料/materials-programmer-materials.html">
            
                <a href="../学习资料/materials-programmer-materials.html">
            
                    
                    程序员学习资料汇总
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.37" >
            
                <span>
            
                    
                    开发工具
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.37.1" data-path="../开发工具/development-tool-git-command.html">
            
                <a href="../开发工具/development-tool-git-command.html">
            
                    
                    Git 常用命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37.2" data-path="../开发工具/development-tool-android-studio-debug-skill.html">
            
                <a href="../开发工具/development-tool-android-studio-debug-skill.html">
            
                    
                    Android Studio 使用技巧
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37.3" data-path="../开发工具/development-tool-import-source-to-android-studio.html">
            
                <a href="../开发工具/development-tool-import-source-to-android-studio.html">
            
                    
                    Android Studio 导入 Android 源码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37.4" data-path="../开发工具/development-tool-markdown-plant-uml.html">
            
                <a href="../开发工具/development-tool-markdown-plant-uml.html">
            
                    
                    Markdown 绘制 UML 图 -- PlantUML + Gravizo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37.5" data-path="../开发工具/android-use-jitpack-to-publish-github-project.html">
            
                <a href="../开发工具/android-use-jitpack-to-publish-github-project.html">
            
                    
                    Android：使用JitPack发布Github开源库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37.6" data-path="../开发工具/development-tool-charles.html">
            
                <a href="../开发工具/development-tool-charles.html">
            
                    
                    抓包工具 Charles 的使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.38" >
            
                <span>
            
                    
                    移动互联网
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.38.1" data-path="../移动互联网/mobile-internet-webapp-vs-nativeapp.html">
            
                <a href="../移动互联网/mobile-internet-webapp-vs-nativeapp.html">
            
                    
                    WebApp 和 NativeApp 的世纪之战 
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.39" >
            
                <span>
            
                    
                    区块链
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.39.1" data-path="../区块链/block-chain-basic-questions.html">
            
                <a href="../区块链/block-chain-basic-questions.html">
            
                    
                    区块链 -- 区块链基础100问
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.40" >
            
                <span>
            
                    
                    数据结构与算法
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.40.1" data-path="../数据结构与算法/algorithms-basic-sort.html">
            
                <a href="../数据结构与算法/algorithms-basic-sort.html">
            
                    
                    算法系列 -- 排序算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.40.2" data-path="../数据结构与算法/data-structure-basic-heap.html">
            
                <a href="../数据结构与算法/data-structure-basic-heap.html">
            
                    
                    数据结构 -- 堆
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.40.3" data-path="../数据结构与算法/data-structure-basic-tree.html">
            
                <a href="../数据结构与算法/data-structure-basic-tree.html">
            
                    
                    数据结构 -- 树
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.41" >
            
                <span>
            
                    
                    读书
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.41.1" data-path="../读书/personal-reading-2018.html">
            
                <a href="../读书/personal-reading-2018.html">
            
                    
                    读书 2018
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.41.2" data-path="../读书/personal-reading-2019.html">
            
                <a href="../读书/personal-reading-2019.html">
            
                    
                    读书 2019
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Android startActivity 流程分析</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="&#x6982;&#x8FF0;">&#x6982;&#x8FF0;</h2>
<p>Activity&#x7684;&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#x6709;&#x4E24;&#x79CD;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x663E;&#x5F0F;&#x7684;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x9690;&#x5F0F;&#x7684;&#x3002;
&#x800C;&#x4E14;&#xFF0C;&#x542F;&#x52A8;&#x7684; <code>Activity</code> &#x548C;&#x539F; <code>Activity</code> &#x7684;&#x8FDB;&#x7A0B;&#x5173;&#x7CFB;&#x7684;&#x4E0D;&#x540C;&#x53C8;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x662F;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#x6765;&#x542F;&#x52A8; <code>Activity</code>&#x3002;</p>
<h2 id="&#x76F8;&#x5173;&#x7C7B;&#x4ECB;&#x7ECD;">&#x76F8;&#x5173;&#x7C7B;&#x4ECB;&#x7ECD;</h2>
<p>&#x6D89;&#x53CA;&#x5230;&#x7684;&#x7C7B;&#xFF1A;</p>
<pre><code class="lang-java">frameworks/base/core/java/android/app/Activity.java
frameworks/base/core/java/android/app/ActivityThread.java
frameworks/base/core/java/android/app/Instrumentation.java
frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java
frameworks/base/services/core/java/com/android/server/am/ActivityStackSupervisor.java
frameworks/base/services/core/java/com/android/server/am/ActivityStack.java
</code></pre>
<ul>
<li>ActivityThread&#xFF1A;&#x4EE3;&#x8868;&#x4E86;&#x5E94;&#x7528;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x5728;Activity.attach()&#x65B9;&#x6CD5;&#x4E2D;&#x521D;&#x59CB;&#x5316;</li>
<li>TaskRecord&#xFF1A;Activity&#x7684;&#x7BA1;&#x7406;&#x8005;</li>
<li>ActivityStack&#xFF1A;Stack&#x7684;&#x7BA1;&#x7406;&#x8005;</li>
<li>ActivityStackSupervisor&#xFF1A;ActivityStack&#x7684;&#x7BA1;&#x7406;&#x8005;&#xFF0C;&#x65E9;&#x671F;&#x7684;Android&#x7248;&#x672C;&#x662F;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#xFF0C;&#x76F4;&#x5230;Android 6.0&#x624D;&#x51FA;&#x73B0;&#x3002;</li>
</ul>
<h2 id="&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x56FE;">&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x56FE;</h2>
<p><img src="http://www.plantuml.com/plantuml/svg/pLTDJnin4Btlht13hrL5Zf62590g8WLKiQ5LLLN8U0TYiTWhsqdXrgzJUu1J3-sv4ZTwwQc7_fa6-1draat8ElP-PMbxYPBn-BsPyRDdCg01e0FErJu_yJpzWHghKg5E5A6dWXEGie5MUlHmeDR38NWH5eeI6c6cVOYY8wfEKyOkaqeCZu4fh2XdrWrRcE5341h_v1HXQRNlhNh00dGNLMVBdqMKXRgjUKUGvU63655YT_4L9aV-C8fT91Tkd_HA58MKt2RS7mZ0mMqAHW9D_QjCMGjLgPaTHsgrCKMOhA77A6rukDcOvqaGPaayMfijjQJIkBFpn_4NhE1E4TCloBdf2HSx88UXojbjwAa59q1yExifFUFtV2nffUMbO-ZIRhR0JwJOqeSXC9CQrWcTYDPgjG0d2YuOzrJlTdDH-8xSbI1g836kM9fb2vy-nzHIAFDYEknPH08a3qVWhfV94S1zX97AjyV94GJUlVFiCZA0cAfkmXBff35pJahVspwF4WSAilQuJOwbObz4wp86egPot9ROZu3G0qhAAiV3eK8FY7xB5Mp3wwJxU0XLka4uz2tdZL1k61byBrVY7lXgpT56Mr9BDnY6qCD3hUBPzKM8SKqeuYQgVupFBd___3O-UtVpvltLv-ytlxvUNtoAxUUNuuyNSxkkltou-l5siXWtjnWbbO6zcICq_nmKyN5K0a89gDfvsDxd1C1z4iO3ZL3fFi1cOUu0uI8emMMfn_BnLCoxI2pvFbeoNf7Eu78flx0CQBbkLit5AD0o7iaSv7QOpc1p7kROPzbijNdjTd8DaRw7qx4SjTkfKNTolLl7cBB5jpOPaOsvUd4tLhgAWmhxqxD-WZFt-EJCgatxhDhy5xDgyTWhpwiB5AuUQH1bCTbRqZvbWJqLUsEmcwq49R0NOItQ6s0MXB3k14rBqN9HB2iBWUItnWf_30eVPot_3UoJJNMkYbDDdKegJL58KBtExlR6vbvdezzzrks_gFugJfJf3Auacgxy0HV71U6AwVmltOrwElF_qPgR6MLoB_q1" alt="&#x6548;&#x679C;&#x56FE;"></p>
<!-- 
------------------------------------------------------------------------------ FirstActivity 进程
├── Activity.startActivity()
     ├── Activity.startActivityForResult()
          ├── Instrumentation.execStartActivity()
               ├── ActivityManagerNative.ActivityManagerProxy.startActivity()
------------------------------------------------------------------------------ FirstActivity 进程
------------------------------------------------------------------------------ AMS 进程
                    ├── ActivityManagerNative.onTransact()
                         ├── ActivityManagerService.startActivity()
                              ├── ActivityManagerService.startActivityAsUser()
                                   ├── ActivityStackSupervisor.startActivityMayWait()
                                        ├── ActivityStackSupervisor.resolveActivity()
                                        ├── ActivityStackSupervisor.startActivityLocked()
                                             ├── ActivityStackSupervisor.startActivityUncheckedLocked()
                                                  ├── ActivityStack.startActivityLocked()
                                                       ├── ActivityStackSupervisor.resumeTopActivitiesLocked()
                                                            ├── ActivityStack.resumeTopActivityLocked()
                                                                 ├── ActivityStack.resumeTopActivityInnerLocked()
                                                                      ├── ActivityStackSupervisor.startSpecificActivityLocked()
                                                                           ├── ActivityStackSupervisor.realStartActivityLocked() 在本进程启动
                                                                               此方法的分析同新进程启动Activity中的realStartActivityLocked()，下面分析
                                                                                ├── ApplicationThreadNative.ApplicationThreadProxy.scheduleLaunchActivity()
------------------------------------------------------------------------------ AMS 进程
------------------------------------------------------------------------------ FirstActivity 进程
├── ActivityThread.H.handleMessage():LAUNCH_ACTIVITY
     ├── ActivityThread.handleLaunchActivity()
          ├── ActivityThread.performLaunchActivity()
------------------------------------------------------------------------------ FirstActivity 进程
------------------------------------------------------------------------------ AMS 进程
                                                                           ├── ActivityManagerService.startProcessLocked() 启动新的进程
                                                                                ├── ActivityManagerService.newProcessRecordLocked()
                                                                                ├── ActivityManagerService.startProcessLocked()
                                                                                     ├── Process.start()
------------------------------------------------------------------------------ AMS 进程
------------------------------------------------------------------------------ SecondActivity 进程
├── ActivityThread.main()
     ├── ActivityThread.attach()
          ├── ActivityManagerNative.ActivityManagerProxy.attachApplication()
------------------------------------------------------------------------------ SecondActivity 进程
------------------------------------------------------------------------------ AMS 进程
├── ActivityManagerNative.onTransact()
     ├── ActivityManagerService.attachApplication()
          ├── ActivityManagerService.attachApplicationLocked()
               ├── ApplicationThreadNative.ApplicationThreadProxy.bindApplication()
------------------------------------------------------------------------------ AMS 进程
------------------------------------------------------------------------------ SecondActivity 进程
                    ├── ApplicationThread.bindApplication()
                         ├── ActivityThread.handleBindApplication()
------------------------------------------------------------------------------ SecondActivity 进程
------------------------------------------------------------------------------ AMS 进程
               ├── ActivityStackSupervisor.attachApplicationLocked()
                    ├── ActivityStackSupervisor.realStartActivityLocked() 此处同上面的同一进程启动Activity
                         ├── ApplicationThreadNative.ApplicationThreadProxy.scheduleLaunchActivity()
------------------------------------------------------------------------------ AMS 进程
------------------------------------------------------------------------------ SecondActivity 进程
├── ApplicationThread.scheduleLaunchActivity()
   ├── ActivityThread.H.handleMessage():LAUNCH_ACTIVITY
        ├── ActivityThread.handleLaunchActivity()
             ├── ActivityThread.performLaunchActivity()
------------------------------------------------------------------------------ SecondActivity 进程

http://www.plantuml.com/plantuml/png/jLVTYjj65BxNKqnDBsn8qhIzMGmRyCffruuDnZRgPHbBi_OGQKQCHjdrdKCefOKa5oqfj9IIGjbUDIsqjFI7lapjZT-YvqYMFBBbzR9i3AlrdByvSxvlT8wZXro4LD601598Tw9am8XMCREYN1FfgS_WgRYhuy2t9jnZv4HAFP9dbWKschiyf4AJIZyMcWUiuMh-YEjfXT28z1j5c-FfI77FuUoq5OH-OdBij3RYG7Iq8E-GxElRnsaqfsZPZeOJnQW7bjdNbMLxMBHq3XAnSr0Kz-YOTQc0fqhqlMvHNpWBB3OJZJLJBN4Yq-mspk4qfHi7JEXqQrWLzI2mPH1AaPaqxGq3vahLeLFO9jLtBElmaBnxXzXIH13Q8wCfQG_8uQ5bzHlazZseTvr8yO1Dc_9KM1JJfveX3AaUYbqdOtb4tOThBI80Vuc_iws6glSTLBQ7THBAIACwL2oArZPGRu_jM86_iSBDJ6N3ijf3Y9w67vM6JWm0l3fXPyo5eXz9wJCg1gxYeQvMqAk7NeXdjLQfhRq1SUU0tCxYkwl2cIc0YKLzJTxAbGG-gwIm81CgF9zr8Jw6xmu-_FYeOJ_ezUyF1hN4jdZqSebP3aJnlIAA1XCJE1CNICgGtnapRSSA2EUnisgDt2Dt4pFyf03rkca5St6-AH0xa_MwcUbObXfkM685fC0yeCGsr6BCjjtWKCLKCgwa3WwF-CXd2JpIz_3_BN92_OZLjcEj2fQ3aCTAuTxlKA2A8xcNySJTIYQ4HylBSgcKP0Fio6H5pfH8ZKJsIf46cTYNCYHGbnnTm5QmqtoP6vQXqcU1VBGYxMMuR6FJPF1UbrCCKkvjP6uK5zszwxXkml91BC1SYch526TWi0k7tLZihloLDKR5cF1sNuQKsDuLhiAMJqjqAHTflohrtmY0hGDBhgaxiIVSznGJ9KJ51fD9SO6kJNk_8xITJDQqCwT8GoTg21vGH2Wt418S51zFT9qilZfVllnj-Uttyp-Up7-PBMUp-QT_pZ__yUBBl_PlakuYHRx5VU5TCJML41vUdXeQPzeU1_I4-TDB_Gs8tvGqGQ1OAaXK9GHu_Upt-VCNQRsMdpoz-EUd__vzkNZyQfChs9wPHhBWN572ZjRQevNsDGmVRZgOZ6wL4uhgQn9gd-CRHosDYkUcNZ9CLWDZLhf5xjQkS2sRdSjPda27HeiNFviyNtpsnVplsKwUTqfpxrYNlsgCYyTq70vXlXbHrH3UHrnuyXGdhh6IyPuxSYEytTE_RxPVbx-Ir_N7Zh6SVNtntGyuvow--NKDnlDNhyyVBsRdr-xzDz7kzy2wezyROcCmsvOo64foDSoCxnTdnkpN2GwCHVH0Wo_NesmkBkjJ-7EcPEiTujMXafQOF8m9_dy0

@startuml
hide footbox

box "1st App Process" #LightBlue
participant Activity
participant Instrumentation
participant ActivityManagerProxy as ActivityManagerProxy_1
end box

box "AMS Process"
participant ActivityManagerNative
participant ActivityManagerService
participant ActivityStackSupervisor
participant ActivityStack
participant ApplicationThreadProxy
end box

box "2nd App Process" #LightBlue
participant ActivityManagerProxy as ActivityManagerProxy_2
participant ApplicationThread
participant "ActivityThread / ActivityThread$H" as ActivityThread
end box

-> Activity:startActivity
activate Activity
Activity -> Activity:startActivityForResult
activate Activity
Activity -> Instrumentation:execStartActivity
activate Instrumentation
Instrumentation -> ActivityManagerProxy_1:startActivity
activate ActivityManagerProxy_1
ActivityManagerProxy_1 -> ActivityManagerNative:onTransact
activate ActivityManagerNative
ActivityManagerNative -> ActivityManagerService:startActivity
activate ActivityManagerService
ActivityManagerService -> ActivityManagerService:startActivityAsUser
activate ActivityManagerService
ActivityManagerService -> ActivityStackSupervisor:startActivityMayWait
activate ActivityStackSupervisor
ActivityStackSupervisor -> ActivityStackSupervisor:resolveActivity
activate ActivityStackSupervisor
deactivate ActivityStackSupervisor
ActivityStackSupervisor -> ActivityStackSupervisor:startActivityLocked
activate ActivityStackSupervisor
ActivityStackSupervisor -> ActivityStackSupervisor:startActivityUncheckedLocked
activate ActivityStackSupervisor
ActivityStackSupervisor -> ActivityStack:startActivityLocked
activate ActivityStack
ActivityStack -> ActivityStackSupervisor:resumeTopActivitiesLocked
activate ActivityStackSupervisor
ActivityStackSupervisor -> ActivityStack:resumeTopActivityLocked
activate ActivityStack
ActivityStack -> ActivityStack:resumeTopActivityInnerLocked
activate ActivityStack
ActivityStack -> ActivityStackSupervisor:startSpecificActivityLocked
activate ActivityStackSupervisor

alt !createNewProcess
  ActivityStackSupervisor -> ActivityStackSupervisor:realStartActivityLocked
  activate ActivityStackSupervisor
  ActivityStackSupervisor -[#Blue]> ApplicationThreadProxy:scheduleLaunchActivity
  note right
  可以参考新进程
  启动Activity
  的流程
  end note
  activate ApplicationThreadProxy
  deactivate ApplicationThreadProxy
  deactivate ActivityStackSupervisor
else createNewProcess
  ActivityStackSupervisor -> ActivityManagerService:startProcessLocked
  activate ActivityManagerService
  ActivityManagerService -> ActivityManagerService:newProcessRecordLocked
  activate ActivityManagerService
  deactivate ActivityManagerService
  ActivityManagerService -> ActivityManagerService:startProcessLocked
  activate ActivityManagerService
  deactivate ActivityManagerService
  deactivate ActivityManagerService
end

deactivate ActivityStackSupervisor
deactivate ActivityStack
deactivate ActivityStack
deactivate ActivityStackSupervisor
deactivate ActivityStack
deactivate ActivityStackSupervisor
deactivate ActivityStackSupervisor
deactivate ActivityStackSupervisor
deactivate ActivityManagerService
deactivate ActivityManagerService
deactivate ActivityManagerNative
deactivate ActivityManagerProxy_1
deactivate Instrumentation
deactivate Activity
deactivate Activity

== create New Process ==

-> ActivityThread:main
activate ActivityThread
ActivityThread -> ActivityThread:attach
activate ActivityThread
ActivityThread -> ActivityManagerProxy_2:attachApplication
activate ActivityManagerProxy_2
ActivityManagerProxy_2 -> ActivityManagerNative:onTransact
activate ActivityManagerNative
ActivityManagerNative -> ActivityManagerService:attachApplication
activate ActivityManagerService
ActivityManagerService -> ActivityManagerService:attachApplicationLocked
activate ActivityManagerService

ActivityManagerService -> ApplicationThreadProxy:bindApplication
activate ApplicationThreadProxy
ApplicationThreadProxy -> ApplicationThread:bindApplication
activate ApplicationThread
ApplicationThread -> ActivityThread:handleBindApplication
activate ActivityThread
deactivate ActivityThread
deactivate ApplicationThread
deactivate ApplicationThreadProxy

ActivityManagerService -> ActivityStackSupervisor:attachApplicationLocked
activate ActivityStackSupervisor
ActivityStackSupervisor -> ActivityStackSupervisor:realStartActivityLocked
activate ActivityStackSupervisor
ActivityStackSupervisor -[#Blue]> ApplicationThreadProxy:scheduleLaunchActivity
activate ApplicationThreadProxy
ApplicationThreadProxy -> ApplicationThread:scheduleLaunchActivity
activate ApplicationThread
ApplicationThread -> ActivityThread:LAUNCH_ACTIVITY
activate ActivityThread
ActivityThread -> ActivityThread:handleLaunchActivity
activate ActivityThread
ActivityThread -> ActivityThread:performLaunchActivity
activate ActivityThread
deactivate ActivityThread
deactivate ActivityThread
deactivate ActivityThread
deactivate ApplicationThread
deactivate ApplicationThreadProxy
deactivate ActivityStackSupervisor
deactivate ActivityStackSupervisor

deactivate ActivityManagerService
deactivate ActivityManagerService
deactivate ActivityManagerNative
deactivate ActivityManagerProxy_2
deactivate ActivityThread

deactivate ActivityThread
@enduml

-->
<h2 id="&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;">&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;</h2>
<h2 id="&#x542F;&#x52A8;&#x6D41;&#x7A0B;">&#x542F;&#x52A8;&#x6D41;&#x7A0B;</h2>
<h3 id="&#x542F;&#x52A8;&#x524D;&#x671F;&#xFF0C;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;">&#x542F;&#x52A8;&#x524D;&#x671F;&#xFF0C;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;</h3>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startActivityForResult</span><span class="hljs-params">(Intent intent, <span class="hljs-keyword">int</span> requestCode, @Nullable Bundle options)</span> </span>{
        <span class="hljs-comment">// &#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x8D70;mParent == null&#x5206;&#x652F;</span>
        <span class="hljs-keyword">if</span> (mParent == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">//&#x8C03;&#x7528;Instrumentation.execStartActivity()&#x542F;&#x52A8;&#x65B0;&#x7684;Activity&#x3002;mMainThread&#x7C7B;&#x578B;&#x4E3A;ActivityThread, &#x5728;attach()&#x51FD;&#x6570;&#x88AB;&#x56DE;&#x8C03;&#x65F6;&#x88AB;&#x8D4B;&#x503C;&#x3002;</span>
            Instrumentation.ActivityResult ar =
                mInstrumentation.execStartActivity(
                    <span class="hljs-keyword">this</span>, mMainThread.getApplicationThread(), mToken, <span class="hljs-keyword">this</span>,
                    intent, requestCode, options);
            <span class="hljs-keyword">if</span> (ar != <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x5982;&#x679C;activity&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x542F;&#x52A8;&#xFF0C;&#x800C;&#x4E14;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF0C;execStartActivity&#x51FD;&#x6570;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x8981;&#x542F;&#x52A8;&#x7684;activity&#x7684;result&#x6216;&#x8005;null&#x3002;</span>
                <span class="hljs-comment">//&#x5982;&#x679C;&#x7ED3;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x53D1;&#x9001;&#x7ED3;&#x679C;</span>
                mMainThread.sendActivityResult(
                    mToken, mEmbeddedID, requestCode, ar.getResultCode(),
                    ar.getResultData());
            }
            <span class="hljs-keyword">if</span> (requestCode &gt;= <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x90A3;&#x4E48;&#x8D4B;&#x503C;mStartedActivity&#x4E3A;true&#xFF0C;&#x5728;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x6765;&#x4E4B;&#x524D;&#x4FDD;&#x6301;&#x5F53;&#x524D;Activity&#x4E0D;&#x53EF;&#x89C1;</span>
                mStartedActivity = <span class="hljs-keyword">true</span>;
            }

            cancelInputsAndStartExitTransition(options);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (options != <span class="hljs-keyword">null</span>) {
                mParent.startActivityFromChild(<span class="hljs-keyword">this</span>, intent, requestCode, options);
            } <span class="hljs-keyword">else</span> {
                mParent.startActivityFromChild(<span class="hljs-keyword">this</span>, intent, requestCode);
            }
        }
    }
</code></pre>
<p>&#x8FD9;&#x91CC;&#x6CE8;&#x610F;&#x5230; <code>mParent</code> &#x53D8;&#x91CF;&#xFF0C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x8FD9;&#x91CC; <code>mParent</code> &#x662F;&#x4E3A;&#x7A7A;&#x7684;&#xFF0C;&#x9664;&#x975E;&#x662F;&#x542F;&#x52A8; <code>ActivityGroup</code> &#x7B49;&#x53EF;&#x4EE5;&#x5D4C;&#x5957; <code>Activity</code> &#x7684;&#x5185;&#x90E8;&#x7684; <code>Activity</code> &#x65F6;&#x624D;&#x4F1A;&#x4E0D;&#x4E3A;&#x7A7A;&#x3002;</p>
<p>Instrumentation.execStartActivity</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">public</span> ActivityResult <span class="hljs-title">execStartActivity</span><span class="hljs-params">(
            Context who, IBinder contextThread, IBinder token, Activity target,
            Intent intent, <span class="hljs-keyword">int</span> requestCode, Bundle options)</span> </span>{
        IApplicationThread whoThread = (IApplicationThread) contextThread;
        Uri referrer = target != <span class="hljs-keyword">null</span> ? target.onProvideReferrer() : <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (referrer != <span class="hljs-keyword">null</span>) {
            intent.putExtra(Intent.EXTRA_REFERRER, referrer);
        }
        <span class="hljs-comment">// &#x5224;&#x65AD;mActivityMonitors&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#xFF0C;mActivityMonitors&#x53EF;&#x4EE5;&#x901A;&#x8FC7;addMonitor()&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#xFF0C;&#x4E00;&#x822C;&#x5728;&#x81EA;&#x52A8;&#x5316;&#x6D4B;&#x8BD5;&#x65F6;&#x4F7F;&#x7528;</span>
        <span class="hljs-comment">// &#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x4F1A;&#x8D70;&#x8FD9;&#x4E2A;&#x5206;&#x652F;</span>
        <span class="hljs-keyword">if</span> (mActivityMonitors != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">synchronized</span> (mSync) {
                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> N = mActivityMonitors.size();
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;N; i++) {
                    <span class="hljs-keyword">final</span> ActivityMonitor am = mActivityMonitors.get(i);
                    <span class="hljs-keyword">if</span> (am.match(who, <span class="hljs-keyword">null</span>, intent)) {
                        am.mHits++;
                        <span class="hljs-comment">// &#x5982;&#x679C;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span>
                        <span class="hljs-keyword">if</span> (am.isBlocking()) {
                            <span class="hljs-keyword">return</span> requestCode &gt;= <span class="hljs-number">0</span> ? am.getResult() : <span class="hljs-keyword">null</span>;
                        }
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
        }
        <span class="hljs-keyword">try</span> {
            intent.migrateExtraStreamToClipData();
            intent.prepareToLeaveProcess();
            <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x7684;ActivityManagerNative.getDefault&#x8FD4;&#x56DE;ActivityManagerService&#x7684;&#x8FDC;&#x7A0B;&#x63A5;&#x53E3;&#xFF0C;&#x5373;ActivityManagerProxy&#x63A5;&#x53E3;</span>
            <span class="hljs-comment">// &#x7531;&#x5B83;&#x901A;&#x8FC7;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#x8C03;&#x7528; AMS &#x7684; startActivity &#x65B9;&#x6CD5;</span>
            <span class="hljs-keyword">int</span> result = ActivityManagerNative.getDefault()
                .startActivity(whoThread, who.getBasePackageName(), intent,
                        intent.resolveTypeIfNeeded(who.getContentResolver()),
                        token, target != <span class="hljs-keyword">null</span> ? target.mEmbeddedID : <span class="hljs-keyword">null</span>,
                        requestCode, <span class="hljs-number">0</span>, <span class="hljs-keyword">null</span>, options);
            checkStartActivityResult(result, intent);
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Failure from system&quot;</span>, e);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
</code></pre>
<p><code>mActivityMonitors</code> &#x662F; <code>ActivityMonitor</code> &#x7684;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#xFF0C;&#x8BE5;&#x7C7B;&#x7528;&#x6765;&#x76D1;&#x63A7;&#x5E94;&#x7528;&#x4E2D;&#x7684;&#x5355;&#x4E2A;&#x6D3B;&#x52A8;&#xFF0C;&#x53EF;&#x76D1;&#x63A7;&#x4E00;&#x4E9B;&#x6307;&#x5B9A;&#x7684;&#x610F;&#x56FE;&#x3002;&#x4E00;&#x822C;&#x5728;&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;Case&#x65F6;&#x4F7F;&#x7528;&#x3002;&#x521B;&#x5EFA; <code>ActivityMonitor</code> &#x5B9E;&#x4F8B;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x8C03;&#x7528; <code>ActivityInstrumentationTestCase2</code> &#x7684; <code>getInstrumentation()</code> &#x65B9;&#x6CD5;&#x83B7;&#x53D6; <code>Instrumentation</code> &#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7; <code>addMonitor</code> &#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x5F53;&#x76EE;&#x6807;&#x6D3B;&#x52A8;&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x5339;&#x914D; <code>Instrumentation</code> &#x4E2D;&#x7684; <code>ActivityMonitor</code> &#x5B9E;&#x4F8B;&#x5217;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x5339;&#x914D;&#xFF0C;&#x5C31;&#x4F1A;&#x7D2F;&#x52A0;&#x8BA1;&#x6570;&#x5668;&#x3002;</p>
<h3 id="activitymanagerservice&#x7684;&#x5904;&#x7406;">ActivityManagerService&#x7684;&#x5904;&#x7406;</h3>
<h4 id="activitymanagerservicestartactivityasuser">ActivityManagerService.startActivityAsUser</h4>
<pre><code class="lang-java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivityAsUser</span><span class="hljs-params">(IApplicationThread caller, String callingPackage,
            Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="hljs-keyword">int</span> requestCode,
            <span class="hljs-keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle options, <span class="hljs-keyword">int</span> userId)</span> </span>{
        enforceNotIsolatedCaller(<span class="hljs-string">&quot;startActivity&quot;</span>);
        userId = handleIncomingUser(Binder.getCallingPid(), Binder.getCallingUid(), userId,
                <span class="hljs-keyword">false</span>, ALLOW_FULL_ONLY, <span class="hljs-string">&quot;startActivity&quot;</span>, <span class="hljs-keyword">null</span>);
        <span class="hljs-keyword">return</span> mStackSupervisor.startActivityMayWait(caller, -<span class="hljs-number">1</span>, callingPackage, intent,
                resolvedType, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, resultTo, resultWho, requestCode, startFlags,
                profilerInfo, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, options, <span class="hljs-keyword">false</span>, userId, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);
    }
</code></pre>
<p>&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x5C31;&#x5728;AMS&#x8FDB;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x4EE3;&#x8868;&#x7684;&#x610F;&#x4E49;&#xFF1A;</p>
<ul>
<li>resultTo&#xFF1A; &#x6307;&#x8C03;&#x7528;&#x8005;Activity&#x7684;mToken&#xFF0C;mToken&#x5BF9;&#x8C61;&#x4FDD;&#x5B58;&#x5B83;&#x6240;&#x5904;&#x7684;ActivityRecord&#x4FE1;&#x606F;</li>
</ul>
<h4 id="activitystacksupervisorstartactivitymaywait">ActivityStackSupervisor.startActivityMayWait()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivityMayWait</span><span class="hljs-params">(IApplicationThread caller, <span class="hljs-keyword">int</span> callingUid,
            String callingPackage, Intent intent, String resolvedType,
            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,
            IBinder resultTo, String resultWho, <span class="hljs-keyword">int</span> requestCode, <span class="hljs-keyword">int</span> startFlags,
            ProfilerInfo profilerInfo, WaitResult outResult, Configuration config,
            Bundle options, <span class="hljs-keyword">boolean</span> ignoreTargetSecurity, <span class="hljs-keyword">int</span> userId,
            IActivityContainer iContainer, TaskRecord inTask)</span> </span>{
        <span class="hljs-comment">// &#x4E0D;&#x5141;&#x8BB8;&#x4F20;&#x9012;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;</span>
        <span class="hljs-keyword">if</span> (intent != <span class="hljs-keyword">null</span> &amp;&amp; intent.hasFileDescriptors()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;File descriptors passed in Intent&quot;</span>);
        }
        <span class="hljs-keyword">boolean</span> componentSpecified = intent.getComponent() != <span class="hljs-keyword">null</span>;
        <span class="hljs-comment">// &#x91CD;&#x65B0;&#x5B9E;&#x4F8B;&#x5316;&#x4E00;&#x4E2A;Intent&#x5BF9;&#x8C61;&#xFF0C;&#x9632;&#x6B62;&#x5BF9;intent&#x7684;&#x4FEE;&#x6539;</span>
        intent = <span class="hljs-keyword">new</span> Intent(intent);

        <span class="hljs-comment">// &#x901A;&#x8FC7;Intent&#x89E3;&#x6790;Activity&#x4FE1;&#x606F;&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;PackageManagerService.resolveIntent()&#x6765;&#x67E5;&#x8BE2;&#x548C;&#x9009;&#x62E9;&#x76F8;&#x5173;&#x7684;Activity</span>
        <span class="hljs-comment">// &#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;Activity&#x5339;&#x914D;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x5F39;&#x6846;&#x8BA9;&#x7528;&#x6237;&#x6765;&#x9009;&#x62E9;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x5206;&#x6790;&#x6B64;&#x5904;&#x7701;&#x7565;</span>
        ActivityInfo aInfo =
                resolveActivity(intent, resolvedType, startFlags, profilerInfo, userId);

        ActivityContainer container = (ActivityContainer)iContainer;
        <span class="hljs-keyword">synchronized</span> (mService) {
            <span class="hljs-comment">// &#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;container &#x4E3A;null</span>
            <span class="hljs-keyword">if</span> (container != <span class="hljs-keyword">null</span> &amp;&amp; container.mParentActivity != <span class="hljs-keyword">null</span> &amp;&amp;
                    container.mParentActivity.state != RESUMED) {
                <span class="hljs-keyword">return</span> ActivityManager.START_CANCELED;
            }
            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> realCallingPid = Binder.getCallingPid();
            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> realCallingUid = Binder.getCallingUid();
            <span class="hljs-keyword">int</span> callingPid;
            <span class="hljs-keyword">if</span> (callingUid &gt;= <span class="hljs-number">0</span>) {
                callingPid = -<span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (caller == <span class="hljs-keyword">null</span>) {
                callingPid = realCallingPid;
                callingUid = realCallingUid;
            } <span class="hljs-keyword">else</span> {
                callingPid = callingUid = -<span class="hljs-number">1</span>;
            }

            <span class="hljs-keyword">final</span> ActivityStack stack;
            <span class="hljs-keyword">if</span> (container == <span class="hljs-keyword">null</span> || container.mStack.isOnHomeDisplay()) {
                <span class="hljs-comment">// &#x4E00;&#x822C;&#x4F1A;&#x8D70;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5C06;&#x5F53;&#x524D;&#x7684;ActivityStack&#x8D4B;&#x503C;&#x7ED9;stack</span>
                stack = mFocusedStack;
            } <span class="hljs-keyword">else</span> {
                stack = container.mStack;
            }
            stack.mConfigWillChange = config != <span class="hljs-keyword">null</span> &amp;&amp; mService.mConfiguration.diff(config) != <span class="hljs-number">0</span>;

            <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> origId = Binder.clearCallingIdentity();

            <span class="hljs-keyword">if</span> (aInfo != <span class="hljs-keyword">null</span> &amp;&amp;
                    (aInfo.applicationInfo.privateFlags
                            &amp;ApplicationInfo.PRIVATE_FLAG_CANT_SAVE_STATE) != <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// &#x5904;&#x7406;heavy-weight process&#xFF0C;&#x5373;&#x91CD;&#x91CF;&#x7EA7;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FD9;&#x79CD;&#x8FDB;&#x7A0B;&#x5728;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x65F6;&#x4E0D;&#x4F1A;&#x88AB;kill&#x6389;</span>
                <span class="hljs-comment">// &#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x8D70;&#x8FD9;&#x91CC;</span>
                <span class="hljs-keyword">if</span> (aInfo.processName.equals(aInfo.applicationInfo.packageName)) {
                    <span class="hljs-keyword">if</span> (mService.mHeavyWeightProcess != <span class="hljs-keyword">null</span> &amp;&amp;
                            (mService.mHeavyWeightProcess.info.uid != aInfo.applicationInfo.uid ||
                            !mService.mHeavyWeightProcess.processName.equals(aInfo.processName))) {
                        <span class="hljs-keyword">int</span> appCallingUid = callingUid;
            &#x2026;&#x2026;&#x2026;&#x2026;<span class="hljs-comment">//&#x6B64;&#x5904;&#x4EE3;&#x7801;&#x7701;&#x7565;</span>
                    }
                }
            }

            <span class="hljs-keyword">int</span> res = startActivityLocked(caller, intent, resolvedType, aInfo,
                    voiceSession, voiceInteractor, resultTo, resultWho,
                    requestCode, callingPid, callingUid, callingPackage,
                    realCallingPid, realCallingUid, startFlags, options, ignoreTargetSecurity,
                    componentSpecified, <span class="hljs-keyword">null</span>, container, inTask);

            Binder.restoreCallingIdentity(origId);

            <span class="hljs-keyword">if</span> (stack.mConfigWillChange) {
                <span class="hljs-comment">// &#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x8D70;&#x8FD9;&#x91CC;</span>
                &#x2026;&#x2026;&#x2026;&#x2026;
            }

            <span class="hljs-keyword">if</span> (outResult != <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x8D70;&#x8FD9;&#x91CC;</span>
                &#x2026;&#x2026;
            }

            <span class="hljs-keyword">return</span> res;
        }
    }
</code></pre>
<h4 id="activitystacksupervisorstartactivitylocked">ActivityStackSupervisor.startActivityLocked()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivityLocked</span><span class="hljs-params">(IApplicationThread caller,
            Intent intent, String resolvedType, ActivityInfo aInfo,
            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,
            IBinder resultTo, String resultWho, <span class="hljs-keyword">int</span> requestCode,
            <span class="hljs-keyword">int</span> callingPid, <span class="hljs-keyword">int</span> callingUid, String callingPackage,
            <span class="hljs-keyword">int</span> realCallingPid, <span class="hljs-keyword">int</span> realCallingUid, <span class="hljs-keyword">int</span> startFlags, Bundle options,
            <span class="hljs-keyword">boolean</span> ignoreTargetSecurity, <span class="hljs-keyword">boolean</span> componentSpecified, ActivityRecord[] outActivity,
            ActivityContainer container, TaskRecord inTask)</span> </span>{
        <span class="hljs-keyword">int</span> err = ActivityManager.START_SUCCESS;

        ProcessRecord callerApp = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (caller != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x83B7;&#x53D6;&#x8C03;&#x7528;&#x8005;&#x6240;&#x5728;&#x7684;ProcessRecord</span>
            callerApp = mService.getRecordForAppLocked(caller);
            <span class="hljs-keyword">if</span> (callerApp != <span class="hljs-keyword">null</span>) {
                callingPid = callerApp.pid;
                callingUid = callerApp.info.uid;
            } <span class="hljs-keyword">else</span> {
                err = ActivityManager.START_PERMISSION_DENIED;
            }
        }
        <span class="hljs-comment">// &#x83B7;&#x53D6;userId&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7BA1;&#x7406;&#x5458;&#x7528;&#x6237;&#x8BE5;&#x503C;&#x4E3A;0</span>
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> userId = aInfo != <span class="hljs-keyword">null</span> ? UserHandle.getUserId(aInfo.applicationInfo.uid) : <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span> (err == ActivityManager.START_SUCCESS) {
            <span class="hljs-comment">// &#x6253;&#x5370;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;</span>
        }

        ActivityRecord sourceRecord = <span class="hljs-keyword">null</span>;
        ActivityRecord resultRecord = <span class="hljs-keyword">null</span>;
        <span class="hljs-comment">// resultTo&#x4E3A;&#x8C03;&#x7528;&#x8005;Activity&#x7684;mToken&#xFF0C;&#x4FDD;&#x5B58;&#x4E86;&#x5B83;&#x6240;&#x5904;&#x7684;ActivityRecord&#x4FE1;&#x606F;</span>
        <span class="hljs-keyword">if</span> (resultTo != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x83B7;&#x53D6;&#x8C03;&#x7528;&#x8005;Activity&#x6240;&#x5BF9;&#x7528;&#x7684;ActivityRecord</span>
            sourceRecord = isInAnyStackLocked(resultTo);
            <span class="hljs-keyword">if</span> (sourceRecord != <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x5373;requestCode&#x4E0D;&#x4E3A;-1&#xFF0C;&#x8D4B;&#x503C;resultRecord</span>
                <span class="hljs-keyword">if</span> (requestCode &gt;= <span class="hljs-number">0</span> &amp;&amp; !sourceRecord.finishing) {
                    resultRecord = sourceRecord;
                }
            }
        }

        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> launchFlags = intent.getFlags();

        <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_FORWARD_RESULT) != <span class="hljs-number">0</span> &amp;&amp; sourceRecord != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x5BF9;Intent.FLAG_ACTIVITY_FORWARD_RESULT&#x5904;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x8FD9;&#x4E2A;flag&#xFF0C;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x76F8;&#x5F53;&#x4E8E;&#x900F;&#x4F20;</span>
            <span class="hljs-comment">// &#x6BD4;&#x5982;Activity&#x542F;&#x52A8;&#x987A;&#x5E8F;A-&gt;B-&gt;C&#xFF0C;&#x90A3;&#x4E48;C&#x7684;&#x7ED3;&#x679C;&#x5C06;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7ED9;A</span>
            &#x2026;&#x2026;&#x2026;&#x2026;<span class="hljs-comment">//&#x6B64;&#x5904;&#x4EE3;&#x7801;&#x5FFD;&#x7565;</span>
        }

        <span class="hljs-keyword">if</span> (err == ActivityManager.START_SUCCESS &amp;&amp; intent.getComponent() == <span class="hljs-keyword">null</span>) {
            err = ActivityManager.START_INTENT_NOT_RESOLVED;
        }

        <span class="hljs-keyword">if</span> (err == ActivityManager.START_SUCCESS &amp;&amp; aInfo == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x5F85;&#x542F;&#x52A8;&#x7684;Activity&#x6CA1;&#x6709;&#x5728;Manifestfest&#x4E2D;&#x663E;&#x793A;&#x58F0;&#x660E;&#xFF0C;&#x5C31;&#x4F1A;&#x6709;&#x8FD9;&#x4E2A;error</span>
            err = ActivityManager.START_CLASS_NOT_FOUND;
        }

        <span class="hljs-keyword">if</span> (err == ActivityManager.START_SUCCESS
                &amp;&amp; !isCurrentProfileLocked(userId)
                &amp;&amp; (aInfo.flags &amp; FLAG_SHOW_FOR_ALL_USERS) == <span class="hljs-number">0</span>) {
            err = ActivityManager.START_NOT_CURRENT_USER_ACTIVITY;
        }

        <span class="hljs-keyword">if</span> (err == ActivityManager.START_SUCCESS &amp;&amp; sourceRecord != <span class="hljs-keyword">null</span>
                &amp;&amp; sourceRecord.task.voiceSession != <span class="hljs-keyword">null</span>) {
            &#x2026;&#x2026;
        }

        <span class="hljs-keyword">if</span> (err == ActivityManager.START_SUCCESS &amp;&amp; voiceSession != <span class="hljs-keyword">null</span>) {
            &#x2026;&#x2026;
        }

        <span class="hljs-keyword">final</span> ActivityStack resultStack = resultRecord == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : resultRecord.task.stack;

        <span class="hljs-keyword">if</span> (err != ActivityManager.START_SUCCESS) {
            <span class="hljs-keyword">if</span> (resultRecord != <span class="hljs-keyword">null</span>) {
                resultStack.sendActivityResultLocked(-<span class="hljs-number">1</span>,
                    resultRecord, resultWho, requestCode,
                    Activity.RESULT_CANCELED, <span class="hljs-keyword">null</span>);
            }
            ActivityOptions.abort(options);
            <span class="hljs-keyword">return</span> err;
        }

        <span class="hljs-keyword">boolean</span> abort = <span class="hljs-keyword">false</span>;

        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> startAnyPerm = mService.checkPermission(
                START_ANY_ACTIVITY, callingPid, callingUid);

        &#x6267;&#x884C;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x6743;&#x9650;&#x68C0;&#x67E5;
        &#x2026;&#x2026;&#x2026;&#x2026;

        abort |= !mService.mIntentFirewall.checkStartActivity(intent, callingUid,
                callingPid, resolvedType, aInfo.applicationInfo);

        <span class="hljs-keyword">if</span> (mService.mController != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// The Intent we give to the watcher has the extra data</span>
                <span class="hljs-comment">// stripped off, since it can contain private information.</span>
                Intent watchIntent = intent.cloneFilter();
                abort |= !mService.mController.activityStarting(watchIntent,
                        aInfo.applicationInfo.packageName);
            } <span class="hljs-keyword">catch</span> (RemoteException e) {
                mService.mController = <span class="hljs-keyword">null</span>;
            }
        }

        <span class="hljs-keyword">if</span> (abort) {
            <span class="hljs-comment">// &#x6743;&#x9650;&#x68C0;&#x67E5;&#x4E0D;&#x901A;&#x8FC7;&#x5C31;&#x9000;&#x51FA;</span>
            <span class="hljs-keyword">if</span> (resultRecord != <span class="hljs-keyword">null</span>) {
                resultStack.sendActivityResultLocked(-<span class="hljs-number">1</span>, resultRecord, resultWho, requestCode,
                        Activity.RESULT_CANCELED, <span class="hljs-keyword">null</span>);
            }
            ActivityOptions.abort(options);
            <span class="hljs-keyword">return</span> ActivityManager.START_SUCCESS;
        }

        <span class="hljs-comment">// &#x65B0;&#x5EFA;&#x4E00;&#x4E2A;ActivityRecord&#xFF0C;&#x5BF9;&#x5E94;&#x5C06;&#x8981;&#x542F;&#x52A8;&#x7684;Activity</span>
        ActivityRecord r = <span class="hljs-keyword">new</span> ActivityRecord(mService, callerApp, callingUid, callingPackage,
                intent, resolvedType, aInfo, mService.mConfiguration, resultRecord, resultWho,
                requestCode, componentSpecified, voiceSession != <span class="hljs-keyword">null</span>, <span class="hljs-keyword">this</span>, container, options);
        <span class="hljs-keyword">if</span> (outActivity != <span class="hljs-keyword">null</span>) {
            outActivity[<span class="hljs-number">0</span>] = r;
        }

        <span class="hljs-keyword">if</span> (r.appTimeTracker == <span class="hljs-keyword">null</span> &amp;&amp; sourceRecord != <span class="hljs-keyword">null</span>) {
            r.appTimeTracker = sourceRecord.appTimeTracker;
        }

        <span class="hljs-comment">// &#x5F53;&#x524D;&#x7684;ActivityStack</span>
        <span class="hljs-keyword">final</span> ActivityStack stack = mFocusedStack;
        <span class="hljs-keyword">if</span> (voiceSession == <span class="hljs-keyword">null</span> &amp;&amp; (stack.mResumedActivity == <span class="hljs-keyword">null</span>
                || stack.mResumedActivity.info.applicationInfo.uid != callingUid)) {
            <span class="hljs-keyword">if</span> (!mService.checkAppSwitchAllowedLocked(callingPid, callingUid,
                    realCallingPid, realCallingUid, <span class="hljs-string">&quot;Activity start&quot;</span>)) {
                PendingActivityLaunch pal =
                        <span class="hljs-keyword">new</span> PendingActivityLaunch(r, sourceRecord, startFlags, stack);
                mPendingActivityLaunches.add(pal);
                ActivityOptions.abort(options);
                <span class="hljs-keyword">return</span> ActivityManager.START_SWITCHES_CANCELED;
            }
        }

        <span class="hljs-keyword">if</span> (mService.mDidAppSwitch) {
            mService.mAppSwitchesAllowedTime = <span class="hljs-number">0</span>;
        } <span class="hljs-keyword">else</span> {
            mService.mDidAppSwitch = <span class="hljs-keyword">true</span>;
        }

        doPendingActivityLaunchesLocked(<span class="hljs-keyword">false</span>);

        err = startActivityUncheckedLocked(r, sourceRecord, voiceSession, voiceInteractor,
                startFlags, <span class="hljs-keyword">true</span>, options, inTask);

        <span class="hljs-keyword">if</span> (err &lt; <span class="hljs-number">0</span>) {
            notifyActivityDrawnForKeyguard();
        }
        <span class="hljs-keyword">return</span> err;
    }
</code></pre>
<h4 id="activitystacksupervisorstartactivityuncheckedlocked">ActivityStackSupervisor.startActivityUncheckedLocked()</h4>
<p>&#x53C2;&#x6570;&#x4E2D; r &#x4EE3;&#x8868;&#x5373;&#x5C06;&#x8981;&#x542F;&#x52A8;&#x7684; <code>Activity</code> &#x5BF9;&#x5E94;&#x7684; <code>ActivityRecord</code>&#xFF0C;<code>sourceRecord</code> &#x4EE3;&#x8868;&#x8C03;&#x7528;&#x8005;&#x3002;</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> <span class="hljs-title">startActivityUncheckedLocked</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ActivityRecord r, ActivityRecord sourceRecord,
            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor, <span class="hljs-keyword">int</span> startFlags,
            <span class="hljs-keyword">boolean</span> doResume, Bundle options, TaskRecord inTask)</span> </span>{
        <span class="hljs-keyword">final</span> Intent intent = r.intent;
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> callingUid = r.launchedFromUid;

        <span class="hljs-comment">// &#x5982;&#x679C;&#x6307;&#x5B9A;&#x7684;inTask&#x4E0D;&#x5728;Recents&#x5217;&#x8868;&#x4E2D;&#xFF0C;&#x8BA4;&#x4E3A;inTask&#x662F;&#x65E0;&#x6548;&#x7684;</span>
        <span class="hljs-comment">// inTask&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x8868;&#x793A;&#x8C03;&#x7528;&#x8005;&#x5E0C;&#x671B;&#x5728;&#x6307;&#x5B9A;&#x7684;task&#x91CC;&#x9762;&#x542F;&#x52A8;activity</span>
        <span class="hljs-comment">// &#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x4E3A;null</span>
        <span class="hljs-keyword">if</span> (inTask != <span class="hljs-keyword">null</span> &amp;&amp; !inTask.inRecents) {
            inTask = <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-comment">// &#x88AB;&#x542F;&#x52A8;Activity&#x7684;&#x542F;&#x52A8;&#x6A21;&#x5F0F;</span>
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> launchSingleTop = r.launchMode == ActivityInfo.LAUNCH_SINGLE_TOP;
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> launchSingleInstance = r.launchMode == ActivityInfo.LAUNCH_SINGLE_INSTANCE;
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> launchSingleTask = r.launchMode == ActivityInfo.LAUNCH_SINGLE_TASK;

        <span class="hljs-keyword">int</span> launchFlags = intent.getFlags();
        <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_DOCUMENT) != <span class="hljs-number">0</span> &amp;&amp;
                (launchSingleInstance || launchSingleTask)) {
            <span class="hljs-comment">//&#x5F53;Inent&#x4E2D;&#x5B9A;&#x4E49;&#x7684;launch flag&#x548C;manifest&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x6709;&#x51B2;&#x7A81;&#x7684;&#x8BDD;&#x4F18;&#x5148;&#x4F7F;&#x7528;manifest&#x4E2D;&#x5B9A;&#x4E49;&#x7684;</span>
            launchFlags &amp;=
                    ~(Intent.FLAG_ACTIVITY_NEW_DOCUMENT | Intent.FLAG_ACTIVITY_MULTIPLE_TASK);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">switch</span> (r.info.documentLaunchMode) {
                <span class="hljs-keyword">case</span> ActivityInfo.DOCUMENT_LAUNCH_NONE:
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> ActivityInfo.DOCUMENT_LAUNCH_INTO_EXISTING:
                    launchFlags |= Intent.FLAG_ACTIVITY_NEW_DOCUMENT;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> ActivityInfo.DOCUMENT_LAUNCH_ALWAYS:
                    launchFlags |= Intent.FLAG_ACTIVITY_NEW_DOCUMENT;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> ActivityInfo.DOCUMENT_LAUNCH_NEVER:
                    launchFlags &amp;= ~Intent.FLAG_ACTIVITY_MULTIPLE_TASK;
                    <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-comment">// &#x662F;&#x5426;&#x4E3A;&#x540E;&#x53F0;&#x542F;&#x52A8;&#x4EFB;&#x52A1;&#x7684;&#x6807;&#x5FD7;&#x4F4D;</span>
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> launchTaskBehind = r.mLaunchTaskBehind
                &amp;&amp; !launchSingleTask &amp;&amp; !launchSingleInstance
                &amp;&amp; (launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_DOCUMENT) != <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span> (r.resultTo != <span class="hljs-keyword">null</span> &amp;&amp; (launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_TASK) != <span class="hljs-number">0</span>
                &amp;&amp; r.resultTo.task.stack != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x4F46;&#x662F;&#x6B64;&#x65F6;&#x7684;launchFlags&#x6709;FLAG_ACTIVITY_NEW_TASK&#xFF0C;&#x5219;&#x53D6;&#x6D88;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</span>
            r.resultTo.task.stack.sendActivityResultLocked(-<span class="hljs-number">1</span>,
                    r.resultTo, r.resultWho, r.requestCode,
                    Activity.RESULT_CANCELED, <span class="hljs-keyword">null</span>);
            r.resultTo = <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_DOCUMENT) != <span class="hljs-number">0</span> &amp;&amp; r.resultTo == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x8D4B;&#x4E88;FLAG_ACTIVITY_NEW_TASK&#x6807;&#x5FD7;</span>
            launchFlags |= Intent.FLAG_ACTIVITY_NEW_TASK;
        }

        <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_TASK) != <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;android:documentLaunchMode&#x4E3A;always&#xFF0C;&#x90A3;&#x4E48;&#x8BBE;&#x7F6E;FLAG_ACTIVITY_MULTIPLE_TASK&#x6807;&#x5FD7;</span>
            <span class="hljs-comment">// &#x5373;&#x4F7F;&#x5728;&#x5176;&#x4ED6;task&#x91CC;&#x9762;&#x6709;&#x8BE5;Activity&#x4EE5;&#x53CA;&#x542F;&#x52A8;&#xFF0C;&#x4ECD;&#x7136;&#x65B0;&#x5EFA;Task&#x518D;&#x6B21;&#x542F;&#x52A8;&#x4E00;&#x4E2A;Activity</span>
            <span class="hljs-keyword">if</span> (launchTaskBehind
                    || r.info.documentLaunchMode == ActivityInfo.DOCUMENT_LAUNCH_ALWAYS) {
                launchFlags |= Intent.FLAG_ACTIVITY_MULTIPLE_TASK;
            }
        }

        <span class="hljs-comment">// &#x5224;&#x65AD;&#x4E00;&#x4E0B;&#x662F;&#x5426;&#x662F;&#x7528;&#x6237;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x6237;&#x6309;&#x4E0B;Home&#x952E;&#x7B49;&#x7B49;</span>
        <span class="hljs-comment">// &#x5982;&#x679C;&#x662F;&#x7528;&#x6237;&#x7684;&#x884C;&#x4E3A;&#x7684;&#x8BDD;Activity&#x8DF3;&#x8F6C;&#x7684;&#x65F6;&#x5019;&#x662F;&#x8981;&#x8C03;&#x7528;onUserLeaveHint()&#x65B9;&#x6CD5;&#x7684;</span>
        mUserLeaving = (launchFlags &amp; Intent.FLAG_ACTIVITY_NO_USER_ACTION) == <span class="hljs-number">0</span>;

        <span class="hljs-comment">// &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;&#x4E0D;&#x9700;&#x8981;resume&#xFF0C;&#x90A3;&#x4E48;&#x8BBE;&#x7F6E;&#x5EF6;&#x8FDF;resume&#x6807;&#x5FD7;</span>
        <span class="hljs-keyword">if</span> (!doResume) {
            r.delayedResume = <span class="hljs-keyword">true</span>;
        }

        <span class="hljs-comment">// FLAG_ACTIVITY_PREVIOUS_IS_TOP&#x6807;&#x5FD7;&#x6765;&#x51B3;&#x5B9A;&#x5F85;&#x542F;&#x52A8;Activity&#x4F1A;&#x4E0D;&#x4F1A;&#x88AB;&#x4F5C;&#x4E3A;&#x6808;&#x9876;&#xFF0C;</span>
        <span class="hljs-comment">// &#x5982;&#x679C;&#x8C03;&#x7528;&#x8005;&#x5E0C;&#x671B;&#x5F85;&#x542F;&#x52A8;&#x7684;Activity&#x9A6C;&#x4E0A;&#x9500;&#x6BC1;&#xFF0C;&#x5C31;&#x4F1A;&#x4F7F;&#x7528;&#x8BE5;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x3002;</span>
        <span class="hljs-comment">// &#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;notTop&#x4E3A;null</span>
        ActivityRecord notTop =
                (launchFlags &amp; Intent.FLAG_ACTIVITY_PREVIOUS_IS_TOP) != <span class="hljs-number">0</span> ? r : <span class="hljs-keyword">null</span>;

        <span class="hljs-keyword">if</span> ((startFlags&amp;ActivityManager.START_FLAG_ONLY_IF_NEEDED) != <span class="hljs-number">0</span>) {
            ActivityRecord checkedCaller = sourceRecord;
            <span class="hljs-keyword">if</span> (checkedCaller == <span class="hljs-keyword">null</span>) {
                checkedCaller = mFocusedStack.topRunningNonDelayedActivityLocked(notTop);
            }
            <span class="hljs-keyword">if</span> (!checkedCaller.realActivity.equals(r.realActivity)) {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x8C03;&#x7528;&#x8005;&#x548C;&#x88AB;&#x8C03;&#x7528;&#x8005;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;Activity&#xFF0C;&#x53BB;&#x6389;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x90FD;&#x9700;&#x8981;&#x542F;&#x52A8;</span>
                startFlags &amp;= ~ActivityManager.START_FLAG_ONLY_IF_NEEDED;
            }
        }

        <span class="hljs-keyword">boolean</span> addingToTask = <span class="hljs-keyword">false</span>;<span class="hljs-comment">//&#x8868;&#x793A;&#x662F;&#x5426;&#x9700;&#x8981;&#x5728;inTask&#x4E2D;&#x542F;&#x52A8;activity</span>
        TaskRecord reuseTask = <span class="hljs-keyword">null</span>;<span class="hljs-comment">//&#x8868;&#x793A;&#x53EF;&#x4EE5;&#x590D;&#x7528;&#x7684;task</span>
        <span class="hljs-comment">//&#x5F53;&#x8C03;&#x7528;&#x8005;&#x4E0D;&#x662F;&#x6765;&#x81EA;activity&#xFF0C;&#x800C;&#x662F;&#x660E;&#x786E;&#x6307;&#x5B9A;task&#x7684;&#x60C5;&#x51B5;&#x3002;</span>
        <span class="hljs-keyword">if</span> (sourceRecord == <span class="hljs-keyword">null</span> &amp;&amp; inTask != <span class="hljs-keyword">null</span> &amp;&amp; inTask.stack != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">final</span> Intent baseIntent = inTask.getBaseIntent();
            <span class="hljs-keyword">final</span> ActivityRecord root = inTask.getRootActivity();

            &#x2026;&#x2026;

            <span class="hljs-keyword">if</span> (root == <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x5982;&#x679C;inTask&#x662F;&#x4E2A;&#x7A7A;&#x7684;task&#xFF0C;&#x4ECE;baseIntent&#x91CC;&#x9762;&#x6311;&#x9009;&#x51FA;&#x4E00;&#x4E9B;flag&#x8BBE;&#x7F6E;&#x5230;launchFlags</span>
                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> flagsOfInterest = Intent.FLAG_ACTIVITY_NEW_TASK
                        | Intent.FLAG_ACTIVITY_MULTIPLE_TASK | Intent.FLAG_ACTIVITY_NEW_DOCUMENT
                        | Intent.FLAG_ACTIVITY_RETAIN_IN_RECENTS;
                launchFlags = (launchFlags&amp;~flagsOfInterest)
                        | (baseIntent.getFlags()&amp;flagsOfInterest);
                intent.setFlags(launchFlags);
                inTask.setIntent(r);
                addingToTask = <span class="hljs-keyword">true</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_TASK) != <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// &#x5982;&#x679C;inTask&#x975E;&#x7A7A;&#xFF0C;launchFlags&#x8981;&#x6C42;&#x5728;&#x65B0;task&#x91CC;&#x9762;&#x542F;&#x52A8;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x52A0;&#x5165;&#x5230;&#x8FD9;&#x4E2A;task&#x91CC;&#x9762;&#x53BB;</span>
                addingToTask = <span class="hljs-keyword">false</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// &#x5176;&#x4ED6;&#x60C5;&#x51B5;&#x5C31;&#x52A0;&#x5165;&#x5230;inTask</span>
                addingToTask = <span class="hljs-keyword">true</span>;
            }
            <span class="hljs-comment">// &#x5982;&#x679C;inTask&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5C31;&#x4F5C;&#x4E3A;&#x590D;&#x7528;&#x7684;task</span>
            reuseTask = inTask;
        } <span class="hljs-keyword">else</span> {
            inTask = <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-keyword">if</span> (inTask == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x5F53;&#x6CA1;&#x6709;&#x6307;&#x5B9A;task</span>
            <span class="hljs-keyword">if</span> (sourceRecord == <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x8C03;&#x7528;&#x8005;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;activity&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x7684;task&#x91CC;&#x9762;&#x542F;&#x52A8;activity</span>
                <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_TASK) == <span class="hljs-number">0</span> &amp;&amp; inTask == <span class="hljs-keyword">null</span>) {
                    launchFlags |= Intent.FLAG_ACTIVITY_NEW_TASK;
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sourceRecord.launchMode == ActivityInfo.LAUNCH_SINGLE_INSTANCE) {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x8C03;&#x7528;&#x8005;&#x662F;&#x4E00;&#x4E2A;activity&#xFF0C;&#x800C;&#x4E14;&#x8C03;&#x7528;&#x8005;&#x7684;&#x542F;&#x52A8;&#x6A21;&#x5F0F;&#x662F;LAUNCH_SINGLE_INSTANCE&#xFF0C;</span>
                <span class="hljs-comment">// &#x90A3;&#x4E48;&#x4E5F;&#x9700;&#x8981;&#x5728;&#x65B0;&#x7684;task&#x91CC;&#x9762;&#x542F;&#x52A8;</span>
                launchFlags |= Intent.FLAG_ACTIVITY_NEW_TASK;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (launchSingleInstance || launchSingleTask) {
                <span class="hljs-comment">// &#x542F;&#x52A8;&#x6807;&#x5FD7;&#x4F4D;&#x91CC;&#x9762;&#x662F;SingleInstance&#x6216;&#x8005;launchSingleTask&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x5728;&#x65B0;task&#x91CC;&#x9762;&#x542F;&#x52A8;</span>
                launchFlags |= Intent.FLAG_ACTIVITY_NEW_TASK;
            }
        }

        ActivityInfo newTaskInfo = <span class="hljs-keyword">null</span>;
        Intent newTaskIntent = <span class="hljs-keyword">null</span>;
        ActivityStack sourceStack;
        <span class="hljs-keyword">if</span> (sourceRecord != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">if</span> (sourceRecord.finishing) {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x8C03;&#x7528;&#x8005;activity&#x5904;&#x4E8E;&#x6B63;&#x5728;&#x9500;&#x6BC1;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x5728;&#x65B0;&#x7684;task&#x91CC;&#x542F;&#x52A8;</span>
                <span class="hljs-comment">// &#x5E76;&#x4E14;&#x4FDD;&#x5B58;&#x4E00;&#x4E9B;&#x8C03;&#x7528;&#x8005;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x628A;sourceRecord&#x548C;sourceStack&#x7F6E;&#x7A7A;</span>
                <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_TASK) == <span class="hljs-number">0</span>) {
                    launchFlags |= Intent.FLAG_ACTIVITY_NEW_TASK;
                    newTaskInfo = sourceRecord.info;
                    newTaskIntent = sourceRecord.task.intent;
                }
                sourceRecord = <span class="hljs-keyword">null</span>;
                sourceStack = <span class="hljs-keyword">null</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x4E0D;&#x5728;&#x9500;&#x6BC1;&#x72B6;&#x6001;&#xFF0C;&#x628A;&#x5176;&#x6240;&#x5728;&#x7684;&#x6808;&#x8D4B;&#x4E8E;sourceStack</span>
                sourceStack = sourceRecord.task.stack;
            }
        } <span class="hljs-keyword">else</span> {
            sourceStack = <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-keyword">boolean</span> movedHome = <span class="hljs-keyword">false</span>;
        ActivityStack targetStack;
        <span class="hljs-comment">// &#x81F3;&#x6B64;&#xFF0C;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x7684;&#x4FEE;&#x6B63;&#x5DE5;&#x4F5C;&#x7ED3;&#x675F;&#xFF0C;&#x8BBE;&#x7F6E;&#x7ED9;intent</span>
        intent.setFlags(launchFlags);
        <span class="hljs-comment">// &#x770B;&#x662F;&#x5426;&#x9700;&#x8981;&#x52A8;&#x753B;</span>
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> noAnimation = (launchFlags &amp; Intent.FLAG_ACTIVITY_NO_ANIMATION) != <span class="hljs-number">0</span>;

        <span class="hljs-comment">// FLAG_ACTIVITY_NEW_TASK &amp;&amp; FLAG_ACTIVITY_MULTIPLE_TASK &#x8868;&#x793A;&#x4E0D;&#x662F;&#x5728;&#x5F53;&#x524D;&#x4EFB;&#x52A1;&#x4E2D;&#x542F;&#x52A8;&#xFF0C;</span>
        <span class="hljs-comment">// &#x4F46;&#x662F;&#x8981;&#x67E5;&#x770B;&#x662F;&#x5426;&#x6709;&#x76EE;&#x6807;Activity&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x540C;launchSingleInstance&#x548C;launchSingleTask</span>
        <span class="hljs-keyword">if</span> (((launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_TASK) != <span class="hljs-number">0</span> &amp;&amp;
                (launchFlags &amp; Intent.FLAG_ACTIVITY_MULTIPLE_TASK) == <span class="hljs-number">0</span>)
                || launchSingleInstance || launchSingleTask) {

            <span class="hljs-keyword">if</span> (inTask == <span class="hljs-keyword">null</span> &amp;&amp; r.resultTo == <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x5728;&#x6CA1;&#x6709;&#x6307;&#x5B9A;task&#x4E14;&#x4E0D;&#x8981;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53BB;&#x67E5;&#x627E;&#x662F;&#x5426;&#x6709;&#x5339;&#x914D;&#x7684;activity</span>
                <span class="hljs-comment">// findTaskLocked&#x662F;&#x627E;&#x5230;&#x5339;&#x914D;&#x7684;&#x76EE;&#x6807;ActivityRecord&#x6240;&#x5728;&#x7684;&#x4EFB;&#x52A1;&#x6808;(TaskRecord)&#xFF0C;&#x5305;&#x542B;taskAffinity&#x7684;&#x64CD;&#x4F5C;</span>
                <span class="hljs-comment">// &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x540E;&#x9762;&#x4F1A;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;</span>
                <span class="hljs-comment">// &#x4ECE;&#x6808;&#x9876;&#x81F3;&#x6808;&#x5E95;&#x904D;&#x5386;ActivityStack&#x4E2D;&#x7684;&#x6240;&#x6709;Activity&#xFF0C;&#x6839;&#x636E;Intent&#x548C;ActivityInfo&#x8FD9;</span>
                <span class="hljs-comment">// &#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x5F97;&#x5230;&#x7684;Activity&#x7684;&#x5305;&#x540D;</span>
                ActivityRecord intentActivity = !launchSingleInstance ?
                        findTaskLocked(r) : findActivityLocked(intent, r.info);
                <span class="hljs-keyword">if</span> (intentActivity != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-comment">// intentActivity&#x4E0D;&#x4E3A;&#x7A7A;&#x8868;&#x793A;&#x627E;&#x5230;&#x76EE;&#x6807;activity&#xFF0C;&#x90A3;&#x4E48;&#x76EE;&#x6807;Activity&#x6240;&#x5728;&#x7684;&#x4EFB;&#x52A1;(TaskRecord)</span>
                    <span class="hljs-comment">// &#x548C;&#x4EFB;&#x52A1;&#x6240;&#x5728;&#x7684;&#x6808;(ActivityRecord)&#x5C31;&#x662F;&#x5BBF;&#x4E3B;&#x4EFB;&#x52A1;&#x548C;&#x5BBF;&#x4E3B;&#x6808;</span>
                    <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x901A;&#x8FC7;isLockTaskModeViolation&#x9501;&#x5B9A;&#x5C4F;&#x5E55;&#x7684;&#x90A3;&#x4E9B;Task</span>
                    <span class="hljs-keyword">if</span> (isLockTaskModeViolation(intentActivity.task,
                            (launchFlags &amp; (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_CLEAR_TASK))
                            == (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_CLEAR_TASK))) {
                        <span class="hljs-comment">// &#x5982;&#x679C;&#x4E0D;&#x662F;&#x9501;&#x5B9A;&#x7684;task&#xFF0C;&#x5C31;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
                        <span class="hljs-comment">// lock task mode &#x662F;Android 5.0 Lollipop&#x6DFB;&#x52A0;&#x7684;&#x529F;&#x80FD;</span>
                        showLockTaskToast();
                        <span class="hljs-keyword">return</span> ActivityManager.START_RETURN_LOCK_TASK_MODE_VIOLATION;
                    }
                    <span class="hljs-keyword">if</span> (r.task == <span class="hljs-keyword">null</span>) {
                        r.task = intentActivity.task;
                    }
                    <span class="hljs-keyword">if</span> (intentActivity.task.intent == <span class="hljs-keyword">null</span>) {
                        intentActivity.task.setIntent(r);
                    }
                    targetStack = intentActivity.task.stack;
                    targetStack.mLastPausedActivity = <span class="hljs-keyword">null</span>;

                    <span class="hljs-comment">// &#x5982;&#x679C;&#x76EE;&#x6807;task&#x4E0D;&#x5728;&#x524D;&#x53F0;&#x5C31;&#x9700;&#x8981;&#x628A;&#x5B83;&#x79FB;&#x81F3;&#x524D;&#x53F0;</span>
                    <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x9996;&#x5148;&#x83B7;&#x53D6;&#x7126;&#x70B9;&#x6240;&#x5728;&#x7684;&#x6808;</span>
                    <span class="hljs-keyword">final</span> ActivityStack focusStack = getFocusedStack();
                    <span class="hljs-comment">//&#x4ECE;&#x7126;&#x70B9;&#x6808;&#x91CC;&#x9762;&#x627E;&#x5230;&#x5F53;&#x524D;&#x53EF;&#x89C1;&#x7684;ActivityRecord</span>
                    ActivityRecord curTop = (focusStack == <span class="hljs-keyword">null</span>)
                            ? <span class="hljs-keyword">null</span> : focusStack.topRunningNonDelayedActivityLocked(notTop);
                    <span class="hljs-keyword">boolean</span> movedToFront = <span class="hljs-keyword">false</span>;
                    <span class="hljs-keyword">if</span> (curTop != <span class="hljs-keyword">null</span> &amp;&amp; (curTop.task != intentActivity.task ||
                            curTop.task != focusStack.topTask())) {
                        <span class="hljs-comment">// &#x6EE1;&#x8DB3;&#x4E0A;&#x9762;&#x7684;&#x6761;&#x4EF6;&#x8868;&#x793A;&#x5F85;&#x542F;&#x52A8;&#x7684;activity&#x548C;&#x5F53;&#x524D;&#x53EF;&#x89C1;activity&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x4E2A;task</span>
                        <span class="hljs-comment">// &#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x5C06;&#x5F85;&#x542F;&#x52A8;&#x7684;activity&#x6240;&#x5728;&#x7684;&#x6808;&#x79FB;&#x52A8;&#x5230;&#x524D;&#x53F0;</span>
                        r.intent.addFlags(Intent.FLAG_ACTIVITY_BROUGHT_TO_FRONT);
                        <span class="hljs-keyword">if</span> (sourceRecord == <span class="hljs-keyword">null</span> || (sourceStack.topActivity() != <span class="hljs-keyword">null</span> &amp;&amp;
                                sourceStack.topActivity().task == sourceRecord.task)) {
                            <span class="hljs-keyword">if</span> (launchTaskBehind &amp;&amp; sourceRecord != <span class="hljs-keyword">null</span>) {
                                intentActivity.setTaskToAffiliateWith(sourceRecord.task);
                            }
                            movedHome = <span class="hljs-keyword">true</span>;
                            <span class="hljs-comment">// &#x5C06;&#x76EE;&#x6807;&#x4EFB;&#x52A1;&#x79FB;&#x52A8;&#x5230;&#x6808;&#x9876;</span>
                            targetStack.moveTaskToFrontLocked(intentActivity.task, noAnimation,
                                    options, r.appTimeTracker, <span class="hljs-string">&quot;bringingFoundTaskToFront&quot;</span>);
                            movedToFront = <span class="hljs-keyword">true</span>;
                            <span class="hljs-keyword">if</span> ((launchFlags &amp;
                                    (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_TASK_ON_HOME))
                                    == (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_TASK_ON_HOME)) {
                                <span class="hljs-comment">//&#x5C06;toReturnTo&#x8BBE;&#x7F6E;&#x4E3A;home</span>
                                intentActivity.task.setTaskToReturnTo(HOME_ACTIVITY_TYPE);
                            }
                            options = <span class="hljs-keyword">null</span>;
                        }
                    }
                    <span class="hljs-keyword">if</span> (!movedToFront) {
                        <span class="hljs-comment">// &#x5C06;&#x5F53;&#x524D;&#x6808;&#x79FB;&#x52A8;&#x5230;&#x524D;&#x53F0;</span>
                        targetStack.moveToFront(<span class="hljs-string">&quot;intentActivityFound&quot;</span>);
                    }

                    <span class="hljs-comment">// &#x6839;&#x636E;&#x9700;&#x8981;&#x91CD;&#x7F6E;activity&#x6240;&#x5728;&#x7684;task</span>
                    <span class="hljs-keyword">if</span> ((launchFlags&amp;Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED) != <span class="hljs-number">0</span>) {
                        intentActivity = targetStack.resetTaskIfNeededLocked(intentActivity, r);
                    }
                    <span class="hljs-keyword">if</span> ((startFlags &amp; ActivityManager.START_FLAG_ONLY_IF_NEEDED) != <span class="hljs-number">0</span>) {
                        <span class="hljs-comment">// &#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x65B0;&#x7684;activity&#xFF0C;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
                        <span class="hljs-keyword">if</span> (doResume) {
                            resumeTopActivitiesLocked(targetStack, <span class="hljs-keyword">null</span>, options);
                            <span class="hljs-comment">// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x79FB;&#x52A8;&#x5230;&#x524D;&#x53F0;&#xFF0C;&#x901A;&#x77E5;Keyguard</span>
                            <span class="hljs-keyword">if</span> (!movedToFront) {
                                notifyActivityDrawnForKeyguard();
                            }
                        } <span class="hljs-keyword">else</span> {
                            ActivityOptions.abort(options);
                        }
                        <span class="hljs-keyword">return</span> ActivityManager.START_RETURN_INTENT_TO_CALLER;
                    }
                    <span class="hljs-keyword">if</span> ((launchFlags &amp; (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_CLEAR_TASK))
                            == (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_CLEAR_TASK)) {
                        <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x9700;&#x8981;&#x79FB;&#x9664;&#x76EE;&#x6807;task&#x4E2D;&#x6240;&#x6709;&#x5173;&#x8054;&#x7684;&#x5176;&#x4ED6;activity&#xFF0C;&#x5373;&#x8981;&#x5B8C;&#x5168;&#x66FF;&#x4EE3;&#x76EE;&#x6807;task</span>
                        <span class="hljs-comment">// &#x5C06;&#x8BE5;&#x542F;&#x52A8;activity&#x53D8;&#x4E3A;task&#x4E2D;&#x7684;&#x6839;activity</span>
                        reuseTask = intentActivity.task;
                        reuseTask.performClearTaskLocked();
                        reuseTask.setIntent(r);
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((launchFlags &amp; FLAG_ACTIVITY_CLEAR_TOP) != <span class="hljs-number">0</span>
                            || launchSingleInstance || launchSingleTask) {
                        <span class="hljs-comment">// &#x6E05;&#x9664;task&#x4E2D;&#x76EE;&#x6807;activity&#x4E0A;&#x9762;&#x7684;&#x6240;&#x6709;activity&#xFF0C;&#x8FD4;&#x56DE;&#x76EE;&#x6807;activity</span>
                        ActivityRecord top =
                                intentActivity.task.performClearTaskLocked(r, launchFlags);
                        <span class="hljs-keyword">if</span> (top != <span class="hljs-keyword">null</span>) {
                            <span class="hljs-keyword">if</span> (top.frontOfTask) {
                                top.task.setIntent(r);
                            }
                            <span class="hljs-comment">//&#x89E6;&#x53D1;&#x8C03;&#x7528;onNewIntent()</span>
                            top.deliverNewIntentLocked(callingUid, r.intent, r.launchedFromPackage);
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-comment">// A special case: we need to start the activity because it is not</span>
                            <span class="hljs-comment">// currently running, and the caller has asked to clear the current</span>
                            <span class="hljs-comment">// task to have this activity at the top.</span>
                            addingToTask = <span class="hljs-keyword">true</span>;
                            <span class="hljs-comment">// Now pretend like this activity is being started by the top of its</span>
                            <span class="hljs-comment">// task, so it is put in the right place.</span>
                            sourceRecord = intentActivity;
                            TaskRecord task = sourceRecord.task;
                            <span class="hljs-keyword">if</span> (task != <span class="hljs-keyword">null</span> &amp;&amp; task.stack == <span class="hljs-keyword">null</span>) {
                                <span class="hljs-comment">// Target stack got cleared when we all activities were removed</span>
                                <span class="hljs-comment">// above. Go ahead and reset it.</span>
                                targetStack = computeStackFocus(sourceRecord, <span class="hljs-keyword">false</span> <span class="hljs-comment">/* newTask */</span>);
                                targetStack.addTask(
                                        task, !launchTaskBehind <span class="hljs-comment">/* toTop */</span>, <span class="hljs-keyword">false</span> <span class="hljs-comment">/* moving */</span>);
                            }

                        }
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r.realActivity.equals(intentActivity.task.realActivity)) {
                        <span class="hljs-comment">// In this case the top activity on the task is the</span>
                        <span class="hljs-comment">// same as the one being launched, so we take that</span>
                        <span class="hljs-comment">// as a request to bring the task to the foreground.</span>
                        <span class="hljs-comment">// If the top activity in the task is the root</span>
                        <span class="hljs-comment">// activity, deliver this new intent to it if it</span>
                        <span class="hljs-comment">// desires.</span>
                        <span class="hljs-keyword">if</span> (((launchFlags&amp;Intent.FLAG_ACTIVITY_SINGLE_TOP) != <span class="hljs-number">0</span> || launchSingleTop)
                                &amp;&amp; intentActivity.realActivity.equals(r.realActivity)) {
                            ActivityStack.logStartActivity(EventLogTags.AM_NEW_INTENT, r,
                                    intentActivity.task);
                            <span class="hljs-keyword">if</span> (intentActivity.frontOfTask) {
                                intentActivity.task.setIntent(r);
                            }
                            intentActivity.deliverNewIntentLocked(callingUid, r.intent,
                                    r.launchedFromPackage);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!r.intent.filterEquals(intentActivity.task.intent)) {
                            <span class="hljs-comment">// In this case we are launching the root activity</span>
                            <span class="hljs-comment">// of the task, but with a different intent.  We</span>
                            <span class="hljs-comment">// should start a new instance on top.</span>
                            addingToTask = <span class="hljs-keyword">true</span>;
                            sourceRecord = intentActivity;
                        }
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((launchFlags&amp;Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED) == <span class="hljs-number">0</span>) {
                        <span class="hljs-comment">// In this case an activity is being launched in to an</span>
                        <span class="hljs-comment">// existing task, without resetting that task.  This</span>
                        <span class="hljs-comment">// is typically the situation of launching an activity</span>
                        <span class="hljs-comment">// from a notification or shortcut.  We want to place</span>
                        <span class="hljs-comment">// the new activity on top of the current task.</span>
                        addingToTask = <span class="hljs-keyword">true</span>;
                        sourceRecord = intentActivity;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!intentActivity.task.rootWasReset) {
                        <span class="hljs-comment">// In this case we are launching in to an existing task</span>
                        <span class="hljs-comment">// that has not yet been started from its front door.</span>
                        <span class="hljs-comment">// The current task has been brought to the front.</span>
                        <span class="hljs-comment">// Ideally, we&apos;d probably like to place this new task</span>
                        <span class="hljs-comment">// at the bottom of its stack, but that&apos;s a little hard</span>
                        <span class="hljs-comment">// to do with the current organization of the code so</span>
                        <span class="hljs-comment">// for now we&apos;ll just drop it.</span>
                        intentActivity.task.setIntent(r);
                    }
                    <span class="hljs-keyword">if</span> (!addingToTask &amp;&amp; reuseTask == <span class="hljs-keyword">null</span>) {
                        <span class="hljs-comment">// &#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x52A0;&#x5165;&#x6307;&#x5B9A;&#x7684;task&#xFF0C;&#x4E14;&#x4E0D;&#x7528;&#x590D;&#x7528;task&#xFF0C;&#x90A3;&#x4E48;&#x76F4;&#x63A5;&#x628A;&#x627E;&#x5230;&#x7684;&#x76EE;&#x6807;activity&#x63A8;&#x5230;&#x524D;&#x53F0;</span>
                        <span class="hljs-comment">// &#x5E76;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
                        <span class="hljs-keyword">if</span> (doResume) {
                            targetStack.resumeTopActivityLocked(<span class="hljs-keyword">null</span>, options);
                            <span class="hljs-keyword">if</span> (!movedToFront) {
                                notifyActivityDrawnForKeyguard();
                            }
                        } <span class="hljs-keyword">else</span> {
                            ActivityOptions.abort(options);
                        }
                        <span class="hljs-keyword">return</span> ActivityManager.START_TASK_TO_FRONT;
                    }
                }<span class="hljs-comment">//end of (intentActivity != null)</span>
            }<span class="hljs-comment">//end of (inTask == null &amp;&amp; r.resultTo == null)</span>
        }

        <span class="hljs-keyword">if</span> (r.packageName != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x5F85;&#x542F;&#x52A8;activity&#x5305;&#x540D;&#x4E0D;&#x4E3A;&#x7A7A;</span>
            ActivityStack topStack = mFocusedStack;
            ActivityRecord top = topStack.topRunningNonDelayedActivityLocked(notTop);
            <span class="hljs-keyword">if</span> (top != <span class="hljs-keyword">null</span> &amp;&amp; r.resultTo == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">if</span> (top.realActivity.equals(r.realActivity) &amp;&amp; top.userId == r.userId) {
                    <span class="hljs-comment">// &#x5F85;&#x542F;&#x52A8;&#x7684;activity&#x548C;&#x524D;&#x53F0;&#x663E;&#x793A;&#x7684;activity&#x662F;&#x540C;&#x4E00;&#x4E2A;activity&#x7684;&#x60C5;&#x51B5;</span>
                    <span class="hljs-keyword">if</span> (top.app != <span class="hljs-keyword">null</span> &amp;&amp; top.app.thread != <span class="hljs-keyword">null</span>) {
                        <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_SINGLE_TOP) != <span class="hljs-number">0</span>
                            || launchSingleTop || launchSingleTask) {
                            ActivityStack.logStartActivity(EventLogTags.AM_NEW_INTENT, top,
                                    top.task);
                            topStack.mLastPausedActivity = <span class="hljs-keyword">null</span>;
                            <span class="hljs-keyword">if</span> (doResume) {
                                resumeTopActivitiesLocked();
                            }
                            ActivityOptions.abort(options);
                            <span class="hljs-keyword">if</span> ((startFlags&amp;ActivityManager.START_FLAG_ONLY_IF_NEEDED) != <span class="hljs-number">0</span>) {
                                <span class="hljs-keyword">return</span> ActivityManager.START_RETURN_INTENT_TO_CALLER;
                            }
                            top.deliverNewIntentLocked(callingUid, r.intent, r.launchedFromPackage);
                            <span class="hljs-keyword">return</span> ActivityManager.START_DELIVERED_TO_TOP;
                        }
                    }
                }
            }

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//&#x5982;&#x679C;&#x76EE;&#x6807;activity&#x5305;&#x540D;&#x4E3A;&#x7A7A;&#xFF0C;&#x8868;&#x793A;&#x627E;&#x4E0D;&#x5230;&#x5F85;&#x542F;&#x52A8;&#x7684;activity&#xFF0C;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
            <span class="hljs-keyword">if</span> (r.resultTo != <span class="hljs-keyword">null</span> &amp;&amp; r.resultTo.task.stack != <span class="hljs-keyword">null</span>) {
                r.resultTo.task.stack.sendActivityResultLocked(-<span class="hljs-number">1</span>, r.resultTo, r.resultWho,
                        r.requestCode, Activity.RESULT_CANCELED, <span class="hljs-keyword">null</span>);
            }
            ActivityOptions.abort(options);
            <span class="hljs-keyword">return</span> ActivityManager.START_CLASS_NOT_FOUND;
        }
</code></pre>
<p>&#x76EE;&#x6807;activity&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x60C5;&#x51B5;&#xFF1A;</p>
<pre><code class="lang-java">        <span class="hljs-comment">// &#x63A5;&#x4E0B;&#x6765;&#x5904;&#x7406;&#x76EE;&#x6807;activity&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x60C5;&#x51B5;</span>

        <span class="hljs-keyword">boolean</span> newTask = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">boolean</span> keepCurTransition = <span class="hljs-keyword">false</span>;

        TaskRecord taskToAffiliate = launchTaskBehind &amp;&amp; sourceRecord != <span class="hljs-keyword">null</span> ?
                sourceRecord.task : <span class="hljs-keyword">null</span>;

        <span class="hljs-keyword">if</span> (r.resultTo == <span class="hljs-keyword">null</span> &amp;&amp; inTask == <span class="hljs-keyword">null</span> &amp;&amp; !addingToTask
                &amp;&amp; (launchFlags &amp; Intent.FLAG_ACTIVITY_NEW_TASK) != <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x8981;&#x5728;&#x4E00;&#x4E2A;&#x65B0;&#x7684;task&#x4E2D;&#x542F;&#x52A8;activity</span>
            newTask = <span class="hljs-keyword">true</span>;
            targetStack = computeStackFocus(r, newTask);
            targetStack.moveToFront(<span class="hljs-string">&quot;startingNewTask&quot;</span>);

            <span class="hljs-keyword">if</span> (reuseTask == <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x53EF;&#x4EE5;&#x590D;&#x7528;&#x7684;&#x5C31;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;</span>
                r.setTask(targetStack.createTaskRecord(getNextTaskId(),
                        newTaskInfo != <span class="hljs-keyword">null</span> ? newTaskInfo : r.info,
                        newTaskIntent != <span class="hljs-keyword">null</span> ? newTaskIntent : intent,
                        voiceSession, voiceInteractor, !launchTaskBehind <span class="hljs-comment">/* toTop */</span>),
                        taskToAffiliate);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// &#x590D;&#x7528;task</span>
                r.setTask(reuseTask, taskToAffiliate);
            }
            <span class="hljs-keyword">if</span> (isLockTaskModeViolation(r.task)) {
                <span class="hljs-keyword">return</span> ActivityManager.START_RETURN_LOCK_TASK_MODE_VIOLATION;
            }
            <span class="hljs-keyword">if</span> (!movedHome) {
                <span class="hljs-keyword">if</span> ((launchFlags &amp;
                        (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_TASK_ON_HOME))
                        == (FLAG_ACTIVITY_NEW_TASK | FLAG_ACTIVITY_TASK_ON_HOME)) {
                    <span class="hljs-comment">// &#x628A;&#x5F53;&#x524D;&#x65B0;&#x542F;&#x52A8;&#x7684;&#x4EFB;&#x52A1;&#x7F6E;&#x4E8E;Home&#x4EFB;&#x52A1;&#x4E4B;&#x4E0A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6309;back&#x952E;&#x4ECE;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x8FD4;&#x56DE;&#x7684;&#x65F6;&#x5019;</span>
                    <span class="hljs-comment">// &#x4F1A;&#x56DE;&#x5230;home&#xFF0C;&#x5373;&#x4F7F;&#x8FD9;&#x4E2A;&#x4E0D;&#x662F;&#x4ED6;&#x4EEC;&#x6700;&#x540E;&#x770B;&#x89C1;&#x7684;activity</span>
                    r.task.setTaskToReturnTo(HOME_ACTIVITY_TYPE);
                }
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sourceRecord != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x4E0D;&#x7528;&#x5728;&#x65B0;task&#x4E2D;&#x542F;&#x52A8;activity</span>
            <span class="hljs-keyword">final</span> TaskRecord sourceTask = sourceRecord.task;
            <span class="hljs-keyword">if</span> (isLockTaskModeViolation(sourceTask)) {
                <span class="hljs-keyword">return</span> ActivityManager.START_RETURN_LOCK_TASK_MODE_VIOLATION;
            }
            <span class="hljs-comment">// &#x90A3;&#x4E48;&#x76EE;&#x6807;activity&#x7684;&#x6808;&#x4E5F;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x8005;&#x6240;&#x5728;&#x7684;&#x6808;</span>
            targetStack = sourceTask.stack;
            targetStack.moveToFront(<span class="hljs-string">&quot;sourceStackToFront&quot;</span>);
            <span class="hljs-keyword">final</span> TaskRecord topTask = targetStack.topTask();
            <span class="hljs-keyword">if</span> (topTask != sourceTask) {
                <span class="hljs-comment">// &#x79FB;&#x52A8;task&#x5230;&#x524D;&#x53F0;</span>
                targetStack.moveTaskToFrontLocked(sourceTask, noAnimation, options,
                        r.appTimeTracker, <span class="hljs-string">&quot;sourceTaskToFront&quot;</span>);
            }
            <span class="hljs-keyword">if</span> (!addingToTask &amp;&amp; (launchFlags&amp;Intent.FLAG_ACTIVITY_CLEAR_TOP) != <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// &#x6E05;&#x9664;activity</span>
                ActivityRecord top = sourceTask.performClearTaskLocked(r, launchFlags);
                keepCurTransition = <span class="hljs-keyword">true</span>;
                <span class="hljs-keyword">if</span> (top != <span class="hljs-keyword">null</span>) {
                    ActivityStack.logStartActivity(EventLogTags.AM_NEW_INTENT, r, top.task);
                    top.deliverNewIntentLocked(callingUid, r.intent, r.launchedFromPackage);
                    targetStack.mLastPausedActivity = <span class="hljs-keyword">null</span>;
                    <span class="hljs-keyword">if</span> (doResume) {
                        targetStack.resumeTopActivityLocked(<span class="hljs-keyword">null</span>);
                    }
                    ActivityOptions.abort(options);
                    <span class="hljs-keyword">return</span> ActivityManager.START_DELIVERED_TO_TOP;
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addingToTask &amp;&amp;
                    (launchFlags&amp;Intent.FLAG_ACTIVITY_REORDER_TO_FRONT) != <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">final</span> ActivityRecord top = sourceTask.findActivityInHistoryLocked(r);
                <span class="hljs-keyword">if</span> (top != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">final</span> TaskRecord task = top.task;
                    task.moveActivityToFrontLocked(top);
                    ActivityStack.logStartActivity(EventLogTags.AM_NEW_INTENT, r, task);
                    top.updateOptionsLocked(options);
                    top.deliverNewIntentLocked(callingUid, r.intent, r.launchedFromPackage);
                    targetStack.mLastPausedActivity = <span class="hljs-keyword">null</span>;
                    <span class="hljs-keyword">if</span> (doResume) {
                        targetStack.resumeTopActivityLocked(<span class="hljs-keyword">null</span>);
                    }
                    <span class="hljs-keyword">return</span> ActivityManager.START_DELIVERED_TO_TOP;
                }
            }
            r.setTask(sourceTask, <span class="hljs-keyword">null</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (inTask != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x5728;&#x6307;&#x5B9A;&#x7684;task&#x4E2D;&#x542F;&#x52A8;activity</span>
            <span class="hljs-keyword">if</span> (isLockTaskModeViolation(inTask)) {
                <span class="hljs-keyword">return</span> ActivityManager.START_RETURN_LOCK_TASK_MODE_VIOLATION;
            }
            targetStack = inTask.stack;
            targetStack.moveTaskToFrontLocked(inTask, noAnimation, options, r.appTimeTracker,
                    <span class="hljs-string">&quot;inTaskToFront&quot;</span>);

            <span class="hljs-comment">// check&#x4E00;&#x4E0B;&#x662F;&#x5728;&#x8FD9;&#x4E2A;task&#x4E2D;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x65B0;&#x7684;activity&#x6216;&#x8005;&#x662F;&#x590D;&#x7528;&#x5F53;&#x524D;&#x6808;&#x9876;&#x7684;activity</span>
            ActivityRecord top = inTask.getTopActivity();
            <span class="hljs-keyword">if</span> (top != <span class="hljs-keyword">null</span> &amp;&amp; top.realActivity.equals(r.realActivity) &amp;&amp; top.userId == r.userId) {
                <span class="hljs-keyword">if</span> ((launchFlags &amp; Intent.FLAG_ACTIVITY_SINGLE_TOP) != <span class="hljs-number">0</span>
                        || launchSingleTop || launchSingleTask) {
                    ActivityStack.logStartActivity(EventLogTags.AM_NEW_INTENT, top, top.task);
                    <span class="hljs-keyword">if</span> ((startFlags&amp;ActivityManager.START_FLAG_ONLY_IF_NEEDED) != <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">return</span> ActivityManager.START_RETURN_INTENT_TO_CALLER;
                    }
                    top.deliverNewIntentLocked(callingUid, r.intent, r.launchedFromPackage);
                    <span class="hljs-keyword">return</span> ActivityManager.START_DELIVERED_TO_TOP;
                }
            }

            <span class="hljs-keyword">if</span> (!addingToTask) {
                ActivityOptions.abort(options);
                <span class="hljs-keyword">return</span> ActivityManager.START_TASK_TO_FRONT;
            }

            r.setTask(inTask, <span class="hljs-keyword">null</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// &#x65E2;&#x4E0D;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x65B0;&#x7684;activity&#xFF0C;&#x4E5F;&#x4E0D;&#x5728;&#x6307;&#x5B9A;&#x7684;task&#x4E2D;&#x542F;&#x52A8;</span>
            <span class="hljs-comment">// &#x76EE;&#x524D;&#x4E0D;&#x4F1A;&#x8D70;&#x5230;&#x8FD9;&#x4E2A;&#x5206;&#x652F;&#x4E2D;</span>
            targetStack = computeStackFocus(r, newTask);
            targetStack.moveToFront(<span class="hljs-string">&quot;addingToTopTask&quot;</span>);
            ActivityRecord prev = targetStack.topActivity();
            r.setTask(prev != <span class="hljs-keyword">null</span> ? prev.task : targetStack.createTaskRecord(getNextTaskId(),
                            r.info, intent, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">true</span>), <span class="hljs-keyword">null</span>);
            mWindowManager.moveTaskToTop(r.task.taskId);
        }

        mService.grantUriPermissionFromIntentLocked(callingUid, r.packageName,
                intent, r.getUriPermissionsLocked(), r.userId);

        <span class="hljs-keyword">if</span> (sourceRecord != <span class="hljs-keyword">null</span> &amp;&amp; sourceRecord.isRecentsActivity()) {
            r.task.setTaskToReturnTo(RECENTS_ACTIVITY_TYPE);
        }
        <span class="hljs-keyword">if</span> (newTask) {
            EventLog.writeEvent(EventLogTags.AM_CREATE_TASK, r.userId, r.task.taskId);
        }
        ActivityStack.logStartActivity(EventLogTags.AM_CREATE_ACTIVITY, r, r.task);
        targetStack.mLastPausedActivity = <span class="hljs-keyword">null</span>;
        <span class="hljs-comment">// &#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B65;&#x6D41;&#x7A0B;&#xFF0C;&#x542F;&#x52A8;activity</span>
        targetStack.startActivityLocked(r, newTask, doResume, keepCurTransition, options);
        <span class="hljs-keyword">if</span> (!launchTaskBehind) {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x4E0D;&#x662F;&#x5728;&#x540E;&#x53F0;&#x542F;&#x52A8;&#x5C31;&#x628A;&#x7126;&#x70B9;&#x8BBE;&#x7F6E;&#x5728;&#x5F53;&#x524D;activity</span>
            mService.setFocusedActivityLocked(r, <span class="hljs-string">&quot;startedActivity&quot;</span>);
        }
        <span class="hljs-keyword">return</span> ActivityManager.START_SUCCESS;
    }
</code></pre>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x9996;&#x5148;&#x662F;&#x4FEE;&#x6B63;&#x4E86;&#x4E00;&#x4E9B;&#x542F;&#x52A8;&#x53C2;&#x6570;&#xFF0C;&#x63A5;&#x7740;&#x6839;&#x636E;&#x76EE;&#x6807;Activity&#x662F;&#x5426;&#x5B58;&#x5728;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x4E86;&#x5904;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x542F;&#x52A8;activity&#x3002;</p>
<h4 id="activitystackstartactivitylocked">ActivityStack.startActivityLocked()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startActivityLocked</span><span class="hljs-params">(ActivityRecord r, <span class="hljs-keyword">boolean</span> newTask,
            <span class="hljs-keyword">boolean</span> doResume, <span class="hljs-keyword">boolean</span> keepCurTransition, Bundle options)</span> </span>{
        TaskRecord rTask = r.task;
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> taskId = rTask.taskId;
        <span class="hljs-keyword">if</span> (!r.mLaunchTaskBehind &amp;&amp; (taskForIdLocked(taskId) == <span class="hljs-keyword">null</span> || newTask)) {
            <span class="hljs-comment">// &#x5386;&#x53F2;activity&#x88AB;&#x6E05;&#x9664;&#x4E86;&#x6216;&#x8005;&#x662F;&#x660E;&#x786E;&#x8981;&#x6C42;&#x5728;&#x65B0;&#x7684;task&#x542F;&#x52A8;activity</span>
            <span class="hljs-comment">// &#x5C06;task&#x63D2;&#x5165;stack&#x6808;&#x9876;</span>
            insertTaskAtTop(rTask, r);
            <span class="hljs-comment">// &#x8C03;&#x7528;WindowManagerService </span>
            mWindowManager.moveTaskToTop(taskId);
        }
        TaskRecord task = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (!newTask) {
            <span class="hljs-comment">// &#x5728;&#x4E00;&#x4E2A;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;task&#x4E2D;&#x542F;&#x52A8;activity</span>
            <span class="hljs-keyword">boolean</span> startIt = <span class="hljs-keyword">true</span>;<span class="hljs-comment">// &#x662F;&#x5426;&#x9700;&#x8981;&#x542F;&#x52A8;activity&#x7684;&#x6807;&#x5FD7;&#x4F4D;</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> taskNdx = mTaskHistory.size() - <span class="hljs-number">1</span>; taskNdx &gt;= <span class="hljs-number">0</span>; --taskNdx) {
                task = mTaskHistory.get(taskNdx);
                <span class="hljs-keyword">if</span> (task.getTopActivity() == <span class="hljs-keyword">null</span>) {
                    <span class="hljs-comment">//  &#x8BE5;task&#x4E2D;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;activity&#x4E86;</span>
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">if</span> (task == r.task) {
                    <span class="hljs-comment">// &#x5339;&#x914D;&#x5230;&#x76EE;&#x6807;task</span>
                    <span class="hljs-keyword">if</span> (!startIt) {
                        <span class="hljs-comment">// &#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x542F;&#x52A8;&#xFF0C;&#x5C31;&#x5148;&#x6DFB;&#x52A0;&#x5230;&#x6808;&#x9876;</span>
                        task.addActivityToTop(r);
                        r.putInHistory();
                        <span class="hljs-comment">// &#x8C03;&#x7528;WindowManagerService &#x6DFB;&#x52A0;apptoken</span>
                        mWindowManager.addAppToken(task.mActivities.indexOf(r), r.appToken,
                                r.task.taskId, mStackId, r.info.screenOrientation, r.fullscreen,
                                (r.info.flags &amp; ActivityInfo.FLAG_SHOW_FOR_ALL_USERS) != <span class="hljs-number">0</span>,
                                r.userId, r.info.configChanges, task.voiceSession != <span class="hljs-keyword">null</span>,
                                r.mLaunchTaskBehind);
                        <span class="hljs-keyword">if</span> (VALIDATE_TOKENS) {
                            validateAppTokensLocked();
                        }
                        ActivityOptions.abort(options);
                        <span class="hljs-keyword">return</span>;
                    }
                    <span class="hljs-keyword">break</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (task.numFullscreen &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-comment">// &#x5982;&#x679C;&#x5728;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x4E2D;&#x6709;&#x5168;&#x5C4F;&#x663E;&#x793A;&#x7684;activity&#xFF0C;&#x5C31;&#x5148;&#x4E0D;&#x663E;&#x793A;</span>
                    startIt = <span class="hljs-keyword">false</span>;
                }
            }
        }

        <span class="hljs-comment">// &#x8D70;&#x5230;&#x8FD9;&#x91CC;&#x5DF2;&#x7ECF;&#x628A;&#x76EE;&#x6807;activity&#x6240;&#x5728;&#x7684;task&#x63A8;&#x5230;&#x4E86;stack&#x7684;&#x6808;&#x9876;</span>

        <span class="hljs-comment">// &#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x65B0;&#x7684;activity&#x4E2D;&#x542F;&#x52A8;&#xFF0C;&#x800C;&#x4E14;&#x4E0A;&#x9762;&#x67E5;&#x5230;&#x4E86;&#x76EE;&#x6807;task&#xFF0C;&#x4E14;task&#x5728;&#x6808;&#x9876;&#xFF0C;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x8C03;&#x7528;onUserLeaving&#x65B9;&#x6CD5;</span>
        <span class="hljs-keyword">if</span> (task == r.task &amp;&amp; mTaskHistory.indexOf(task) != (mTaskHistory.size() - <span class="hljs-number">1</span>)) {
            mStackSupervisor.mUserLeaving = <span class="hljs-keyword">false</span>;
        }

        task = r.task;

        <span class="hljs-comment">// &#x5C06;activity&#x653E;&#x5230;task&#x7684;&#x6808;&#x9876;</span>
        task.addActivityToTop(r);
        <span class="hljs-comment">// activity&#x79FB;&#x52A8;&#x6216;&#x8005;&#x9500;&#x6BC1;&#x4E4B;&#x540E;&#x8C03;&#x7528;setFrontOfTask&#x65B9;&#x6CD5;</span>
        task.setFrontOfTask();

        r.putInHistory();
        <span class="hljs-keyword">if</span> (!isHomeStack() || numActivities() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// &#x8FDB;&#x5165;&#x8FD9;&#x4E2A;&#x5206;&#x652F;&#x7684;&#x6761;&#x4EF6;&#x5F53;&#x524D;stack&#x4E0D;&#x662F;&#x684C;&#x9762;stack&#xFF0C;&#x4E5F;&#x5373;&#x5F53;&#x524D;&#x662F;&#x5426;&#x662F;&#x684C;&#x9762;&#x3002;&#x6216;&#x8005;&#x5F53;&#x524D;stack&#x4E2D;&#x5DF2;&#x6709;task</span>

            <span class="hljs-comment">// &#x4E00;&#x4E9B;&#x5207;&#x6362;&#x52A8;&#x753B;&#x76F8;&#x5173;&#x7684;&#x64CD;&#x4F5C;</span>
            <span class="hljs-keyword">boolean</span> showStartingIcon = newTask;
            ProcessRecord proc = r.app;
            <span class="hljs-keyword">if</span> (proc == <span class="hljs-keyword">null</span>) {
                proc = mService.mProcessNames.get(r.processName, r.info.applicationInfo.uid);
            }
            <span class="hljs-keyword">if</span> (proc == <span class="hljs-keyword">null</span> || proc.thread == <span class="hljs-keyword">null</span>) {
                showStartingIcon = <span class="hljs-keyword">true</span>;
            }
            <span class="hljs-keyword">if</span> ((r.intent.getFlags() &amp; Intent.FLAG_ACTIVITY_NO_ANIMATION) != <span class="hljs-number">0</span>) {
                mWindowManager.prepareAppTransition(AppTransition.TRANSIT_NONE, keepCurTransition);
                mNoAnimActivities.add(r);
            } <span class="hljs-keyword">else</span> {
                mWindowManager.prepareAppTransition(newTask
                        ? r.mLaunchTaskBehind
                                ? AppTransition.TRANSIT_TASK_OPEN_BEHIND
                                : AppTransition.TRANSIT_TASK_OPEN
                        : AppTransition.TRANSIT_ACTIVITY_OPEN, keepCurTransition);
                mNoAnimActivities.remove(r);
            }
            <span class="hljs-comment">// &#x8C03;&#x7528;WindowManagerService &#x6DFB;&#x52A0;apptoken</span>
            mWindowManager.addAppToken(task.mActivities.indexOf(r),
                    r.appToken, r.task.taskId, mStackId, r.info.screenOrientation, r.fullscreen,
                    (r.info.flags &amp; ActivityInfo.FLAG_SHOW_FOR_ALL_USERS) != <span class="hljs-number">0</span>, r.userId,
                    r.info.configChanges, task.voiceSession != <span class="hljs-keyword">null</span>, r.mLaunchTaskBehind);
            <span class="hljs-keyword">boolean</span> doShow = <span class="hljs-keyword">true</span>;
            <span class="hljs-comment">// &#x4E00;&#x4E9B;&#x663E;&#x793A;StartingWindow&#x7684;&#x64CD;&#x4F5C;</span>
            <span class="hljs-keyword">if</span> (newTask) {
                <span class="hljs-keyword">if</span> ((r.intent.getFlags() &amp; Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED) != <span class="hljs-number">0</span>) {
                    resetTaskIfNeededLocked(r, r);
                    doShow = topRunningNonDelayedActivityLocked(<span class="hljs-keyword">null</span>) == r;
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options != <span class="hljs-keyword">null</span> &amp;&amp; <span class="hljs-keyword">new</span> ActivityOptions(options).getAnimationType()
                    == ActivityOptions.ANIM_SCENE_TRANSITION) {
                doShow = <span class="hljs-keyword">false</span>;
            }
            <span class="hljs-keyword">if</span> (r.mLaunchTaskBehind) {
                mWindowManager.setAppVisibility(r.appToken, <span class="hljs-keyword">true</span>);
                ensureActivitiesVisibleLocked(<span class="hljs-keyword">null</span>, <span class="hljs-number">0</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (SHOW_APP_STARTING_PREVIEW &amp;&amp; doShow) {
                ActivityRecord prev = mResumedActivity;
                <span class="hljs-comment">// prev &#x8868;&#x793A;&#x5F53;&#x524D;&#x5728;resumed&#x72B6;&#x6001;&#x7684;activity</span>
                <span class="hljs-keyword">if</span> (prev != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-comment">// &#x5982;&#x679C;&#x5B83;&#x548C;&#x76EE;&#x6807;activity&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x4E2A;task</span>
                    <span class="hljs-keyword">if</span> (prev.task != r.task) {
                        prev = <span class="hljs-keyword">null</span>;
                    }
                    <span class="hljs-comment">// &#x5728;&#x540C;&#x4E00;&#x4E2A;task&#x4E14;&#x5DF2;&#x7ECF;&#x663E;&#x793A;</span>
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prev.nowVisible) {
                        prev = <span class="hljs-keyword">null</span>;
                    }
                }
                mWindowManager.setAppStartingWindow(
                        r.appToken, r.packageName, r.theme,
                        mService.compatibilityInfoForPackageLocked(
                                r.info.applicationInfo), r.nonLocalizedLabel,
                        r.labelRes, r.icon, r.logo, r.windowFlags,
                        prev != <span class="hljs-keyword">null</span> ? prev.appToken : <span class="hljs-keyword">null</span>, showStartingIcon);
                r.mStartingWindowShown = <span class="hljs-keyword">true</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// &#x8FDB;&#x5165;&#x8FD9;&#x4E2A;&#x5206;&#x652F;&#x6761;&#x4EF6;&#xFF1A;&#x76EE;&#x6807;stack&#x4E2D;&#x8FD8;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;activity&#xFF0C;&#x90A3;&#x5C31;&#x4E0D;&#x8981;&#x505A;&#x4EFB;&#x4F55;&#x52A8;&#x753B;</span>
            <span class="hljs-comment">// &#x8C03;&#x7528;addAppToken&#x7ED1;&#x5B9A;&#x7A97;&#x53E3;</span>
            mWindowManager.addAppToken(task.mActivities.indexOf(r), r.appToken,
                    r.task.taskId, mStackId, r.info.screenOrientation, r.fullscreen,
                    (r.info.flags &amp; ActivityInfo.FLAG_SHOW_FOR_ALL_USERS) != <span class="hljs-number">0</span>, r.userId,
                    r.info.configChanges, task.voiceSession != <span class="hljs-keyword">null</span>, r.mLaunchTaskBehind);
            ActivityOptions.abort(options);
            options = <span class="hljs-keyword">null</span>;
        }
        <span class="hljs-keyword">if</span> (VALIDATE_TOKENS) {
            validateAppTokensLocked();
        }
        <span class="hljs-comment">// &#x663E;&#x793A;activity</span>
        <span class="hljs-keyword">if</span> (doResume) {
            mStackSupervisor.resumeTopActivitiesLocked(<span class="hljs-keyword">this</span>, r, options);
        }
    }
</code></pre>
<h4 id="activitystacksupervisorresumetopactivitieslocked">ActivityStackSupervisor.resumeTopActivitiesLocked()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">resumeTopActivitiesLocked</span><span class="hljs-params">(ActivityStack targetStack, ActivityRecord target,
            Bundle targetOptions)</span> </span>{
        <span class="hljs-keyword">if</span> (targetStack == <span class="hljs-keyword">null</span>) {
            targetStack = mFocusedStack;
        }
        <span class="hljs-comment">// Do targetStack first.</span>
        <span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">if</span> (isFrontStack(targetStack)) {
            result = targetStack.resumeTopActivityLocked(target, targetOptions);
        }
        <span class="hljs-comment">// &#x904D;&#x5386;&#x6240;&#x6709;&#x663E;&#x793A;&#x8BBE;&#x5907;&#x4E0A;&#x7684;ActivityStack</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> displayNdx = mActivityDisplays.size() - <span class="hljs-number">1</span>; displayNdx &gt;= <span class="hljs-number">0</span>; --displayNdx) {
            <span class="hljs-keyword">final</span> ArrayList&lt;ActivityStack&gt; stacks = mActivityDisplays.valueAt(displayNdx).mStacks;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> stackNdx = stacks.size() - <span class="hljs-number">1</span>; stackNdx &gt;= <span class="hljs-number">0</span>; --stackNdx) {
                <span class="hljs-keyword">final</span> ActivityStack stack = stacks.get(stackNdx);
                <span class="hljs-keyword">if</span> (stack == targetStack) {
                    <span class="hljs-comment">// &#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x8FC7;</span>
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">if</span> (isFrontStack(stack)) {
                    <span class="hljs-comment">// &#x7531;&#x5176;&#x4ED6;&#x663E;&#x793A;&#x8BBE;&#x5907;&#x8FDB;&#x884C;&#x5904;&#x7406;</span>
                    stack.resumeTopActivityLocked(<span class="hljs-keyword">null</span>);
                }
            }
        }
        <span class="hljs-keyword">return</span> result;
    }
</code></pre>
<h4 id="activitystackresumetopactivitylocked">ActivityStack.resumeTopActivityLocked()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">resumeTopActivityLocked</span><span class="hljs-params">(ActivityRecord prev, Bundle options)</span> </span>{
        <span class="hljs-keyword">if</span> (mStackSupervisor.inResumeTopActivity) {
            <span class="hljs-comment">// Don&apos;t even start recursing.</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-keyword">boolean</span> result = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// &#x9632;&#x6B62;&#x9012;&#x5F52;&#x8C03;&#x7528;</span>
            mStackSupervisor.inResumeTopActivity = <span class="hljs-keyword">true</span>;
            <span class="hljs-keyword">if</span> (mService.mLockScreenShown == ActivityManagerService.LOCK_SCREEN_LEAVING) {
                mService.mLockScreenShown = ActivityManagerService.LOCK_SCREEN_HIDDEN;
                mService.updateSleepIfNeededLocked();
            }
            result = resumeTopActivityInnerLocked(prev, options);
        } <span class="hljs-keyword">finally</span> {
            mStackSupervisor.inResumeTopActivity = <span class="hljs-keyword">false</span>;
        }
        <span class="hljs-keyword">return</span> result;
    }
</code></pre>
<h4 id="activitystackresumetopactivityinnerlocked">ActivityStack.resumeTopActivityInnerLocked()</h4>
<p>&#x8FD9;&#x91CC;&#x7684;&#x53C2;&#x6570; <code>prev</code> &#x8868;&#x793A;&#x5F85;&#x542F;&#x52A8;&#x7684; <code>ActivityRecord</code>&#x3002;</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">resumeTopActivityInnerLocked</span><span class="hljs-params">(ActivityRecord prev, Bundle options)</span> </span>{

        <span class="hljs-keyword">if</span> (!mService.mBooting &amp;&amp; !mService.mBooted) {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x7CFB;&#x7EDF;&#x8FD8;&#x6CA1;&#x6709;&#x542F;&#x52A8;&#x7ED3;&#x675F;&#xFF0C;&#x8FD9;&#x91CC;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        ActivityRecord parent = mActivityContainer.mParentActivity;
        <span class="hljs-keyword">if</span> ((parent != <span class="hljs-keyword">null</span> &amp;&amp; parent.state != ActivityState.RESUMED) ||
                !mActivityContainer.isAttachedLocked()) {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x5B58;&#x5728;ParentActivity&#x4E14;ParentActivity&#x8FD8;&#x6CA1;&#x6709;resume&#xFF0C;&#x90A3;&#x4E48;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        <span class="hljs-comment">// &#x5728;&#x5F53;&#x524D;activity&#x4E0B;&#x9762;&#x7684;activity&#x5982;&#x679C;&#x6709;&#x5904;&#x4E8E;INITIALIZING&#x800C;&#x4E14;&#x6B63;&#x5728;&#x505A;&#x7A97;&#x53E3;&#x52A8;&#x753B;</span>
        <span class="hljs-comment">// &#x90A3;&#x4E48;&#x5C31;&#x53D6;&#x6D88;&#x8FD9;&#x4E9B;&#x7A97;&#x53E3;&#x52A8;&#x753B;</span>
        cancelInitializingActivities();

        <span class="hljs-comment">// &#x627E;&#x5230;&#x5F53;&#x524D;&#x6808;&#x9876;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;activity&#xFF0C;&#x4E00;&#x822C;&#x8868;&#x793A;&#x5C06;&#x8981;&#x663E;&#x793A;&#x7684;activity</span>
        <span class="hljs-keyword">final</span> ActivityRecord next = topRunningActivityLocked(<span class="hljs-keyword">null</span>);

        <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> userLeaving = mStackSupervisor.mUserLeaving;
        mStackSupervisor.mUserLeaving = <span class="hljs-keyword">false</span>;

        <span class="hljs-keyword">final</span> TaskRecord prevTask = prev != <span class="hljs-keyword">null</span> ? prev.task : <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (next == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x6CA1;&#x6709;&#x5C06;&#x8981;&#x663E;&#x793A;&#x7684;activity</span>
            <span class="hljs-keyword">final</span> String reason = <span class="hljs-string">&quot;noMoreActivities&quot;</span>;
            <span class="hljs-keyword">if</span> (!mFullscreen) {
                <span class="hljs-keyword">final</span> ActivityStack stack = getNextVisibleStackLocked();
                <span class="hljs-keyword">if</span> (adjustFocusToNextVisibleStackLocked(stack, reason)) {
                    <span class="hljs-keyword">return</span> mStackSupervisor.resumeTopActivitiesLocked(stack, prev, <span class="hljs-keyword">null</span>);
                }
            }
            <span class="hljs-comment">// &#x663E;&#x793A;&#x684C;&#x9762;&#xFF0C;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
            ActivityOptions.abort(options);
            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> returnTaskType = prevTask == <span class="hljs-keyword">null</span> || !prevTask.isOverHomeStack() ?
                    HOME_ACTIVITY_TYPE : prevTask.getTaskToReturnTo();
            <span class="hljs-keyword">return</span> isOnHomeDisplay() &amp;&amp;
                    mStackSupervisor.resumeHomeStackTask(returnTaskType, prev, reason);
        }

        next.delayedResume = <span class="hljs-keyword">false</span>;

        <span class="hljs-keyword">if</span> (mResumedActivity == next &amp;&amp; next.state == ActivityState.RESUMED &amp;&amp;
                    mStackSupervisor.allResumedActivitiesComplete()) {
            <span class="hljs-comment">// &#x5F53;&#x524D;&#x6B63;&#x5728;&#x663E;&#x793A;&#x7684;activity&#x5C31;&#x662F;&#x4E0B;&#x4E00;&#x4E2A;&#x5C06;&#x8981;&#x663E;&#x793A;&#x7684;activity&#xFF0C;&#x90A3;&#x4E48;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
            mWindowManager.executeAppTransition();
            mNoAnimActivities.clear();
            ActivityOptions.abort(options);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-keyword">final</span> TaskRecord nextTask = next.task;
        <span class="hljs-keyword">if</span> (prevTask != <span class="hljs-keyword">null</span> &amp;&amp; prevTask.stack == <span class="hljs-keyword">this</span> &amp;&amp;
                prevTask.isOverHomeStack() &amp;&amp; prev.finishing &amp;&amp; prev.frontOfTask) {
            <span class="hljs-keyword">if</span> (prevTask == nextTask) {
                prevTask.setFrontOfTask();
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prevTask != topTask()) {
                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> taskNdx = mTaskHistory.indexOf(prevTask) + <span class="hljs-number">1</span>;
                mTaskHistory.get(taskNdx).setTaskToReturnTo(HOME_ACTIVITY_TYPE);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isOnHomeDisplay()) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isHomeStack()){
                <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> returnTaskType = prevTask == <span class="hljs-keyword">null</span> || !prevTask.isOverHomeStack() ?
                        HOME_ACTIVITY_TYPE : prevTask.getTaskToReturnTo();
                <span class="hljs-keyword">return</span> isOnHomeDisplay() &amp;&amp;
                        mStackSupervisor.resumeHomeStackTask(returnTaskType, prev, <span class="hljs-string">&quot;prevFinished&quot;</span>);
            }
        }

        <span class="hljs-comment">// &#x5982;&#x679C;&#x7CFB;&#x7EDF;&#x5728;&#x4F11;&#x7720;&#x72B6;&#x6001;&#x4E14;&#x6808;&#x9876;activity&#x5728;pause&#x72B6;&#x6001;&#xFF0C;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
        <span class="hljs-keyword">if</span> (mService.isSleepingOrShuttingDown()
                &amp;&amp; mLastPausedActivity == next
                &amp;&amp; mStackSupervisor.allPausedActivitiesComplete()) {
            mWindowManager.executeAppTransition();
            mNoAnimActivities.clear();
            ActivityOptions.abort(options);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-comment">// &#x627E;&#x4E0D;&#x5230;&#x5F85;&#x542F;&#x52A8;activity&#x7684;user&#xFF0C;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
        <span class="hljs-keyword">if</span> (mService.mStartedUsers.get(next.userId) == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-comment">// &#x4ECE;Stopping&#x72B6;&#x6001;&#x8FDB;&#x5165;&#x4F11;&#x7720;&#x72B6;&#x6001;&#x548C;&#x5F85;&#x663E;&#x793A;&#x72B6;&#x6001;&#x5217;&#x8868;&#x4E2D;&#x5220;&#x9664;&#x5F85;&#x542F;&#x52A8;activity</span>
        <span class="hljs-comment">// &#x5F85;&#x542F;&#x52A8;activity&#x6709;&#x53EF;&#x80FD;&#x5904;&#x4E8E;&#x8FD9;&#x4E9B;&#x6570;&#x7EC4;&#x4E2D;</span>
        mStackSupervisor.mStoppingActivities.remove(next);
        mStackSupervisor.mGoingToSleepActivities.remove(next);
        next.sleeping = <span class="hljs-keyword">false</span>;
        mStackSupervisor.mWaitingVisibleActivities.remove(next);

        <span class="hljs-comment">// &#x5982;&#x679C;&#x5F53;&#x524D;&#x6B63;&#x5728;pause&#x4E00;&#x4E9B;activity&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8981;&#x628A;&#x8FD9;&#x4E9B;&#x5DE5;&#x4F5C;&#x505A;&#x5B8C;</span>
        <span class="hljs-comment">// &#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x4E5F;&#x4F1A;&#x7ED3;&#x675F;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</span>
        <span class="hljs-keyword">if</span> (!mStackSupervisor.allPausedActivitiesComplete()) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;activity&#x7684;&#x5207;&#x6362;&#x5DE5;&#x4F5C;&#xFF0C;&#x9996;&#x5148;&#x8981;pause&#x5F53;&#x524D;activity&#xFF0C;&#x5C06;&#x5F85;&#x663E;&#x793A;&#x7684;activity&#x8FDB;&#x884C;resume&#x3002;</p>
<pre><code class="lang-java">        <span class="hljs-comment">// &#x8BBE;&#x7F6E;WakeLock&#xFF0C;&#x4FDD;&#x8BC1;&#x5728;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x7CFB;&#x7EDF;&#x4E0D;&#x4F1A;&#x4F11;&#x7720;</span>
        mStackSupervisor.setLaunchSource(next.info.applicationInfo.uid);

        <span class="hljs-comment">// &#x5F00;&#x59CB;&#x628A;&#x5F53;&#x524D;activity&#x8FDB;&#x5165;pause&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x628A;&#x5F85;&#x663E;&#x793A;activity&#x8FDB;&#x5165;resume&#x72B6;&#x6001;</span>
        <span class="hljs-comment">// &#x5982;&#x679C;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x91CC;&#x9762;&#x6709;FLAG_RESUME_WHILE_PAUSING&#xFF0C;&#x8868;&#x793A;&#x5F53;&#x524D;&#x7684;activity&#x6B63;&#x5728;pause&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x5F85;&#x663E;&#x793A;</span>
        <span class="hljs-comment">// activity&#x7684;resume&#x52A8;&#x4F5C;</span>
        <span class="hljs-keyword">boolean</span> dontWaitForPause = (next.info.flags&amp;ActivityInfo.FLAG_RESUME_WHILE_PAUSING) != <span class="hljs-number">0</span>;
        <span class="hljs-comment">// &#x5F00;&#x59CB;pause stack&#x91CC;&#x9762;&#x7684;activity</span>
        <span class="hljs-keyword">boolean</span> pausing = mStackSupervisor.pauseBackStacks(userLeaving, <span class="hljs-keyword">true</span>, dontWaitForPause);
        <span class="hljs-keyword">if</span> (mResumedActivity != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x628A;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x663E;&#x793A;&#x7684;activity&#x8FDB;&#x5165;pasue&#x72B6;&#x6001;</span>
            pausing |= startPausingLocked(userLeaving, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>, dontWaitForPause);
        }
        <span class="hljs-keyword">if</span> (pausing) {
            <span class="hljs-comment">// pausing&#x4E3A;true&#x8868;&#x793A;&#x5F53;&#x524D;&#x6709;&#x6B63;&#x5728;pause&#x7684;activity&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x91CC;&#x5148;&#x8FD4;&#x56DE;&#xFF0C;&#x7B49;&#x5B8C;&#x5168;pause&#x518D;&#x6267;&#x884C;&#x540E;&#x9762;&#x7684;&#x64CD;&#x4F5C;</span>
            <span class="hljs-comment">// &#x4E00;&#x822C;&#x7B2C;&#x4E00;&#x6B21;&#x4F1A;&#x8D70;&#x8FD9;&#x91CC;&#xFF0C;&#x4F46;&#x662F;&#x5728;startPausingLocked&#x4E2D;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x6267;&#x884C;&#x4EE5;&#x540E;&#x8FD8;&#x4F1A;&#x518D;&#x6B21;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;</span>
            <span class="hljs-comment">// ActivityStack.activityPausedLocked-&gt;ActivityStack.completePauseLocked-&gt;</span>
            <span class="hljs-comment">// ActivityStackSupervisor.resumeTopActivitiesLocked-&gt;ActivityStack.resumeTopActivityLocked()</span>
            <span class="hljs-keyword">if</span> (next.app != <span class="hljs-keyword">null</span> &amp;&amp; next.app.thread != <span class="hljs-keyword">null</span>) {
                mService.updateLruProcessLocked(next.app, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">null</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }

        <span class="hljs-keyword">if</span> (mService.isSleeping() &amp;&amp; mLastNoHistoryActivity != <span class="hljs-keyword">null</span> &amp;&amp;
                !mLastNoHistoryActivity.finishing) {
            requestFinishActivityLocked(mLastNoHistoryActivity.appToken, Activity.RESULT_CANCELED,
                    <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;resume-no-history&quot;</span>, <span class="hljs-keyword">false</span>);
            mLastNoHistoryActivity = <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-keyword">if</span> (prev != <span class="hljs-keyword">null</span> &amp;&amp; prev != next) {
            <span class="hljs-keyword">if</span> (!mStackSupervisor.mWaitingVisibleActivities.contains(prev)
                    &amp;&amp; next != <span class="hljs-keyword">null</span> &amp;&amp; !next.nowVisible) {
                mStackSupervisor.mWaitingVisibleActivities.add(prev);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (prev.finishing) {
                    mWindowManager.setAppVisibility(prev.appToken, <span class="hljs-keyword">false</span>);
                } <span class="hljs-keyword">else</span> {
                }
            }
        }

        <span class="hljs-keyword">try</span> {
            AppGlobals.getPackageManager().setPackageStoppedState(
                    next.packageName, <span class="hljs-keyword">false</span>, next.userId); <span class="hljs-comment">/* <span class="hljs-doctag">TODO:</span> Verify if correct userid */</span>
        } <span class="hljs-keyword">catch</span> (RemoteException e1) {
        } <span class="hljs-keyword">catch</span> (IllegalArgumentException e) {}

        <span class="hljs-keyword">boolean</span> anim = <span class="hljs-keyword">true</span>;
        <span class="hljs-keyword">if</span> (prev != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">if</span> (prev.finishing) {
                <span class="hljs-keyword">if</span> (mNoAnimActivities.contains(prev)) {
                    anim = <span class="hljs-keyword">false</span>;
                    mWindowManager.prepareAppTransition(AppTransition.TRANSIT_NONE, <span class="hljs-keyword">false</span>);
                } <span class="hljs-keyword">else</span> {
                    mWindowManager.prepareAppTransition(prev.task == next.task
                            ? AppTransition.TRANSIT_ACTIVITY_CLOSE
                            : AppTransition.TRANSIT_TASK_CLOSE, <span class="hljs-keyword">false</span>);
                }
                mWindowManager.setAppWillBeHidden(prev.appToken);
                mWindowManager.setAppVisibility(prev.appToken, <span class="hljs-keyword">false</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (DEBUG_TRANSITION) Slog.v(TAG_TRANSITION,
                        <span class="hljs-string">&quot;Prepare open transition: prev=&quot;</span> + prev);
                <span class="hljs-keyword">if</span> (mNoAnimActivities.contains(next)) {
                    anim = <span class="hljs-keyword">false</span>;
                    mWindowManager.prepareAppTransition(AppTransition.TRANSIT_NONE, <span class="hljs-keyword">false</span>);
                } <span class="hljs-keyword">else</span> {
                    mWindowManager.prepareAppTransition(prev.task == next.task
                            ? AppTransition.TRANSIT_ACTIVITY_OPEN
                            : next.mLaunchTaskBehind
                                    ? AppTransition.TRANSIT_TASK_OPEN_BEHIND
                                    : AppTransition.TRANSIT_TASK_OPEN, <span class="hljs-keyword">false</span>);
                }
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">false</span>) {
                mWindowManager.setAppWillBeHidden(prev.appToken);
                mWindowManager.setAppVisibility(prev.appToken, <span class="hljs-keyword">false</span>);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (mNoAnimActivities.contains(next)) {
                anim = <span class="hljs-keyword">false</span>;
                mWindowManager.prepareAppTransition(AppTransition.TRANSIT_NONE, <span class="hljs-keyword">false</span>);
            } <span class="hljs-keyword">else</span> {
                mWindowManager.prepareAppTransition(AppTransition.TRANSIT_ACTIVITY_OPEN, <span class="hljs-keyword">false</span>);
            }
        }

        Bundle resumeAnimOptions = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (anim) {
            ActivityOptions opts = next.getOptionsForTargetActivityLocked();
            <span class="hljs-keyword">if</span> (opts != <span class="hljs-keyword">null</span>) {
                resumeAnimOptions = opts.toBundle();
            }
            next.applyOptionsLocked();
        } <span class="hljs-keyword">else</span> {
            next.clearOptionsLocked();
        }

        ActivityStack lastStack = mStackSupervisor.getLastStack();
        <span class="hljs-keyword">if</span> (next.app != <span class="hljs-keyword">null</span> &amp;&amp; next.app.thread != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x8D70;&#x5230;&#x8FD9;&#x4E2A;&#x5206;&#x652F;&#x8BF4;&#x660E;&#x5F85;&#x542F;&#x52A8;activity&#x6240;&#x5728;&#x7684;&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E86;&#xFF1F;</span>
            mWindowManager.setAppVisibility(next.appToken, <span class="hljs-keyword">true</span>);

            <span class="hljs-comment">// schedule launch ticks to collect information about slow apps.</span>
            next.startLaunchTickingLocked();

            ActivityRecord lastResumedActivity =
                    lastStack == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> :lastStack.mResumedActivity;
            ActivityState lastState = next.state;

            mService.updateCpuStats();
            <span class="hljs-comment">// &#x5F85;&#x542F;&#x52A8;activity&#x72B6;&#x6001;&#x5DF2;&#x7ECF;&#x662F;RESUMED</span>
            next.state = ActivityState.RESUMED;
            mResumedActivity = next;
            next.task.touchActiveTime();
            mRecentTasks.addLocked(next.task);
            mService.updateLruProcessLocked(next.app, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">null</span>);
            updateLRUListLocked(next);
            mService.updateOomAdjLocked();

            <span class="hljs-keyword">boolean</span> notUpdated = <span class="hljs-keyword">true</span>;
            <span class="hljs-keyword">if</span> (mStackSupervisor.isFrontStack(<span class="hljs-keyword">this</span>)) {
                Configuration config = mWindowManager.updateOrientationFromAppTokens(
                        mService.mConfiguration,
                        next.mayFreezeScreenLocked(next.app) ? next.appToken : <span class="hljs-keyword">null</span>);
                <span class="hljs-keyword">if</span> (config != <span class="hljs-keyword">null</span>) {
                    next.frozenBeforeDestroy = <span class="hljs-keyword">true</span>;
                }
                notUpdated = !mService.updateConfigurationLocked(config, next, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);
            }

            <span class="hljs-keyword">if</span> (notUpdated) {
                ActivityRecord nextNext = topRunningActivityLocked(<span class="hljs-keyword">null</span>);
                <span class="hljs-keyword">if</span> (nextNext != next) {
                    mStackSupervisor.scheduleResumeTopActivities();
                }
                <span class="hljs-keyword">if</span> (mStackSupervisor.reportResumedActivityLocked(next)) {
                    mNoAnimActivities.clear();
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
            }

            <span class="hljs-keyword">try</span> {
                ArrayList&lt;ResultInfo&gt; a = next.results;
                <span class="hljs-keyword">if</span> (a != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> N = a.size();
                    <span class="hljs-keyword">if</span> (!next.finishing &amp;&amp; N &gt; <span class="hljs-number">0</span>) {
                        next.app.thread.scheduleSendResult(next.appToken, a);
                    }
                }

                <span class="hljs-keyword">if</span> (next.newIntents != <span class="hljs-keyword">null</span>) {
                    next.app.thread.scheduleNewIntent(next.newIntents, next.appToken);
                }

                EventLog.writeEvent(EventLogTags.AM_RESUME_ACTIVITY, next.userId,
                        System.identityHashCode(next), next.task.taskId, next.shortComponentName);

                next.sleeping = <span class="hljs-keyword">false</span>;
                mService.showAskCompatModeDialogLocked(next);
                next.app.pendingUiClean = <span class="hljs-keyword">true</span>;
                next.app.forceProcessStateUpTo(mService.mTopProcessState);
                next.clearOptionsLocked();
                next.app.thread.scheduleResumeActivity(next.appToken, next.app.repProcState,
                        mService.isNextTransitionForward(), resumeAnimOptions);

                mStackSupervisor.checkReadyForSleepLocked();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-comment">// Whoops, need to restart this activity!</span>
                next.state = lastState;
                <span class="hljs-keyword">if</span> (lastStack != <span class="hljs-keyword">null</span>) {
                    lastStack.mResumedActivity = lastResumedActivity;
                }
                Slog.i(TAG, <span class="hljs-string">&quot;Restarting because process died: &quot;</span> + next);
                <span class="hljs-keyword">if</span> (!next.hasBeenLaunched) {
                    next.hasBeenLaunched = <span class="hljs-keyword">true</span>;
                } <span class="hljs-keyword">else</span>  <span class="hljs-keyword">if</span> (SHOW_APP_STARTING_PREVIEW &amp;&amp; lastStack != <span class="hljs-keyword">null</span> &amp;&amp;
                        mStackSupervisor.isFrontStack(lastStack)) {
                    mWindowManager.setAppStartingWindow(
                            next.appToken, next.packageName, next.theme,
                            mService.compatibilityInfoForPackageLocked(next.info.applicationInfo),
                            next.nonLocalizedLabel, next.labelRes, next.icon, next.logo,
                            next.windowFlags, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">true</span>);
                }
                mStackSupervisor.startSpecificActivityLocked(next, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            }

            <span class="hljs-keyword">try</span> {
                next.visible = <span class="hljs-keyword">true</span>;
                completeResumeLocked(next);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                requestFinishActivityLocked(next.appToken, Activity.RESULT_CANCELED, <span class="hljs-keyword">null</span>,
                        <span class="hljs-string">&quot;resume-exception&quot;</span>, <span class="hljs-keyword">true</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
            }
            next.stopped = <span class="hljs-keyword">false</span>;

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// &#x8D70;&#x5230;&#x8FD9;&#x4E2A;&#x5206;&#x652F;&#x8BF4;&#x660E;&#x5F85;&#x542F;&#x52A8;activity&#x6240;&#x5728;&#x7684;&#x8FDB;&#x7A0B;&#x6CA1;&#x6709;&#x6307;&#x5B9A;</span>
            <span class="hljs-keyword">if</span> (!next.hasBeenLaunched) {
                next.hasBeenLaunched = <span class="hljs-keyword">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (SHOW_APP_STARTING_PREVIEW) {
                    mWindowManager.setAppStartingWindow(
                            next.appToken, next.packageName, next.theme,
                            mService.compatibilityInfoForPackageLocked(
                                    next.info.applicationInfo),
                            next.nonLocalizedLabel,
                            next.labelRes, next.icon, next.logo, next.windowFlags,
                            <span class="hljs-keyword">null</span>, <span class="hljs-keyword">true</span>);
                }
            }
            mStackSupervisor.startSpecificActivityLocked(next, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
</code></pre>
<p>&#x6B64;&#x65B9;&#x6CD5;&#x4E2D;&#x628A;&#x5F85;&#x542F;&#x52A8;activity&#x63A8;&#x5230;&#x6808;&#x9876;&#xFF0C;&#x5E76;&#x628A;activity&#x7684;&#x72B6;&#x6001;&#x7F6E;&#x4E3A;resume&#x72B6;&#x6001;&#x3002;</p>
<h4 id="activitystacksupervisorstartspecificactivitylocked">ActivityStackSupervisor.startSpecificActivityLocked()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">startSpecificActivityLocked</span><span class="hljs-params">(ActivityRecord r,
            <span class="hljs-keyword">boolean</span> andResume, <span class="hljs-keyword">boolean</span> checkConfig)</span> </span>{
        <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x83B7;&#x53D6;&#x4E00;&#x4E0B;activity&#x6240;&#x8FD0;&#x884C;&#x7684;&#x8FDB;&#x7A0B;</span>
        ProcessRecord app = mService.getProcessRecordLocked(r.processName,
                r.info.applicationInfo.uid, <span class="hljs-keyword">true</span>);

        r.task.stack.setLaunchTime(r);
        <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x4F1A;&#x8D70;&#x4E24;&#x4E2A;&#x5206;&#x652F;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x4E0D;&#x5B58;&#x5728;</span>
        <span class="hljs-comment">// &#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x8FDB;&#x7A0B;&#x7684;case&#x4E0B;&#x9762;&#x8D70;&#x7684;&#x6D41;&#x7A0B;&#x5DF2;&#x7ECF;&#x5305;&#x542B;&#x5728;&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;case&#x7684;&#x6D41;&#x7A0B;&#x91CC;&#x9762;</span>
        <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x5355;&#x72EC;&#x4ECB;&#x7ECD;</span>
        <span class="hljs-keyword">if</span> (app != <span class="hljs-keyword">null</span> &amp;&amp; app.thread != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> ((r.info.flags&amp;ActivityInfo.FLAG_MULTIPROCESS) == <span class="hljs-number">0</span>
                        || !<span class="hljs-string">&quot;android&quot;</span>.equals(r.info.packageName)) {
                    app.addPackage(r.info.packageName, r.info.applicationInfo.versionCode,
                            mService.mProcessStats);
                }
                realStartActivityLocked(r, app, andResume, checkConfig);
                <span class="hljs-keyword">return</span>;
            } <span class="hljs-keyword">catch</span> (RemoteException e) {}

            <span class="hljs-comment">// &#x5982;&#x679C;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x90A3;&#x4E48;&#x91CD;&#x542F;&#x53D1;&#x8D77;&#x542F;&#x52A8;activity&#x8FDB;&#x7A0B;</span>
        }
        <span class="hljs-comment">//&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x65B0;&#x8FDB;&#x7A0B;</span>
        mService.startProcessLocked(r.processName, r.info.applicationInfo, <span class="hljs-keyword">true</span>, <span class="hljs-number">0</span>,
                <span class="hljs-string">&quot;activity&quot;</span>, r.intent.getComponent(), <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>);
    }
</code></pre>
<h3 id="ams&#x4E2D;&#x542F;&#x52A8;&#x65B0;&#x8FDB;&#x7A0B;">AMS&#x4E2D;&#x542F;&#x52A8;&#x65B0;&#x8FDB;&#x7A0B;</h3>
<h4 id="activitymanagerservicestartprocesslocked">ActivityManagerService.startProcessLocked()</h4>
<p>&#x8FD9;&#x91CC;&#x5148;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x4EC0;&#x4E48;&#x662F;bad&#x8FDB;&#x7A0B;&#xFF1A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5728;&#x4E00;&#x5206;&#x949F;&#x5185;crash&#x4E24;&#x6B21;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;bad&#x8FDB;&#x7A0B;&#x800C;&#x88AB;&#x6DFB;&#x52A0;&#x5230;<code>mBadProcesses</code>&#x5217;&#x8868;&#xFF0C;<code>BadProcessInfo</code>&#x91CC;&#x9762;&#x4FDD;&#x5B58;&#x4E86;&#x6DFB;&#x52A0;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x679C;&#x5982;&#x679C;&#x7528;&#x6237;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x8FDB;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x628A;&#x8BE5;&#x8FDB;&#x7A0B;&#x91CD;&#x5217;&#x8868;&#x4E2D;&#x5220;&#x9664;&#xFF0C;&#x76F4;&#x5230;&#x4E0B;&#x6B21;crash&#x65F6;&#x3002;</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">final</span> ProcessRecord <span class="hljs-title">startProcessLocked</span><span class="hljs-params">(String processName, ApplicationInfo info,
            <span class="hljs-keyword">boolean</span> knownToBeDead, <span class="hljs-keyword">int</span> intentFlags, String hostingType, ComponentName hostingName,
            <span class="hljs-keyword">boolean</span> allowWhileBooting, <span class="hljs-keyword">boolean</span> isolated, <span class="hljs-keyword">int</span> isolatedUid, <span class="hljs-keyword">boolean</span> keepIfLarge,
            String abiOverride, String entryPoint, String[] entryPointArgs, Runnable crashHandler)</span> </span>{
        <span class="hljs-keyword">long</span> startTime = SystemClock.elapsedRealtime();
        ProcessRecord app;
        <span class="hljs-comment">// &#x4EE3;&#x8868;&#x662F;&#x5426;&#x662F;&#x5B8C;&#x5168;&#x9694;&#x7EDD;&#x7684;&#x6C99;&#x7BB1;&#x8FDB;&#x7A0B;&#xFF0C;&#x5B8C;&#x5168;&#x9694;&#x7EDD;&#x7684;&#x6C99;&#x7BB1;&#x8FDB;&#x7A0B;&#x6BCF;&#x6B21;&#x542F;&#x52A8;&#x90FD;&#x662F;&#x72EC;&#x7ACB;&#x7684;&#xFF0C;&#x4E0D;&#x80FD;&#x590D;&#x7528;&#x5DF2;&#x6709;&#x7684;&#x8FDB;&#x7A0B;&#x4FE1;&#x606F;&#x3002;</span>
        <span class="hljs-keyword">if</span> (!isolated) {
            app = getProcessRecordLocked(processName, info.uid, keepIfLarge);
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: after getProcessRecord&quot;</span>);

            <span class="hljs-keyword">if</span> ((intentFlags &amp; Intent.FLAG_FROM_BACKGROUND) != <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x662F;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x8981;&#x5224;&#x65AD;&#x4E00;&#x4E0B;&#x662F;&#x5426;&#x662F;bad&#x8FDB;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x662F;bad&#x8FDB;&#x7A0B;&#xFF0C;&#x76F4;&#x63A5;&#x9000;&#x51FA;</span>
                <span class="hljs-keyword">if</span> (mBadProcesses.get(info.processName, info.uid) != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// &#x5982;&#x679C;&#x662F;&#x524D;&#x53F0;&#x542F;&#x52A8;&#xFF0C;&#x6E05;&#x9664;bad&#x8FDB;&#x7A0B;&#x6807;&#x5FD7;</span>
                mProcessCrashTimes.remove(info.processName, info.uid);
                <span class="hljs-keyword">if</span> (mBadProcesses.get(info.processName, info.uid) != <span class="hljs-keyword">null</span>) {
                    EventLog.writeEvent(EventLogTags.AM_PROC_GOOD,
                            UserHandle.getUserId(info.uid), info.uid,
                            info.processName);
                    mBadProcesses.remove(info.processName, info.uid);
                    <span class="hljs-keyword">if</span> (app != <span class="hljs-keyword">null</span>) {
                        app.bad = <span class="hljs-keyword">false</span>;
                    }
                }
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x662F;&#x5B8C;&#x5168;&#x9694;&#x7EDD;&#x7684;&#x6C99;&#x7BB1;&#x8FDB;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x80FD;&#x590D;&#x7528;&#x4E00;&#x4E9B;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x7684;&#x8FDB;&#x7A0B;&#x7684;&#x4FE1;&#x606F;&#x3002;</span>
            app = <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-keyword">synchronized</span>(ActivityManagerService.<span class="hljs-keyword">this</span>) {
            nativeMigrateToBoost();
            mIsBoosted = <span class="hljs-keyword">true</span>;
            mBoostStartTime = SystemClock.uptimeMillis();
            Message msg = mHandler.obtainMessage(APP_BOOST_DEACTIVATE_MSG);
            mHandler.sendMessageDelayed(msg, APP_BOOST_MESSAGE_DELAY);
        }

        <span class="hljs-comment">// ProcessRecord&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x4E14;&#x5DF2;&#x7ECF;&#x5206;&#x914D;&#x4E86;pid</span>
        <span class="hljs-keyword">if</span> (app != <span class="hljs-keyword">null</span> &amp;&amp; app.pid &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (!knownToBeDead || app.thread == <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x8C03;&#x7528;&#x8005;&#x4E0D;&#x8BA4;&#x4E3A;&#x8BE5;&#x8FDB;&#x7A0B;&#x5DF2;&#x6B7B;&#x4EA1;&#x6216;&#x8005;&#x6CA1;&#x6709;thread&#x5BF9;&#x8C61;attached&#x5230;&#x8BE5;&#x8FDB;&#x7A0B;.&#x5219;&#x4E0D;&#x5E94;&#x8BE5;&#x6E05;&#x7406;&#x8BE5;&#x8FDB;&#x7A0B;</span>
                app.addPackage(info.packageName, info.versionCode, mProcessStats);
                checkTime(startTime, <span class="hljs-string">&quot;startProcess: done, added package to proc&quot;</span>);
                <span class="hljs-keyword">return</span> app;
            }

            <span class="hljs-comment">// &#x6709;thread&#x5B9E;&#x4F8B;attach&#x5230;&#x8BE5;&#x8FDB;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x6740;&#x6B7B;&#x5E76;&#x6E05;&#x7406;&#x8BE5;&#x8FDB;&#x7A0B;</span>
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: bad proc running, killing&quot;</span>);
            killProcessGroup(app.info.uid, app.pid);
            handleAppDiedLocked(app, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>);
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: done killing old proc&quot;</span>);
        }

        String hostingNameStr = hostingName != <span class="hljs-keyword">null</span>
                ? hostingName.flattenToShortString() : <span class="hljs-keyword">null</span>;

        <span class="hljs-keyword">if</span> (app == <span class="hljs-keyword">null</span>) {
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: creating new process record&quot;</span>);
            <span class="hljs-comment">// &#x521B;&#x5EFA;&#x65B0;&#x7684;ProcessRecord&#x5BF9;&#x8C61;</span>
            app = newProcessRecordLocked(info, processName, isolated, isolatedUid);
            <span class="hljs-keyword">if</span> (app == <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x521B;&#x5EFA;&#x5931;&#x8D25;</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
            }
            app.crashHandler = crashHandler;
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: done creating new process record&quot;</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//&#x5982;&#x679C;&#x8FD9;&#x662F;&#x8FDB;&#x7A0B;&#x4E2D;&#x65B0;package&#xFF0C;&#x5219;&#x6DFB;&#x52A0;&#x5230;&#x5217;&#x8868;</span>
            app.addPackage(info.packageName, info.versionCode, mProcessStats);
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: added package to existing proc&quot;</span>);
        }

        <span class="hljs-comment">//&#x5F53;&#x7CFB;&#x7EDF;&#x672A;&#x51C6;&#x5907;&#x5B8C;&#x6BD5;&#xFF0C;&#x5219;&#x5C06;&#x5F53;&#x524D;&#x8FDB;&#x7A0B;&#x52A0;&#x5165;&#x5230;mProcessesOnHold</span>
        <span class="hljs-keyword">if</span> (!mProcessesReady
                &amp;&amp; !isAllowedWhileBooting(info)
                &amp;&amp; !allowWhileBooting) {
            <span class="hljs-keyword">if</span> (!mProcessesOnHold.contains(app)) {
                mProcessesOnHold.add(app);
            }
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: returning with proc on hold&quot;</span>);
            <span class="hljs-keyword">return</span> app;
        }

        checkTime(startTime, <span class="hljs-string">&quot;startProcess: stepping in to startProcess&quot;</span>);
        <span class="hljs-comment">// &#x542F;&#x52A8;&#x8FDB;&#x7A0B;</span>
        startProcessLocked(
                app, hostingType, hostingNameStr, abiOverride, entryPoint, entryPointArgs);
        checkTime(startTime, <span class="hljs-string">&quot;startProcess: done starting proc!&quot;</span>);
        <span class="hljs-keyword">return</span> (app.pid != <span class="hljs-number">0</span>) ? app : <span class="hljs-keyword">null</span>;
    }
</code></pre>
<h4 id="activitymanagerservicenewprocessrecordlocked">ActivityManagerService.newProcessRecordLocked()</h4>
<p>&#x521B;&#x5EFA;&#x65B0;&#x7684;ProcessRecord&#x5BF9;&#x8C61;</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">final</span> ProcessRecord <span class="hljs-title">newProcessRecordLocked</span><span class="hljs-params">(ApplicationInfo info, String customProcess,
            <span class="hljs-keyword">boolean</span> isolated, <span class="hljs-keyword">int</span> isolatedUid)</span> </span>{
        String proc = customProcess != <span class="hljs-keyword">null</span> ? customProcess : info.processName;
        <span class="hljs-comment">// &#x7535;&#x91CF;&#x7EDF;&#x8BA1;</span>
        BatteryStatsImpl stats = mBatteryStatsService.getActiveStatistics();
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> userId = UserHandle.getUserId(info.uid);
        <span class="hljs-keyword">int</span> uid = info.uid;
        <span class="hljs-keyword">if</span> (isolated) {
            <span class="hljs-comment">// &#x9694;&#x79BB;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;</span>
            ......
        }
        <span class="hljs-keyword">final</span> ProcessRecord r = <span class="hljs-keyword">new</span> ProcessRecord(stats, info, proc, uid);
        <span class="hljs-keyword">if</span> (!mBooted &amp;&amp; !mBooting
                &amp;&amp; userId == UserHandle.USER_OWNER
                &amp;&amp; (info.flags &amp; PERSISTENT_MASK) == PERSISTENT_MASK) {
            r.persistent = <span class="hljs-keyword">true</span>;
        }
        addProcessNameLocked(r);
        <span class="hljs-keyword">return</span> r;
    }
</code></pre>
<h4 id="activitymanagerservicestartprocesslocked">ActivityManagerService.startProcessLocked()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startProcessLocked</span><span class="hljs-params">(ProcessRecord app, String hostingType,
            String hostingNameStr, String abiOverride, String entryPoint, String[] entryPointArgs)</span> </span>{
        <span class="hljs-keyword">long</span> startTime = SystemClock.elapsedRealtime();
        <span class="hljs-keyword">if</span> (app.pid &gt; <span class="hljs-number">0</span> &amp;&amp; app.pid != MY_PID) {
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: removing from pids map&quot;</span>);
            <span class="hljs-keyword">synchronized</span> (mPidsSelfLocked) {
                mPidsSelfLocked.remove(app.pid);
                mHandler.removeMessages(PROC_START_TIMEOUT_MSG, app);
            }
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: done removing from pids map&quot;</span>);
            app.setPid(<span class="hljs-number">0</span>);
        }

        <span class="hljs-comment">// &#x4ECE;HoldProcesses&#x5217;&#x8868;&#x4E2D;&#x79FB;&#x9664;&#x8BE5;ProcessRecord</span>
        mProcessesOnHold.remove(app);

        checkTime(startTime, <span class="hljs-string">&quot;startProcess: starting to update cpu stats&quot;</span>);
        updateCpuStats();
        checkTime(startTime, <span class="hljs-string">&quot;startProcess: done updating cpu stats&quot;</span>);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (AppGlobals.getPackageManager().isPackageFrozen(app.info.packageName)) {
                    <span class="hljs-comment">// This is caught below as if we had failed to fork zygote</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Package &quot;</span> + app.info.packageName + <span class="hljs-string">&quot; is frozen!&quot;</span>);
                }
            } <span class="hljs-keyword">catch</span> (RemoteException e) {
                <span class="hljs-keyword">throw</span> e.rethrowAsRuntimeException();
            }

            <span class="hljs-keyword">int</span> uid = app.uid;
            <span class="hljs-keyword">int</span>[] gids = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">int</span> mountExternal = Zygote.MOUNT_EXTERNAL_NONE;
            <span class="hljs-keyword">if</span> (!app.isolated) {
                <span class="hljs-keyword">int</span>[] permGids = <span class="hljs-keyword">null</span>;
                <span class="hljs-keyword">try</span> {
                    checkTime(startTime, <span class="hljs-string">&quot;startProcess: getting gids from package manager&quot;</span>);
                    <span class="hljs-keyword">final</span> IPackageManager pm = AppGlobals.getPackageManager();
                    permGids = pm.getPackageGids(app.info.packageName, app.userId);
                    MountServiceInternal mountServiceInternal = LocalServices.getService(
                            MountServiceInternal.class);
                    mountExternal = mountServiceInternal.getExternalStorageMountMode(uid,
                            app.info.packageName);
                } <span class="hljs-keyword">catch</span> (RemoteException e) {
                    <span class="hljs-keyword">throw</span> e.rethrowAsRuntimeException();
                }

                <span class="hljs-keyword">if</span> (ArrayUtils.isEmpty(permGids)) {
                    gids = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">2</span>];
                } <span class="hljs-keyword">else</span> {
                    gids = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[permGids.length + <span class="hljs-number">2</span>];
                    System.arraycopy(permGids, <span class="hljs-number">0</span>, gids, <span class="hljs-number">2</span>, permGids.length);
                }
                gids[<span class="hljs-number">0</span>] = UserHandle.getSharedAppGid(UserHandle.getAppId(uid));
                gids[<span class="hljs-number">1</span>] = UserHandle.getUserGid(UserHandle.getUserId(uid));
            }
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: building args&quot;</span>);
            <span class="hljs-keyword">if</span> (mFactoryTest != FactoryTest.FACTORY_TEST_OFF) {
                <span class="hljs-keyword">if</span> (mFactoryTest == FactoryTest.FACTORY_TEST_LOW_LEVEL
                        &amp;&amp; mTopComponent != <span class="hljs-keyword">null</span>
                        &amp;&amp; app.processName.equals(mTopComponent.getPackageName())) {
                    uid = <span class="hljs-number">0</span>;
                }
                <span class="hljs-keyword">if</span> (mFactoryTest == FactoryTest.FACTORY_TEST_HIGH_LEVEL
                        &amp;&amp; (app.info.flags&amp;ApplicationInfo.FLAG_FACTORY_TEST) != <span class="hljs-number">0</span>) {
                    uid = <span class="hljs-number">0</span>;
                }
            }

            <span class="hljs-comment">// &#x8BBE;&#x7F6E;&#x4E00;&#x4E9B;debug&#x53C2;&#x6570;</span>
            <span class="hljs-keyword">int</span> debugFlags = <span class="hljs-number">0</span>;
            ......

            String requiredAbi = (abiOverride != <span class="hljs-keyword">null</span>) ? abiOverride : app.info.primaryCpuAbi;
            <span class="hljs-keyword">if</span> (requiredAbi == <span class="hljs-keyword">null</span>) {
                requiredAbi = Build.SUPPORTED_ABIS[<span class="hljs-number">0</span>];
            }

            String instructionSet = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">if</span> (app.info.primaryCpuAbi != <span class="hljs-keyword">null</span>) {
                instructionSet = VMRuntime.getInstructionSet(app.info.primaryCpuAbi);
            }

            app.gids = gids;
            app.requiredAbi = requiredAbi;
            app.instructionSet = instructionSet;

            <span class="hljs-comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;</span>
            <span class="hljs-keyword">boolean</span> isActivityProcess = (entryPoint == <span class="hljs-keyword">null</span>);
            <span class="hljs-keyword">if</span> (entryPoint == <span class="hljs-keyword">null</span>) entryPoint = <span class="hljs-string">&quot;android.app.ActivityThread&quot;</span>;
            Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="hljs-string">&quot;Start proc: &quot;</span> +
                    app.processName);
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: asking zygote to start proc&quot;</span>);
            Process.ProcessStartResult startResult = Process.start(entryPoint,
                    app.processName, uid, uid, gids, debugFlags, mountExternal,
                    app.info.targetSdkVersion, app.info.seinfo, requiredAbi, instructionSet,
                    app.info.dataDir, entryPointArgs);
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: returned from zygote!&quot;</span>);
            Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);

            <span class="hljs-keyword">if</span> (app.isolated) {
                mBatteryStatsService.addIsolatedUid(app.uid, app.info.uid);
            }
            mBatteryStatsService.noteProcessStart(app.processName, app.info.uid);
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: done updating battery stats&quot;</span>);

            EventLog.writeEvent(EventLogTags.AM_PROC_START,
                    UserHandle.getUserId(uid), startResult.pid, uid,
                    app.processName, hostingType,
                    hostingNameStr != <span class="hljs-keyword">null</span> ? hostingNameStr : <span class="hljs-string">&quot;&quot;</span>);

            <span class="hljs-keyword">if</span> (app.persistent) {
                Watchdog.getInstance().processStarted(app.processName, startResult.pid);
            }
            <span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;&#x53D8;&#x91CF;</span>
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: building log message&quot;</span>);
            app.setPid(startResult.pid);
            app.usingWrapper = startResult.usingWrapper;
            app.removed = <span class="hljs-keyword">false</span>;
            app.killed = <span class="hljs-keyword">false</span>;
            app.killedByAm = <span class="hljs-keyword">false</span>;
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: starting to update pids map&quot;</span>);
            <span class="hljs-comment">//&#x5C06;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x8FDB;&#x7A0B;&#x52A0;&#x5165;&#x5230;mPidsSelfLocked</span>
            <span class="hljs-keyword">synchronized</span> (mPidsSelfLocked) {
                <span class="hljs-keyword">this</span>.mPidsSelfLocked.put(startResult.pid, app);
                <span class="hljs-keyword">if</span> (isActivityProcess) {
                    Message msg = mHandler.obtainMessage(PROC_START_TIMEOUT_MSG);
                    msg.obj = app;
                    mHandler.sendMessageDelayed(msg, startResult.usingWrapper
                            ? PROC_START_TIMEOUT_WITH_WRAPPER : PROC_START_TIMEOUT);
                }
            }
            checkTime(startTime, <span class="hljs-string">&quot;startProcess: done updating pids map&quot;</span>);
        } <span class="hljs-keyword">catch</span> (RuntimeException e) {
            app.setPid(<span class="hljs-number">0</span>);
            mBatteryStatsService.noteProcessFinish(app.processName, app.info.uid);
            <span class="hljs-keyword">if</span> (app.isolated) {
                mBatteryStatsService.removeIsolatedUid(app.uid, app.info.uid);
            }
        }
    }
</code></pre>
<h3 id="&#x65B0;&#x8FDB;&#x7A0B;">&#x65B0;&#x8FDB;&#x7A0B;</h3>
<p><code>Process.start()</code> &#x901A;&#x8FC7;socket&#x901A;&#x4FE1;&#x544A;&#x77E5;Zygote&#x521B;&#x5EFA;fork&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x540E;&#x5C06; <code>ActivityThread</code> &#x7C7B;&#x52A0;&#x8F7D;&#x5230;&#x65B0;&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x8C03;&#x7528; <code>ActivityThread.main()</code> &#x65B9;&#x6CD5;&#x3002;</p>
<h4 id="activitythreadmain">ActivityThread.main()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="hljs-string">&quot;ActivityThreadMain&quot;</span>);
        <span class="hljs-comment">//&#x542F;&#x52A8;&#x6027;&#x80FD;&#x7EDF;&#x8BA1;</span>
        SamplingProfilerIntegration.start();
        CloseGuard.setEnabled(<span class="hljs-keyword">false</span>);

        Environment.initForCurrentUser();
        EventLogger.setReporter(<span class="hljs-keyword">new</span> EventLoggingReporter());
        AndroidKeyStoreProvider.install();
        <span class="hljs-keyword">final</span> File configDir = Environment.getUserConfigDirectory(UserHandle.myUserId());
        TrustedCertificateStore.setDefaultUserDirectory(configDir);

        Process.setArgV0(<span class="hljs-string">&quot;&lt;pre-initialized&gt;&quot;</span>);
        <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;&#x4E3B;&#x7EBF;&#x7A0B;&#x6D88;&#x606F;&#x961F;&#x5217;</span>
        Looper.prepareMainLooper();
        <span class="hljs-comment">// &#x521B;&#x5EFA;ActivityThread&#x5BF9;&#x8C61;</span>
        ActivityThread thread = <span class="hljs-keyword">new</span> ActivityThread();
        thread.attach(<span class="hljs-keyword">false</span>);
        <span class="hljs-comment">// &#x4E3B;&#x7EBF;&#x7A0B;Handler&#x5BF9;&#x8C61;mH</span>
        <span class="hljs-keyword">if</span> (sMainThreadHandler == <span class="hljs-keyword">null</span>) {
            sMainThreadHandler = thread.getHandler();
        }

        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
        <span class="hljs-comment">// &#x6D88;&#x606F;&#x5FAA;&#x73AF;&#x5F00;&#x59CB;&#x8FD0;&#x884C;</span>
        Looper.loop();

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Main thread loop unexpectedly exited&quot;</span>);
    }
</code></pre>
<h4 id="activitythreadattach">ActivityThread.attach()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">attach</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> system)</span> </span>{
        sCurrentActivityThread = <span class="hljs-keyword">this</span>;
        <span class="hljs-comment">// &#x662F;&#x5426;&#x662F;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;</span>
        mSystemThread = system;
        <span class="hljs-keyword">if</span> (!system) {
            ViewRootImpl.addFirstDrawHandler(<span class="hljs-keyword">new</span> Runnable() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
                    ensureJitEnabled();
                }
            });
            <span class="hljs-comment">// &#x6682;&#x65F6;&#x8BBE;&#x7F6E;&#x8FDB;&#x7A0B;&#x7684;&#x540D;&#x5B57;&#x4E3A;&lt;pre-initialized&gt;</span>
            android.ddm.DdmHandleAppName.setAppName(<span class="hljs-string">&quot;&lt;pre-initialized&gt;&quot;</span>,
                                                    UserHandle.myUserId());
            RuntimeInit.setApplicationObject(mAppThread.asBinder());
            <span class="hljs-comment">// &#x8C03;&#x7528;AMS</span>
            <span class="hljs-keyword">final</span> IActivityManager mgr = ActivityManagerNative.getDefault();
            <span class="hljs-keyword">try</span> {
                mgr.attachApplication(mAppThread);
            } <span class="hljs-keyword">catch</span> (RemoteException ex) {}
            <span class="hljs-comment">// GC&#x68C0;&#x6D4B;</span>
            BinderInternal.addGcWatcher(<span class="hljs-keyword">new</span> Runnable() {
                <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (!mSomeActivitiesChanged) {
                        <span class="hljs-keyword">return</span>;
                    }
                    Runtime runtime = Runtime.getRuntime();
                    <span class="hljs-keyword">long</span> dalvikMax = runtime.maxMemory();
                    <span class="hljs-keyword">long</span> dalvikUsed = runtime.totalMemory() - runtime.freeMemory();
                    <span class="hljs-keyword">if</span> (dalvikUsed &gt; ((<span class="hljs-number">3</span>*dalvikMax)/<span class="hljs-number">4</span>)) {
                        <span class="hljs-comment">//&#x5F53;&#x5DF2;&#x7528;&#x5185;&#x5B58;&#x8D85;&#x8FC7;&#x6700;&#x5927;&#x5185;&#x5B58;&#x7684;3/4,&#x5219;&#x8BF7;&#x6C42;&#x91CA;&#x653E;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</span>
                        mSomeActivitiesChanged = <span class="hljs-keyword">false</span>;
                        <span class="hljs-keyword">try</span> {
                            mgr.releaseSomeActivities(mAppThread);
                        } <span class="hljs-keyword">catch</span> (RemoteException e) {
                        }
                    }
                }
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x662F;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#xFF0C;&#x8BBE;&#x7F6E;&#x540D;&#x79F0;&#x4E3A;system_process</span>
            android.ddm.DdmHandleAppName.setAppName(<span class="hljs-string">&quot;system_process&quot;</span>,
                    UserHandle.myUserId());
            <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;mInstrumentation&#x548C;mInitialApplication</span>
            <span class="hljs-comment">// &#x975E;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5728;handleBindApplication()&#x4E2D;&#x8FDB;&#x884C;</span>
            <span class="hljs-keyword">try</span> {
                mInstrumentation = <span class="hljs-keyword">new</span> Instrumentation();
                ContextImpl context = ContextImpl.createAppContext(
                        <span class="hljs-keyword">this</span>, getSystemContext().mPackageInfo);
                mInitialApplication = context.mPackageInfo.makeApplication(<span class="hljs-keyword">true</span>, <span class="hljs-keyword">null</span>);
                mInitialApplication.onCreate();
            } <span class="hljs-keyword">catch</span> (Exception e) {...}
        }

        DropBox.setReporter(<span class="hljs-keyword">new</span> DropBoxReporter());
        <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x8981;&#x5FEB;&#x901F;&#x7684;&#x8BBE;&#x7F6E;Config&#x56DE;&#x8C03;</span>
        ViewRootImpl.addConfigCallback(<span class="hljs-keyword">new</span> ComponentCallbacks2() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigurationChanged</span><span class="hljs-params">(Configuration newConfig)</span> </span>{
                <span class="hljs-keyword">synchronized</span> (mResourcesManager) {
                    <span class="hljs-comment">// &#x5FEB;&#x901F;&#x54CD;&#x5E94;onConfigurationChanged</span>
                    <span class="hljs-keyword">if</span> (mResourcesManager.applyConfigurationToResourcesLocked(newConfig, <span class="hljs-keyword">null</span>)) {
                        <span class="hljs-keyword">if</span> (mPendingConfiguration == <span class="hljs-keyword">null</span> ||
                                mPendingConfiguration.isOtherSeqNewer(newConfig)) {
                            mPendingConfiguration = newConfig;

                            sendMessage(H.CONFIGURATION_CHANGED, newConfig);
                        }
                    }
                }
            }
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onLowMemory</span><span class="hljs-params">()</span> </span>{
            }
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onTrimMemory</span><span class="hljs-params">(<span class="hljs-keyword">int</span> level)</span> </span>{
            }
        });
    }
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#x53C8;&#x4F1A;&#x8F6C;&#x5230; <code>ActivityManagerService</code> &#x8FDB;&#x7A0B;&#x53BB;&#x6267;&#x884C;&#x3002;</p>
<h4 id="activitymanagerserviceattachapplication">ActivityManagerService.attachApplication()</h4>
<pre><code class="lang-java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">attachApplication</span><span class="hljs-params">(IApplicationThread thread)</span> </span>{
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) {
            <span class="hljs-keyword">int</span> callingPid = Binder.getCallingPid();
            <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> origId = Binder.clearCallingIdentity();
            <span class="hljs-comment">// thread&#x662F;ApplicationThreadProxy&#x5BF9;&#x8C61;&#xFF0C;&#x7528;&#x4E8E;&#x548C;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x7684;ApplicationThread&#x901A;&#x4FE1;</span>
            attachApplicationLocked(thread, callingPid);
            Binder.restoreCallingIdentity(origId);
        }
    }
</code></pre>
<h4 id="activitymanagerserviceattachapplicationlocked">ActivityManagerService.attachApplicationLocked()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">attachApplicationLocked</span><span class="hljs-params">(IApplicationThread thread,
            <span class="hljs-keyword">int</span> pid)</span> </span>{

        <span class="hljs-comment">// &#x6839;&#x636E;pid&#x83B7;&#x53D6;&#x5E94;&#x7528;&#x7684;ProcessRecord</span>
        ProcessRecord app;
        <span class="hljs-keyword">if</span> (pid != MY_PID &amp;&amp; pid &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">synchronized</span> (mPidsSelfLocked) {
                app = mPidsSelfLocked.get(pid);
            }
        } <span class="hljs-keyword">else</span> {
            app = <span class="hljs-keyword">null</span>;
        }

        <span class="hljs-keyword">if</span> (app == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// &#x83B7;&#x53D6;ProcessRecord&#x5931;&#x8D25;&#xFF0C;&#x9000;&#x51FA;</span>
            EventLog.writeEvent(EventLogTags.AM_DROP_PROCESS, pid);
            <span class="hljs-keyword">if</span> (pid &gt; <span class="hljs-number">0</span> &amp;&amp; pid != MY_PID) {
                Process.killProcessQuiet(pid);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">try</span> {
                    thread.scheduleExit();
                } <span class="hljs-keyword">catch</span> (Exception e) {}
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-comment">// &#x5982;&#x679C;ProcessRecord&#x8FD8;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x8FDB;&#x7A0B;&#x7ED1;&#x5B9A;&#xFF0C;&#x5C31;&#x6E05;&#x9664;&#x4E4B;&#x524D;&#x7ED1;&#x5B9A;&#x7684;&#x8FDB;&#x7A0B;&#x4FE1;&#x606F;</span>
        <span class="hljs-keyword">if</span> (app.thread != <span class="hljs-keyword">null</span>) {
            handleAppDiedLocked(app, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>);
        }

        <span class="hljs-comment">// &#x7ED1;&#x5B9A;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x7684;DeathRecipient&#xFF0C;&#x5F53;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x5D29;&#x6E83;&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x6536;&#x5230;&#x901A;&#x77E5;</span>
        <span class="hljs-keyword">final</span> String processName = app.processName;
        <span class="hljs-keyword">try</span> {
            AppDeathRecipient adr = <span class="hljs-keyword">new</span> AppDeathRecipient(
                    app, pid, thread);
            thread.asBinder().linkToDeath(adr, <span class="hljs-number">0</span>);
            app.deathRecipient = adr;
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            app.resetPackageList(mProcessStats);
            <span class="hljs-comment">// &#x7ED1;&#x5B9A;&#x5931;&#x8D25;&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x91CD;&#x542F;&#x8FDB;&#x7A0B;</span>
            startProcessLocked(app, <span class="hljs-string">&quot;link fail&quot;</span>, processName);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        EventLog.writeEvent(EventLogTags.AM_PROC_BOUND, app.userId, app.pid, app.processName);
        <span class="hljs-comment">// &#x6FC0;&#x6D3B;ProcessRecord&#xFF0C;&#x8BBE;&#x7F6E;&#x8FDB;&#x7A0B;&#x7684;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;</span>
        app.makeActive(thread, mProcessStats);
        app.curAdj = app.setAdj = -<span class="hljs-number">100</span>;
        app.curSchedGroup = app.setSchedGroup = Process.THREAD_GROUP_DEFAULT;
        app.forcingToForeground = <span class="hljs-keyword">null</span>;
        updateProcessForegroundLocked(app, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);
        app.hasShownUi = <span class="hljs-keyword">false</span>;
        app.debugging = <span class="hljs-keyword">false</span>;
        app.cached = <span class="hljs-keyword">false</span>;
        app.killedByAm = <span class="hljs-keyword">false</span>;
        <span class="hljs-comment">// &#x79FB;&#x9664;&#x8D85;&#x65F6;&#x6807;&#x5FD7;</span>
        mHandler.removeMessages(PROC_START_TIMEOUT_MSG, app);

        <span class="hljs-keyword">boolean</span> normalMode = mProcessesReady || isAllowedWhileBooting(app.info);
        <span class="hljs-comment">// &#x83B7;&#x53D6;&#x5E94;&#x7528;&#x6240;&#x6709;&#x7684;provider</span>
        List&lt;ProviderInfo&gt; providers = normalMode ? generateApplicationProvidersLocked(app) : <span class="hljs-keyword">null</span>;
        <span class="hljs-comment">// &#x5982;&#x679C;&#x6709;provider&#x5728;mLaunchingProviders&#x5217;&#x8868;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x53D1;&#x6D88;&#x606F;&#x79FB;&#x9664;&#x5B83;&#x4EEC;</span>
        <span class="hljs-keyword">if</span> (providers != <span class="hljs-keyword">null</span> &amp;&amp; checkAppInLaunchingProvidersLocked(app)) {
            Message msg = mHandler.obtainMessage(CONTENT_PROVIDER_PUBLISH_TIMEOUT_MSG);
            msg.obj = app;
            mHandler.sendMessageDelayed(msg, CONTENT_PROVIDER_PUBLISH_TIMEOUT);
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">int</span> testMode = IApplicationThread.DEBUG_OFF;
            <span class="hljs-keyword">if</span> (mDebugApp != <span class="hljs-keyword">null</span> &amp;&amp; mDebugApp.equals(processName)) {
                testMode = mWaitForDebugger
                    ? IApplicationThread.DEBUG_WAIT
                    : IApplicationThread.DEBUG_ON;
                app.debugging = <span class="hljs-keyword">true</span>;
                <span class="hljs-keyword">if</span> (mDebugTransient) {
                    mDebugApp = mOrigDebugApp;
                    mWaitForDebugger = mOrigWaitForDebugger;
                }
            }
            String profileFile = app.instrumentationProfileFile;
            ParcelFileDescriptor profileFd = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">int</span> samplingInterval = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">boolean</span> profileAutoStop = <span class="hljs-keyword">false</span>;
            <span class="hljs-keyword">if</span> (mProfileApp != <span class="hljs-keyword">null</span> &amp;&amp; mProfileApp.equals(processName)) {
                mProfileProc = app;
                profileFile = mProfileFile;
                profileFd = mProfileFd;
                samplingInterval = mSamplingInterval;
                profileAutoStop = mAutoStopProfiler;
            }
            <span class="hljs-keyword">boolean</span> enableOpenGlTrace = <span class="hljs-keyword">false</span>;
            <span class="hljs-keyword">if</span> (mOpenGlTraceApp != <span class="hljs-keyword">null</span> &amp;&amp; mOpenGlTraceApp.equals(processName)) {
                enableOpenGlTrace = <span class="hljs-keyword">true</span>;
                mOpenGlTraceApp = <span class="hljs-keyword">null</span>;
            }

            <span class="hljs-keyword">boolean</span> isRestrictedBackupMode = <span class="hljs-keyword">false</span>;
            <span class="hljs-keyword">if</span> (mBackupTarget != <span class="hljs-keyword">null</span> &amp;&amp; mBackupAppName.equals(processName)) {
                isRestrictedBackupMode = (mBackupTarget.backupMode == BackupRecord.RESTORE)
                        || (mBackupTarget.backupMode == BackupRecord.RESTORE_FULL)
                        || (mBackupTarget.backupMode == BackupRecord.BACKUP_FULL);
            }

            ensurePackageDexOpt(app.instrumentationInfo != <span class="hljs-keyword">null</span>
                    ? app.instrumentationInfo.packageName
                    : app.info.packageName);
            <span class="hljs-keyword">if</span> (app.instrumentationClass != <span class="hljs-keyword">null</span>) {
                ensurePackageDexOpt(app.instrumentationClass.getPackageName());
            }
            ApplicationInfo appInfo = app.instrumentationInfo != <span class="hljs-keyword">null</span>
                    ? app.instrumentationInfo : app.info;
            app.compat = compatibilityInfoForPackageLocked(appInfo);
            <span class="hljs-keyword">if</span> (profileFd != <span class="hljs-keyword">null</span>) {
                profileFd = profileFd.dup();
            }
            ProfilerInfo profilerInfo = profileFile == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span>
                    : <span class="hljs-keyword">new</span> ProfilerInfo(profileFile, profileFd, samplingInterval, profileAutoStop);
            <span class="hljs-comment">// &#x53D1;&#x8D77;&#x8DE8;&#x8FDB;&#x7A0B;&#x8C03;&#x7528;&#x3002;&#x7ED1;&#x5B9A;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#xFF0C;&#x53D1;&#x9001;&#x4E00;&#x4E9B;&#x53C2;&#x6570;&#x7ED9;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;</span>
            thread.bindApplication(processName, appInfo, providers, app.instrumentationClass,
                    profilerInfo, app.instrumentationArguments, app.instrumentationWatcher,
                    app.instrumentationUiAutomationConnection, testMode, enableOpenGlTrace,
                    isRestrictedBackupMode || !normalMode, app.persistent,
                    <span class="hljs-keyword">new</span> Configuration(mConfiguration), app.compat,
                    getCommonServicesLocked(app.isolated),
                    mCoreSettingsObserver.getCoreSettingsLocked());
            updateLruProcessLocked(app, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);
            app.lastRequestedGc = app.lastLowMemory = SystemClock.uptimeMillis();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// &#x7ED1;&#x5B9A;&#x5931;&#x8D25;&#x8FD9;&#x91CC;&#x4F1A;&#x91CD;&#x542F;&#x8FDB;&#x7A0B;</span>
            app.resetPackageList(mProcessStats);
            app.unlinkDeathRecipient();
            startProcessLocked(app, <span class="hljs-string">&quot;bind fail&quot;</span>, processName);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-comment">// &#x628A;&#x8FDB;&#x7A0B;&#x4ECE;&#x5F85;&#x542F;&#x52A8;&#x8FDB;&#x7A0B;&#x5217;&#x8868;&#x4E2D;&#x79FB;&#x9664;</span>
        mPersistentStartingProcesses.remove(app);
        mProcessesOnHold.remove(app);

        <span class="hljs-keyword">boolean</span> badApp = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">boolean</span> didSomething = <span class="hljs-keyword">false</span>;

        <span class="hljs-comment">// &#x5904;&#x7406;Activity</span>
        <span class="hljs-keyword">if</span> (normalMode) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">if</span> (mStackSupervisor.attachApplicationLocked(app)) {
                    didSomething = <span class="hljs-keyword">true</span>;
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                badApp = <span class="hljs-keyword">true</span>;
            }
        }

        <span class="hljs-comment">// &#x5904;&#x7406;Service</span>
        <span class="hljs-keyword">if</span> (!badApp) {
            <span class="hljs-keyword">try</span> {
                didSomething |= mServices.attachApplicationLocked(app, processName);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                badApp = <span class="hljs-keyword">true</span>;
            }
        }

        <span class="hljs-comment">// &#x5904;&#x7406;Broadcast</span>
        <span class="hljs-keyword">if</span> (!badApp &amp;&amp; isPendingBroadcastProcessLocked(pid)) {
            <span class="hljs-keyword">try</span> {
                didSomething |= sendPendingBroadcastsLocked(app);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                badApp = <span class="hljs-keyword">true</span>;
            }
        }

        <span class="hljs-keyword">if</span> (!badApp &amp;&amp; mBackupTarget != <span class="hljs-keyword">null</span> &amp;&amp; mBackupTarget.appInfo.uid == app.uid) {
            ensurePackageDexOpt(mBackupTarget.appInfo.packageName);
            <span class="hljs-keyword">try</span> {
                thread.scheduleCreateBackupAgent(mBackupTarget.appInfo,
                        compatibilityInfoForPackageLocked(mBackupTarget.appInfo),
                        mBackupTarget.backupMode);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                badApp = <span class="hljs-keyword">true</span>;
            }
        }
        <span class="hljs-comment">// &#x6740;&#x6389;&#x574F;&#x7684;&#x8FDB;&#x7A0B;</span>
        <span class="hljs-keyword">if</span> (badApp) {
            app.kill(<span class="hljs-string">&quot;error during init&quot;</span>, <span class="hljs-keyword">true</span>);
            handleAppDiedLocked(app, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-keyword">if</span> (!didSomething) {
            updateOomAdjLocked();
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
</code></pre>
<h4 id="activitythreadhandlebindapplication">ActivityThread.handleBindApplication()</h4>
<p>&#x8FD9;&#x91CC;&#x53C8;&#x8F6C;&#x5230;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x6765;&#x5904;&#x7406;&#x8FDB;&#x7A0B;&#x7ED1;&#x5B9A;&#x7684;&#x5DE5;&#x4F5C;&#x3002;</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleBindApplication</span><span class="hljs-params">(AppBindData data)</span> </span>{
        mBoundApplication = data;
        mConfiguration = <span class="hljs-keyword">new</span> Configuration(data.config);
        mCompatConfiguration = <span class="hljs-keyword">new</span> Configuration(data.config);

        mProfiler = <span class="hljs-keyword">new</span> Profiler();
        <span class="hljs-keyword">if</span> (data.initProfilerInfo != <span class="hljs-keyword">null</span>) {
            mProfiler.profileFile = data.initProfilerInfo.profileFile;
            mProfiler.profileFd = data.initProfilerInfo.profileFd;
            mProfiler.samplingInterval = data.initProfilerInfo.samplingInterval;
            mProfiler.autoStopProfiler = data.initProfilerInfo.autoStopProfiler;
        }

        <span class="hljs-comment">// &#x8BBE;&#x7F6E;&#x8FDB;&#x7A0B;&#x7684;&#x540D;&#x5B57;</span>
        Process.setArgV0(data.processName);
        android.ddm.DdmHandleAppName.setAppName(data.processName,
                                                UserHandle.myUserId());

        <span class="hljs-keyword">if</span> (data.persistent) {
            <span class="hljs-comment">// &#x5BF9;persistent&#x8FDB;&#x7A0B;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x5728;&#x4F4E;&#x5185;&#x5B58;&#x8BBE;&#x5907;&#x4E0A;&#x4E0D;&#x7528;&#x786C;&#x4EF6;&#x52A0;&#x901F;</span>
            <span class="hljs-keyword">if</span> (!ActivityManager.isHighEndGfx()) {
                HardwareRenderer.disable(<span class="hljs-keyword">false</span>);
            }
        }

        <span class="hljs-keyword">if</span> (mProfiler.profileFd != <span class="hljs-keyword">null</span>) {
            mProfiler.startProfiling();
        }

        <span class="hljs-keyword">if</span> (data.appInfo.targetSdkVersion &lt;= android.os.Build.VERSION_CODES.HONEYCOMB_MR1) {
            AsyncTask.setDefaultExecutor(AsyncTask.THREAD_POOL_EXECUTOR);
        }

        Message.updateCheckRecycle(data.appInfo.targetSdkVersion);

        <span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x65F6;&#x533A;</span>
        TimeZone.setDefault(<span class="hljs-keyword">null</span>);
        Locale.setDefault(data.config.locale);

        <span class="hljs-comment">// &#x66F4;&#x65B0;&#x7CFB;&#x7EDF;&#x914D;&#x7F6E;</span>
        mResourcesManager.applyConfigurationToResourcesLocked(data.config, data.compatInfo);
        mCurDefaultDisplayDpi = data.config.densityDpi;
        applyCompatConfiguration(mCurDefaultDisplayDpi);

        data.info = getPackageInfoNoCheck(data.appInfo, data.compatInfo);

        <span class="hljs-keyword">if</span> ((data.appInfo.flags&amp;ApplicationInfo.FLAG_SUPPORTS_SCREEN_DENSITIES)
                == <span class="hljs-number">0</span>) {
            mDensityCompatMode = <span class="hljs-keyword">true</span>;
            Bitmap.setDefaultDensity(DisplayMetrics.DENSITY_DEFAULT);
        }
        updateDefaultDensity();

        <span class="hljs-comment">// &#x521B;&#x5EFA;Context&#x4E0A;&#x4E0B;&#x6587;</span>
        <span class="hljs-keyword">final</span> ContextImpl appContext = ContextImpl.createAppContext(<span class="hljs-keyword">this</span>, data.info);
        <span class="hljs-keyword">if</span> (!Process.isIsolated()) {
            ......
        }

        <span class="hljs-comment">// &#x8BBE;&#x7F6E;&#x65F6;&#x533A;&#xFF0C;debug&#x6A21;&#x5F0F;&#xFF0C;StrictMode</span>
        <span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> is24Hr = <span class="hljs-string">&quot;24&quot;</span>.equals(mCoreSettings.getString(Settings.System.TIME_12_24));
        DateFormat.set24HourTimePref(is24Hr);

        View.mDebugViewAttributes =
                mCoreSettings.getInt(Settings.Global.DEBUG_VIEW_ATTRIBUTES, <span class="hljs-number">0</span>) != <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> ((data.appInfo.flags &amp;
             (ApplicationInfo.FLAG_SYSTEM |
              ApplicationInfo.FLAG_UPDATED_SYSTEM_APP)) != <span class="hljs-number">0</span>) {
            StrictMode.conditionallyEnableDebugLogging();
        }
        <span class="hljs-keyword">if</span> (data.appInfo.targetSdkVersion &gt; <span class="hljs-number">9</span>) {
            StrictMode.enableDeathOnNetwork();
        }

        NetworkSecurityPolicy.getInstance().setCleartextTrafficPermitted(
                (data.appInfo.flags &amp; ApplicationInfo.FLAG_USES_CLEARTEXT_TRAFFIC) != <span class="hljs-number">0</span>);

        <span class="hljs-keyword">if</span> (data.debugMode != IApplicationThread.DEBUG_OFF) {
            Debug.changeDebugPort(<span class="hljs-number">8100</span>);
            <span class="hljs-keyword">if</span> (data.debugMode == IApplicationThread.DEBUG_WAIT) {
                IActivityManager mgr = ActivityManagerNative.getDefault();
                <span class="hljs-keyword">try</span> {
                    mgr.showWaitingForDebugger(mAppThread, <span class="hljs-keyword">true</span>);
                } <span class="hljs-keyword">catch</span> (RemoteException ex) {}

                Debug.waitForDebugger();

                <span class="hljs-keyword">try</span> {
                    mgr.showWaitingForDebugger(mAppThread, <span class="hljs-keyword">false</span>);
                } <span class="hljs-keyword">catch</span> (RemoteException ex) {}

            } <span class="hljs-keyword">else</span> { }
        }

        <span class="hljs-keyword">if</span> (data.enableOpenGlTrace) {
            GLUtils.setTracingLevel(<span class="hljs-number">1</span>);
        }

        <span class="hljs-comment">// &#x5982;&#x679C;&#x662F;&#x8C03;&#x8BD5;&#x6A21;&#x5F0F;&#x751F;&#x6210;systrace &#x4FE1;&#x606F;</span>
        <span class="hljs-keyword">boolean</span> appTracingAllowed = (data.appInfo.flags&amp;ApplicationInfo.FLAG_DEBUGGABLE) != <span class="hljs-number">0</span>;
        Trace.setAppTracingAllowed(appTracingAllowed);

        <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;&#x9ED8;&#x8BA4;http&#x4EE3;&#x7406;</span>
        IBinder b = ServiceManager.getService(Context.CONNECTIVITY_SERVICE);
        <span class="hljs-keyword">if</span> (b != <span class="hljs-keyword">null</span>) {
            IConnectivityManager service = IConnectivityManager.Stub.asInterface(b);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">final</span> ProxyInfo proxyInfo = service.getProxyForNetwork(<span class="hljs-keyword">null</span>);
                Proxy.setHttpProxySystemProperty(proxyInfo);
            } <span class="hljs-keyword">catch</span> (RemoteException e) {}
        }

        <span class="hljs-keyword">if</span> (data.instrumentationName != <span class="hljs-keyword">null</span>) {
            InstrumentationInfo ii = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">try</span> {
                ii = appContext.getPackageManager().
                    getInstrumentationInfo(data.instrumentationName, <span class="hljs-number">0</span>);
            } <span class="hljs-keyword">catch</span> (PackageManager.NameNotFoundException e) {
            }
            <span class="hljs-keyword">if</span> (ii == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(
                    <span class="hljs-string">&quot;Unable to find instrumentation info for: &quot;</span>
                    + data.instrumentationName);
            }

            mInstrumentationPackageName = ii.packageName;
            mInstrumentationAppDir = ii.sourceDir;
            mInstrumentationSplitAppDirs = ii.splitSourceDirs;
            mInstrumentationLibDir = ii.nativeLibraryDir;
            mInstrumentedAppDir = data.info.getAppDir();
            mInstrumentedSplitAppDirs = data.info.getSplitAppDirs();
            mInstrumentedLibDir = data.info.getLibDir();

            ApplicationInfo instrApp = <span class="hljs-keyword">new</span> ApplicationInfo();
            instrApp.packageName = ii.packageName;
            instrApp.sourceDir = ii.sourceDir;
            instrApp.publicSourceDir = ii.publicSourceDir;
            instrApp.splitSourceDirs = ii.splitSourceDirs;
            instrApp.splitPublicSourceDirs = ii.splitPublicSourceDirs;
            instrApp.dataDir = ii.dataDir;
            instrApp.nativeLibraryDir = ii.nativeLibraryDir;
            LoadedApk pi = getPackageInfo(instrApp, data.compatInfo,
                    appContext.getClassLoader(), <span class="hljs-keyword">false</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);
            ContextImpl instrContext = ContextImpl.createAppContext(<span class="hljs-keyword">this</span>, pi);

            <span class="hljs-keyword">try</span> {
                java.lang.ClassLoader cl = instrContext.getClassLoader();
                mInstrumentation = (Instrumentation)
                    cl.loadClass(data.instrumentationName.getClassName()).newInstance();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(
                    <span class="hljs-string">&quot;Unable to instantiate instrumentation &quot;</span>
                    + data.instrumentationName + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);
            }

            mInstrumentation.init(<span class="hljs-keyword">this</span>, instrContext, appContext,
                   <span class="hljs-keyword">new</span> ComponentName(ii.packageName, ii.name), data.instrumentationWatcher,
                   data.instrumentationUiAutomationConnection);

            <span class="hljs-keyword">if</span> (mProfiler.profileFile != <span class="hljs-keyword">null</span> &amp;&amp; !ii.handleProfiling
                    &amp;&amp; mProfiler.profileFd == <span class="hljs-keyword">null</span>) {
                mProfiler.handlingProfiling = <span class="hljs-keyword">true</span>;
                File file = <span class="hljs-keyword">new</span> File(mProfiler.profileFile);
                file.getParentFile().mkdirs();
                Debug.startMethodTracing(file.toString(), <span class="hljs-number">8</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
            }

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;mInstrumentation</span>
            mInstrumentation = <span class="hljs-keyword">new</span> Instrumentation();
        }

        <span class="hljs-keyword">if</span> ((data.appInfo.flags&amp;ApplicationInfo.FLAG_LARGE_HEAP) != <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;largeHeap&#xFF0C;&#x6E05;&#x695A;&#x5185;&#x5B58;&#x4E0A;&#x9650;</span>
            dalvik.system.VMRuntime.getRuntime().clearGrowthLimit();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// &#x8BBE;&#x7F6E;&#x5185;&#x5B58;&#x4E0A;&#x9650;</span>
            dalvik.system.VMRuntime.getRuntime().clampGrowthLimit();
        }

        <span class="hljs-keyword">final</span> StrictMode.ThreadPolicy savedPolicy = StrictMode.allowThreadDiskWrites();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// &#x521B;&#x5EFA;Application&#x5BF9;&#x8C61;</span>
            Application app = data.info.makeApplication(data.restrictedBackupMode, <span class="hljs-keyword">null</span>);
            mInitialApplication = app;

            <span class="hljs-comment">// &#x88C5;&#x8F7D;Providers</span>
            <span class="hljs-keyword">if</span> (!data.restrictedBackupMode) {
                List&lt;ProviderInfo&gt; providers = data.providers;
                <span class="hljs-keyword">if</span> (providers != <span class="hljs-keyword">null</span>) {
                    installContentProviders(app, providers);
                    mH.sendEmptyMessageDelayed(H.ENABLE_JIT, <span class="hljs-number">10</span>*<span class="hljs-number">1000</span>);
                }
            }

            <span class="hljs-keyword">try</span> {
                mInstrumentation.onCreate(data.instrumentationArgs);
            }<span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(
                    <span class="hljs-string">&quot;Exception thrown in onCreate() of &quot;</span>
                    + data.instrumentationName + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);
            }

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">//&#x8C03;&#x7528;Application.onCreate()</span>
                mInstrumentation.callApplicationOnCreate(app);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-keyword">if</span> (!mInstrumentation.onException(app, e)) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(
                        <span class="hljs-string">&quot;Unable to create application &quot;</span> + app.getClass().getName()
                        + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);
                }
            }
        } <span class="hljs-keyword">finally</span> {
            StrictMode.setThreadPolicy(savedPolicy);
        }
    }
</code></pre>
<h4 id="activitystacksupervisorattachapplicationlocked">ActivityStackSupervisor.attachApplicationLocked()</h4>
<p>&#x63A5;&#x4E0B;&#x6765;&#x4F1A;&#x7EE7;&#x7EED;&#x5904;&#x7406; <code>ActivityManagerService.attachApplication()</code> &#x4E2D;&#x7684; <code>ActivityStackSupervisor.attachApplicationLocked()</code> &#x65B9;&#x6CD5;&#x3002;&#x5C06; <code>ActivityStackSupervisor</code> &#x7ED1;&#x5B9A;&#x5230;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x3002;</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">attachApplicationLocked</span><span class="hljs-params">(ProcessRecord app)</span> <span class="hljs-keyword">throws</span> RemoteException </span>{
        <span class="hljs-keyword">final</span> String processName = app.processName;
        <span class="hljs-keyword">boolean</span> didSomething = <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> displayNdx = mActivityDisplays.size() - <span class="hljs-number">1</span>; displayNdx &gt;= <span class="hljs-number">0</span>; --displayNdx) {
            ArrayList&lt;ActivityStack&gt; stacks = mActivityDisplays.valueAt(displayNdx).mStacks;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> stackNdx = stacks.size() - <span class="hljs-number">1</span>; stackNdx &gt;= <span class="hljs-number">0</span>; --stackNdx) {
                <span class="hljs-keyword">final</span> ActivityStack stack = stacks.get(stackNdx);
                <span class="hljs-keyword">if</span> (!isFrontStack(stack)) {
                    <span class="hljs-keyword">continue</span>;
                }
                ActivityRecord hr = stack.topRunningActivityLocked(<span class="hljs-keyword">null</span>);
                <span class="hljs-keyword">if</span> (hr != <span class="hljs-keyword">null</span>) {
                    <span class="hljs-keyword">if</span> (hr.app == <span class="hljs-keyword">null</span> &amp;&amp; app.uid == hr.info.applicationInfo.uid
                            &amp;&amp; processName.equals(hr.processName)) {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-comment">// &#x771F;&#x6B63;&#x7684;&#x542F;&#x52A8;activity&#xFF0C;&#x8C03;&#x7528;Activity.onCreate&#xFF0C;&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x7684;&#x6D41;&#x7A0B;</span>
                            <span class="hljs-comment">// &#x5C31;&#x548C;&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x65F6;&#x542F;&#x52A8;activity&#x6D41;&#x7A0B;&#x4E00;&#x6837;&#x7684;&#x4E86;</span>
                            <span class="hljs-keyword">if</span> (realStartActivityLocked(hr, app, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">true</span>)) {
                                didSomething = <span class="hljs-keyword">true</span>;
                            }
                        } <span class="hljs-keyword">catch</span> (RemoteException e) {
                            <span class="hljs-keyword">throw</span> e;
                        }
                    }
                }
            }
        }
        <span class="hljs-keyword">if</span> (!didSomething) {
            ensureActivitiesVisibleLocked(<span class="hljs-keyword">null</span>, <span class="hljs-number">0</span>);
        }
        <span class="hljs-keyword">return</span> didSomething;
    }
</code></pre>
<h4 id="activitystacksupervisorrealstartactivitylocked">ActivityStackSupervisor.realStartActivityLocked()</h4>
<p>&#x5F00;&#x59CB;&#x6267;&#x884C;&#x771F;&#x6B63;&#x7684;Activity&#x542F;&#x52A8;&#x64CD;&#x4F5C;&#xFF0C;&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x7684;&#x6D41;&#x7A0B;&#x5C31;&#x548C;&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x65F6;&#x542F;&#x52A8;activity&#x6D41;&#x7A0B;&#x4E00;&#x6837;&#x7684;&#x4E86;&#x3002;</p>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">realStartActivityLocked</span><span class="hljs-params">(ActivityRecord r,
            ProcessRecord app, <span class="hljs-keyword">boolean</span> andResume, <span class="hljs-keyword">boolean</span> checkConfig)</span>
            <span class="hljs-keyword">throws</span> RemoteException </span>{

        <span class="hljs-keyword">if</span> (andResume) {
            <span class="hljs-comment">// &#x5F00;&#x59CB;&#x51BB;&#x5C4F;</span>
            r.startFreezingScreenLocked(app, <span class="hljs-number">0</span>);
            mWindowManager.setAppVisibility(r.appToken, <span class="hljs-keyword">true</span>);

            r.startLaunchTickingLocked();
        }

        <span class="hljs-keyword">if</span> (checkConfig) {
            Configuration config = mWindowManager.updateOrientationFromAppTokens(
                    mService.mConfiguration,
                    r.mayFreezeScreenLocked(app) ? r.appToken : <span class="hljs-keyword">null</span>);
            mService.updateConfigurationLocked(config, r, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);
        }

        r.app = app;
        app.waitingToKill = <span class="hljs-keyword">null</span>;
        r.launchCount++;
        r.lastLaunchTime = SystemClock.uptimeMillis();

        <span class="hljs-keyword">int</span> idx = app.activities.indexOf(r);
        <span class="hljs-keyword">if</span> (idx &lt; <span class="hljs-number">0</span>) {
            app.activities.add(r);
        }
        mService.updateLruProcessLocked(app, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">null</span>);
        mService.updateOomAdjLocked();

        <span class="hljs-keyword">final</span> TaskRecord task = r.task;
        <span class="hljs-keyword">if</span> (task.mLockTaskAuth == LOCK_TASK_AUTH_LAUNCHABLE ||
                task.mLockTaskAuth == LOCK_TASK_AUTH_LAUNCHABLE_PRIV) {
            setLockTaskModeLocked(task, LOCK_TASK_MODE_LOCKED, <span class="hljs-string">&quot;mLockTaskAuth==LAUNCHABLE&quot;</span>, <span class="hljs-keyword">false</span>);
        }

        <span class="hljs-keyword">final</span> ActivityStack stack = task.stack;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (app.thread == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RemoteException();
            }
            List&lt;ResultInfo&gt; results = <span class="hljs-keyword">null</span>;
            List&lt;ReferrerIntent&gt; newIntents = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">if</span> (andResume) {
                results = r.results;
                newIntents = r.newIntents;
            }
            <span class="hljs-keyword">if</span> (andResume) {
                EventLog.writeEvent(EventLogTags.AM_RESTART_ACTIVITY,
                        r.userId, System.identityHashCode(r),
                        task.taskId, r.shortComponentName);
            }
            <span class="hljs-keyword">if</span> (r.isHomeActivity() &amp;&amp; r.isNotResolverActivity()) {
                <span class="hljs-comment">// Home process &#x662F;task&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;</span>
                mService.mHomeProcess = task.mActivities.get(<span class="hljs-number">0</span>).app;
            }
            mService.ensurePackageDexOpt(r.intent.getComponent().getPackageName());
            r.sleeping = <span class="hljs-keyword">false</span>;
            r.forceNewConfig = <span class="hljs-keyword">false</span>;
            mService.showAskCompatModeDialogLocked(r);
            r.compat = mService.compatibilityInfoForPackageLocked(r.info.applicationInfo);
            ProfilerInfo profilerInfo = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">if</span> (mService.mProfileApp != <span class="hljs-keyword">null</span> &amp;&amp; mService.mProfileApp.equals(app.processName)) {
                <span class="hljs-keyword">if</span> (mService.mProfileProc == <span class="hljs-keyword">null</span> || mService.mProfileProc == app) {
                    mService.mProfileProc = app;
                    <span class="hljs-keyword">final</span> String profileFile = mService.mProfileFile;
                    <span class="hljs-keyword">if</span> (profileFile != <span class="hljs-keyword">null</span>) {
                        ParcelFileDescriptor profileFd = mService.mProfileFd;
                        <span class="hljs-keyword">if</span> (profileFd != <span class="hljs-keyword">null</span>) {
                            <span class="hljs-keyword">try</span> {
                                profileFd = profileFd.dup();
                            } <span class="hljs-keyword">catch</span> (IOException e) {
                                <span class="hljs-keyword">if</span> (profileFd != <span class="hljs-keyword">null</span>) {
                                    <span class="hljs-keyword">try</span> {
                                        profileFd.close();
                                    } <span class="hljs-keyword">catch</span> (IOException o) {
                                    }
                                    profileFd = <span class="hljs-keyword">null</span>;
                                }
                            }
                        }

                        profilerInfo = <span class="hljs-keyword">new</span> ProfilerInfo(profileFile, profileFd,
                                mService.mSamplingInterval, mService.mAutoStopProfiler);
                    }
                }
            }

            <span class="hljs-keyword">if</span> (andResume) {
                app.hasShownUi = <span class="hljs-keyword">true</span>;
                app.pendingUiClean = <span class="hljs-keyword">true</span>;
            }
            app.forceProcessStateUpTo(mService.mTopProcessState);
            <span class="hljs-comment">// &#x8C03;&#x7528;ApplicationThreadNative.ApplicationThreadProxy.scheduleLaunchActivity()&#xFF0C;&#x8DF3;&#x5230;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;</span>
            app.thread.scheduleLaunchActivity(<span class="hljs-keyword">new</span> Intent(r.intent), r.appToken,
                    System.identityHashCode(r), r.info, <span class="hljs-keyword">new</span> Configuration(mService.mConfiguration),
                    <span class="hljs-keyword">new</span> Configuration(stack.mOverrideConfig), r.compat, r.launchedFromPackage,
                    task.voiceInteractor, app.repProcState, r.icicle, r.persistentState, results,
                    newIntents, !andResume, mService.isNextTransitionForward(), profilerInfo);

            <span class="hljs-keyword">if</span> ((app.info.privateFlags&amp;ApplicationInfo.PRIVATE_FLAG_CANT_SAVE_STATE) != <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">if</span> (app.processName.equals(app.info.packageName)) {
                    <span class="hljs-keyword">if</span> (mService.mHeavyWeightProcess != <span class="hljs-keyword">null</span>
                            &amp;&amp; mService.mHeavyWeightProcess != app) {
                        ...
                    }
                    mService.mHeavyWeightProcess = app;
                    Message msg = mService.mHandler.obtainMessage(
                            ActivityManagerService.POST_HEAVY_NOTIFICATION_MSG);
                    msg.obj = r;
                    mService.mHandler.sendMessage(msg);
                }
            }

        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-keyword">if</span> (r.launchFailed) {
                mService.appDiedLocked(app);
                stack.requestFinishActivityLocked(r.appToken, Activity.RESULT_CANCELED, <span class="hljs-keyword">null</span>,
                        <span class="hljs-string">&quot;2nd-crash&quot;</span>, <span class="hljs-keyword">false</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
            }

            app.activities.remove(r);
            <span class="hljs-keyword">throw</span> e;
        }

        r.launchFailed = <span class="hljs-keyword">false</span>;
        ...

        <span class="hljs-keyword">if</span> (andResume) {
            stack.minimalResumeActivityLocked(r);
        } <span class="hljs-keyword">else</span> {
            r.state = STOPPED;
            r.stopped = <span class="hljs-keyword">true</span>;
        }

        <span class="hljs-keyword">if</span> (isFrontStack(stack)) {
            mService.startSetupActivityLocked();
        }

        mService.mServices.updateServiceConnectionActivitiesLocked(r.app);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
</code></pre>
<h4 id="activitythreadhhandlemessagelaunchactivity">ActivityThread.H.handleMessage():LAUNCH_ACTIVITY</h4>
<p>&#x8DF3;&#x8F6C;&#x5230;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x6765;&#x5904;&#x7406;&#xFF0C;&#x4ECE;&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x5C31;&#x5F00;&#x59CB;Activity&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x8FD0;&#x8F6C;&#x4E86;&#x3002;</p>
<pre><code class="lang-java">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span><span class="hljs-params">(Message msg)</span> </span>{
            <span class="hljs-keyword">switch</span> (msg.what) {
                <span class="hljs-keyword">case</span> LAUNCH_ACTIVITY: {
                    Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="hljs-string">&quot;activityStart&quot;</span>);
                    <span class="hljs-keyword">final</span> ActivityClientRecord r = (ActivityClientRecord) msg.obj;

                    r.packageInfo = getPackageInfoNoCheck(
                            r.activityInfo.applicationInfo, r.compatInfo);
                    handleLaunchActivity(r, <span class="hljs-keyword">null</span>);
                    Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);
                } <span class="hljs-keyword">break</span>;
        }
</code></pre>
<h4 id="activitythreadhandlelaunchactivity">ActivityThread.handleLaunchActivity()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleLaunchActivity</span><span class="hljs-params">(ActivityClientRecord r, Intent customIntent)</span> </span>{
        unscheduleGcIdler();
        mSomeActivitiesChanged = <span class="hljs-keyword">true</span>;

        <span class="hljs-keyword">if</span> (r.profilerInfo != <span class="hljs-keyword">null</span>) {
            mProfiler.setProfiler(r.profilerInfo);
            mProfiler.startProfiling();
        }

        handleConfigurationChanged(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);

        <span class="hljs-comment">// &#x521D;&#x59CB;&#x5316;WMS</span>
        WindowManagerGlobal.initialize();
        <span class="hljs-comment">// &#x521B;&#x5EFA;activity&#x5E76;&#x8C03;&#x7528;onCreate&#xFF0C;onStart&#x7B49;&#x751F;&#x547D;&#x5468;&#x671F;&#x51FD;&#x6570;</span>
        Activity a = performLaunchActivity(r, customIntent);

        <span class="hljs-keyword">if</span> (a != <span class="hljs-keyword">null</span>) {
            r.createdConfig = <span class="hljs-keyword">new</span> Configuration(mConfiguration);
            Bundle oldState = r.state;
            <span class="hljs-comment">// &#x8C03;&#x7528;onResume&#x65B9;&#x6CD5;</span>
            handleResumeActivity(r.token, <span class="hljs-keyword">false</span>, r.isForward,
                    !r.activity.mFinished &amp;&amp; !r.startsNotResumed);

            <span class="hljs-keyword">if</span> (!r.activity.mFinished &amp;&amp; r.startsNotResumed) {
                <span class="hljs-keyword">try</span> {
                    r.activity.mCalled = <span class="hljs-keyword">false</span>;
                    mInstrumentation.callActivityOnPause(r.activity);
                    <span class="hljs-keyword">if</span> (r.isPreHoneycomb()) {
                        r.state = oldState;
                    }
                    <span class="hljs-keyword">if</span> (!r.activity.mCalled) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SuperNotCalledException(
                            <span class="hljs-string">&quot;Activity &quot;</span> + r.intent.getComponent().toShortString() +
                            <span class="hljs-string">&quot; did not call through to super.onPause()&quot;</span>);
                    }

                } <span class="hljs-keyword">catch</span> (SuperNotCalledException e) {
                    <span class="hljs-keyword">throw</span> e;
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    <span class="hljs-keyword">if</span> (!mInstrumentation.onException(r.activity, e)) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(
                                <span class="hljs-string">&quot;Unable to pause activity &quot;</span>
                                + r.intent.getComponent().toShortString()
                                + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);
                    }
                }
                r.paused = <span class="hljs-keyword">true</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">try</span> {
                ActivityManagerNative.getDefault()
                    .finishActivity(r.token, Activity.RESULT_CANCELED, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>);
            } <span class="hljs-keyword">catch</span> (RemoteException ex) {}
        }
    }
</code></pre>
<h4 id="activitythreadperformlaunchactivity">ActivityThread.performLaunchActivity()</h4>
<pre><code class="lang-java">    <span class="hljs-function"><span class="hljs-keyword">private</span> Activity <span class="hljs-title">performLaunchActivity</span><span class="hljs-params">(ActivityClientRecord r, Intent customIntent)</span> </span>{
        <span class="hljs-comment">// &#x6536;&#x96C6;&#x8981;&#x542F;&#x52A8;&#x7684;Activity&#x7684;package&#x4FE1;&#x606F;</span>
        ActivityInfo aInfo = r.activityInfo;
        <span class="hljs-keyword">if</span> (r.packageInfo == <span class="hljs-keyword">null</span>) {
            r.packageInfo = getPackageInfo(aInfo.applicationInfo, r.compatInfo,
                    Context.CONTEXT_INCLUDE_CODE);
        }
        <span class="hljs-comment">// &#x6536;&#x96C6;&#x8981;&#x542F;&#x52A8;&#x7684;Activity&#x7684;component&#x4FE1;&#x606F;</span>
        ComponentName component = r.intent.getComponent();
        <span class="hljs-keyword">if</span> (component == <span class="hljs-keyword">null</span>) {
            component = r.intent.resolveActivity(
                mInitialApplication.getPackageManager());
            r.intent.setComponent(component);
        }

        <span class="hljs-keyword">if</span> (r.activityInfo.targetActivity != <span class="hljs-keyword">null</span>) {
            component = <span class="hljs-keyword">new</span> ComponentName(r.activityInfo.packageName,
                    r.activityInfo.targetActivity);
        }

        <span class="hljs-comment">// &#x65B0;&#x5EFA;&#x4E00;&#x4E2A;Activity&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x8FC7;ClassLoader&#x5C06;&#x8981;&#x542F;&#x52A8;&#x7684;Activity&#x7C7B;&#x52A0;&#x8F7D;&#x8FDB;&#x6765;</span>
        Activity activity = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> {
            java.lang.ClassLoader cl = r.packageInfo.getClassLoader();
            activity = mInstrumentation.newActivity(
                    cl, component.getClassName(), r.intent);
            StrictMode.incrementExpectedActivityCount(activity.getClass());
            r.intent.setExtrasClassLoader(cl);
            r.intent.prepareToEnterProcess();
            <span class="hljs-keyword">if</span> (r.state != <span class="hljs-keyword">null</span>) {
                r.state.setClassLoader(cl);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (!mInstrumentation.onException(activity, e)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(
                    <span class="hljs-string">&quot;Unable to instantiate activity &quot;</span> + component
                    + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);
            }
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// &#x83B7;&#x53D6;Application&#x5BF9;&#x8C61;</span>
            <span class="hljs-comment">// &#x4E0D;&#x77E5;&#x9053;&#x5927;&#x5BB6;&#x6709;&#x6CA1;&#x6709;&#x5370;&#x8C61;&#xFF0C;&#x5728;ActivityThread.handleBindApplication&#x65B9;&#x6CD5;&#x4E2D;&#x5DF2;&#x7ECF;&#x8C03;&#x7528;&#x8FC7;makeApplication</span>
            <span class="hljs-comment">// &#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x8981;make&#x5462;&#xFF1F;&#x8FFD;&#x8E2A;&#x6E90;&#x7801;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x5C31;&#x8FD4;&#x56DE;&#x4EE5;&#x524D;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;</span>
            Application app = r.packageInfo.makeApplication(<span class="hljs-keyword">false</span>, mInstrumentation);

            <span class="hljs-keyword">if</span> (activity != <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">// &#x521B;&#x5EFA;Context&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x7ED1;&#x5B9A;&#x5230;Activity</span>
                Context appContext = createBaseContextForActivity(r, activity);
                CharSequence title = r.activityInfo.loadLabel(appContext.getPackageManager());
                Configuration config = <span class="hljs-keyword">new</span> Configuration(mCompatConfiguration);
                activity.attach(appContext, <span class="hljs-keyword">this</span>, getInstrumentation(), r.token,
                        r.ident, app, r.intent, r.activityInfo, title, r.parent,
                        r.embeddedID, r.lastNonConfigurationInstances, config,
                        r.referrer, r.voiceInteractor);

                <span class="hljs-keyword">if</span> (customIntent != <span class="hljs-keyword">null</span>) {
                    activity.mIntent = customIntent;
                }
                r.lastNonConfigurationInstances = <span class="hljs-keyword">null</span>;
                activity.mStartedActivity = <span class="hljs-keyword">false</span>;
                <span class="hljs-keyword">int</span> theme = r.activityInfo.getThemeResource();
                <span class="hljs-keyword">if</span> (theme != <span class="hljs-number">0</span>) {
                    activity.setTheme(theme);
                }

                activity.mCalled = <span class="hljs-keyword">false</span>;
                <span class="hljs-comment">// &#x8C03;&#x7528;Activity.onCreate&#x65B9;&#x6CD5;</span>
                <span class="hljs-comment">// &#x6839;&#x636E; manifest &#x4E2D;activity&#x7684;persistableMode&#x914D;&#x7F6E;&#x6765;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;onCreate&#x65B9;&#x6CD5;</span>
                <span class="hljs-keyword">if</span> (r.isPersistable()) {
                    mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);
                } <span class="hljs-keyword">else</span> {
                    mInstrumentation.callActivityOnCreate(activity, r.state);
                }
                <span class="hljs-keyword">if</span> (!activity.mCalled) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SuperNotCalledException(
                        <span class="hljs-string">&quot;Activity &quot;</span> + r.intent.getComponent().toShortString() +
                        <span class="hljs-string">&quot; did not call through to super.onCreate()&quot;</span>);
                }
                r.activity = activity;
                r.stopped = <span class="hljs-keyword">true</span>;
                <span class="hljs-keyword">if</span> (!r.activity.mFinished) {
                    <span class="hljs-comment">// &#x8C03;&#x7528;Activity.onStart&#x65B9;&#x6CD5;</span>
                    activity.performStart();
                    r.stopped = <span class="hljs-keyword">false</span>;
                }
                <span class="hljs-keyword">if</span> (!r.activity.mFinished) {
                    <span class="hljs-comment">// &#x8C03;&#x7528;Activity.onRestoreInstanceState&#x65B9;&#x6CD5;</span>
                    <span class="hljs-keyword">if</span> (r.isPersistable()) {
                        <span class="hljs-keyword">if</span> (r.state != <span class="hljs-keyword">null</span> || r.persistentState != <span class="hljs-keyword">null</span>) {
                            mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state,
                                    r.persistentState);
                        }
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (r.state != <span class="hljs-keyword">null</span>) {
                        mInstrumentation.callActivityOnRestoreInstanceState(activity, r.state);
                    }
                }
                <span class="hljs-keyword">if</span> (!r.activity.mFinished) {
                    activity.mCalled = <span class="hljs-keyword">false</span>;
                    <span class="hljs-comment">// &#x8C03;&#x7528;Activity.onPostCreate&#x65B9;&#x6CD5;</span>
                    <span class="hljs-keyword">if</span> (r.isPersistable()) {
                        mInstrumentation.callActivityOnPostCreate(activity, r.state,
                                r.persistentState);
                    } <span class="hljs-keyword">else</span> {
                        mInstrumentation.callActivityOnPostCreate(activity, r.state);
                    }
                    <span class="hljs-keyword">if</span> (!activity.mCalled) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> SuperNotCalledException(
                            <span class="hljs-string">&quot;Activity &quot;</span> + r.intent.getComponent().toShortString() +
                            <span class="hljs-string">&quot; did not call through to super.onPostCreate()&quot;</span>);
                    }
                }
            }
            r.paused = <span class="hljs-keyword">true</span>;

            mActivities.put(r.token, r);

        } <span class="hljs-keyword">catch</span> (SuperNotCalledException e) {
            <span class="hljs-keyword">throw</span> e;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (!mInstrumentation.onException(activity, e)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(
                    <span class="hljs-string">&quot;Unable to start activity &quot;</span> + component
                    + <span class="hljs-string">&quot;: &quot;</span> + e.toString(), e);
            }
        }
        <span class="hljs-keyword">return</span> activity;
    }
</code></pre>
<p>&#x4ECE; <code>performLaunchActivity</code> &#x65B9;&#x6CD5;&#x5F00;&#x59CB;&#xFF0C;&#x6B63;&#x5F0F;&#x8FDB;&#x5165;&#x4E86; <code>Activity</code> &#x7684; <code>onCreate()</code>&#x3001;<code>onStart()</code>&#x3001;<code>onResume()</code>&#x7B49;&#x751F;&#x547D;&#x5468;&#x671F;&#x8FC7;&#x7A0B;&#x3002;
&#x81F3;&#x6B64;&#xFF0C;<code>Activity</code> &#x7684;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x57FA;&#x672C;&#x4ECB;&#x7ECD;&#x5B8C;&#x4E86;&#x3002;</p>
<h2 id="&#x65B9;&#x6CD5;&#x8BE6;&#x89E3;">&#x65B9;&#x6CD5;&#x8BE6;&#x89E3;</h2>
<h3 id="findtasklocked">findTaskLocked()</h3>
<h3 id="findactivitylocked">findActivityLocked()</h3>
<h3 id="resolveactivity">resolveActivity()</h3>
<h2 id="&#x53C2;&#x8003;&#x6587;&#x6863;">&#x53C2;&#x8003;&#x6587;&#x6863;</h2>
<!--     
http://duanqz.github.io/2016-07-29-Activity-LaunchProcess-Part1#10-amsnewprocessrecordlocked
http://duanqz.github.io/2016-10-23-Activity-LaunchProcess-Part2#3-amsattachapplicationlocked
http://gityuan.com/2016/03/12/start-activity/

http://blog.csdn.net/luoshengyang/article/details/6689748
http://blog.csdn.net/Luoshengyang/article/details/6703247
http://duanqz.github.io/2016-02-01-Activity-Maintenance
http://duanqz.github.io/2016-07-29-Activity-LaunchProcess-Part1
http://gityuan.com/2016/03/12/start-activity/
http://gityuan.com/2016/10/09/app-process-create-2/
http://www.cnblogs.com/franksunny/archive/2012/04/17/2453403.html
http://blog.csdn.net/shan987/article/details/50511439
http://blog.csdn.net/yunbin_7/article/details/46003509
http://www.jianshu.com/p/2d52fa0bce90
-->
<footer class="page-footer"><span class="copyright">Copyright &#xA9; &#x5BD2;&#x6C5F;&#x84D1;&#x7B20; 2022 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x7AE0;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2026-01-30
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="android-source-code-analysis-ams-app-ipc.html" class="navigation navigation-prev " aria-label="Previous page: Android AMS 与 APP 进程通信">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="android-source-code-analysis-usermanager.html" class="navigation navigation-next " aria-label="Next page: Android UserManager相关源码分析">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Android startActivity 流程分析","categories":"Android源码分析","comments":true,"tags":["Android源码分析","startActivity"],"description":"基于Android6.0来分析 Activity 的启动过程","date":"2016-06-10T10:00:00.000Z","level":"1.20.6","depth":2,"next":{"title":"Android UserManager相关源码分析","level":"1.20.7","depth":2,"path":"source/Android源码分析/android-source-code-analysis-usermanager.md","ref":"source/Android源码分析/android-source-code-analysis-usermanager.md","articles":[]},"previous":{"title":"Android AMS 与 APP 进程通信","level":"1.20.5","depth":2,"path":"source/Android源码分析/android-source-code-analysis-ams-app-ipc.md","ref":"source/Android源码分析/android-source-code-analysis-ams-app-ipc.md","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters","chapter-fold","intopic-toc","hide-element","favicon","insert-logo","tbfed-pagefooter","splitter","back-to-top-button","code","github"],"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy 寒江蓑笠 2022","modify_label":"该文章修订时间：","modify_format":"YYYY-MM-DD"},"chapter-fold":{},"github":{"url":"https://github.com/heqiangflytosky"},"intopic-toc":{"isCollapsed":true,"isScrollspyActive":true,"label":"In this article","maxDepth":6,"mode":"nested","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4, .markdown-section h5, .markdown-section h6","visible":true},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":{"shortcut":"images/favicon.ico","bookmark":"https://github.com/heqiangflytosky/qbook/blob/gitbook/images/favicon.ico?raw=true"},"back-to-top-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false},"insert-logo":{"style":"background: none; max-height:129px","url":"https://github.com/heqiangflytosky/heqiangflytosky.github.io/blob/hexo/source/images/icon.png?raw=true"},"expandable-chapters":{}},"theme":"default","author":"寒江蓑笠","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"寒江蓑笠的博客","links":{"sidebar":{"我的CSDN":"https://blog.csdn.net/heqiangflytosky"}},"gitbook":"*","description":"记录工作，记录生活"},"file":{"path":"source/Android源码分析/android-source-code-analysis-activity-start-process.md","mtime":"2026-01-30T10:30:03.843Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2026-01-30T10:30:43.986Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/gumshoe.polyfills.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-intopic-toc/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

